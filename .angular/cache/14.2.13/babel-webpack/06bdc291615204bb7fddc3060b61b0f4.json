{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nlet CreateJobPost1stPageComponent = class CreateJobPost1stPageComponent {\n  constructor(title, meta, fb, snackBar, http, jobService, jobDescriptionService, corporateAuthService) {\n    this.title = title;\n    this.meta = meta;\n    this.fb = fb;\n    this.snackBar = snackBar;\n    this.http = http;\n    this.jobService = jobService;\n    this.jobDescriptionService = jobDescriptionService;\n    this.corporateAuthService = corporateAuthService; // Track current step: 'jobPost' or 'assessment'\n\n    this.currentStep = 'jobPost'; // Selected file for upload\n\n    this.selectedFile = null; // Flag to track assessment validity\n\n    this.assessmentQuestionsValid = false; // Initialize job form with all fields\n\n    this.jobForm = this.fb.group({\n      unique_id: ['', Validators.required],\n      role: ['', Validators.required],\n      location: ['', Validators.required],\n      job_type: ['', Validators.required],\n      workplace_type: ['', Validators.required],\n      total_experience_min: [0, [Validators.required, Validators.min(0)]],\n      total_experience_max: [30, [Validators.required, Validators.max(30)]],\n      relevant_experience_min: [0, [Validators.required, Validators.min(0)]],\n      relevant_experience_max: [30, [Validators.required, Validators.max(30)]],\n      budget_type: ['', Validators.required],\n      min_budget: ['', [Validators.required, Validators.min(0)]],\n      max_budget: ['', [Validators.required, Validators.min(0)]],\n      notice_period: ['', Validators.required],\n      skills: [[], Validators.required],\n      job_description: ['', Validators.required]\n    });\n  }\n\n  ngOnInit() {\n    // Set page title\n    this.title.setTitle('Create Job Post - Flashyre'); // Update meta tags for SEO\n\n    this.meta.updateTag({\n      property: 'og:title',\n      content: 'Create Job Post - Flashyre'\n    });\n  }\n\n  ngAfterViewInit() {\n    // Initialize experience sliders and skills input\n    this.setupExperienceSliders('total');\n    this.setupExperienceSliders('relevant');\n    this.setupSkillsInput();\n    this.setupJobDescriptionEditor();\n  } // Handle file selection from input\n\n\n  onFileSelected(event) {\n    if (event.target.files && event.target.files.length > 0) {\n      this.selectedFile = event.target.files[0];\n    }\n  } // Upload file to backend\n\n\n  uploadFile() {\n    // Check if a file is selected\n    if (!this.selectedFile) {\n      this.snackBar.open('Please select a file to upload.', 'Close', {\n        duration: 5000\n      });\n      return;\n    } // Prepare FormData for file upload\n\n\n    const formData = new FormData();\n    formData.append('file', this.selectedFile); // Send file to backend endpoint\n\n    this.http.post('/api/file_upload/', formData).subscribe({\n      next: response => {\n        const uniqueId = response.unique_id;\n\n        if (uniqueId) {\n          // Save unique_id to service and local storage\n          this.jobService.setUniqueId(uniqueId); // Update form with unique_id\n\n          this.jobForm.patchValue({\n            unique_id: uniqueId\n          });\n          this.snackBar.open('File uploaded successfully.', 'Close', {\n            duration: 3000\n          });\n        }\n      },\n      error: error => {\n        this.snackBar.open(`File upload failed: ${error.message || 'Unknown error'}`, 'Close', {\n          duration: 5000\n        });\n      }\n    });\n  } // Setup experience sliders\n\n\n  setupExperienceSliders(type) {\n    const rangeIndicator = document.getElementById(`${type}_rangeIndicator`);\n    const markerLeft = document.getElementById(`${type}_markerLeft`);\n    const markerRight = document.getElementById(`${type}_markerRight`);\n    const labelLeft = document.getElementById(`${type}_labelLeft`);\n    const labelRight = document.getElementById(`${type}_labelRight`);\n    const filledSegment = document.getElementById(`${type}_filledSegment`);\n    let isDragging = false;\n    let currentMarker = null;\n\n    const updateFilledSegment = () => {\n      const leftPos = parseInt(markerLeft.style.left);\n      const rightPos = parseInt(markerRight.style.left);\n      filledSegment.style.left = `${leftPos + 5}px`;\n      filledSegment.style.width = `${rightPos - leftPos}px`;\n    };\n\n    const updateLabelPosition = (marker, label) => {\n      const markerPos = parseInt(marker.style.left);\n      label.style.left = `${markerPos + 5}px`;\n    };\n\n    const updateFormValues = () => {\n      const rect = rangeIndicator.getBoundingClientRect();\n      const leftPos = parseInt(markerLeft.style.left);\n      const rightPos = parseInt(markerRight.style.left);\n      const maxWidth = rect.width - 10;\n      const minValue = 0;\n      const maxValue = 30;\n      const minExperience = Math.round(leftPos / maxWidth * (maxValue - minValue));\n      const maxExperience = Math.round(rightPos / maxWidth * (maxValue - minValue));\n      this.jobForm.patchValue({\n        [`${type}_experience_min`]: minExperience,\n        [`${type}_experience_max`]: maxExperience\n      });\n    };\n\n    const onMouseMove = e => {\n      if (!isDragging) return;\n      const rect = rangeIndicator.getBoundingClientRect();\n      let newLeft = e.clientX - rect.left - 5;\n      const minLeft = 0;\n      const maxLeft = rect.width - 10;\n\n      if (currentMarker === markerLeft) {\n        newLeft = Math.max(minLeft, Math.min(newLeft, parseInt(markerRight.style.left) - 10));\n      } else if (currentMarker === markerRight) {\n        newLeft = Math.min(maxLeft, Math.max(newLeft, parseInt(markerLeft.style.left) + 10));\n      }\n\n      currentMarker.style.left = `${newLeft}px`;\n      updateFilledSegment();\n      updateLabelPosition(currentMarker, currentMarker === markerLeft ? labelLeft : labelRight);\n      updateFormValues();\n    };\n\n    const onMouseUp = () => {\n      isDragging = false;\n      document.removeEventListener('mousemove', onMouseMove);\n      document.removeEventListener('mouseup', onMouseUp);\n    };\n\n    const onMouseDown = e => {\n      isDragging = true;\n      currentMarker = e.target;\n      document.addEventListener('mousemove', onMouseMove);\n      document.addEventListener('mouseup', onMouseUp);\n    };\n\n    markerLeft.addEventListener('mousedown', onMouseDown);\n    markerRight.addEventListener('mousedown', onMouseDown);\n    updateFilledSegment();\n  } // Setup skills input\n\n\n  setupSkillsInput() {\n    const tagContainer = document.getElementById('tagContainer');\n    const tagInput = document.getElementById('tagInput');\n    const suggestions = document.getElementById('suggestions');\n    const availableTags = ['JavaScript', 'HTML', 'CSS', 'React', 'Vue', 'Angular', 'Node.js', 'TypeScript', 'Python', 'Java', 'PHP', 'Ruby', 'Swift', 'Kotlin', 'Go', 'Rust', 'C#', 'C++', 'MongoDB', 'MySQL', 'PostgreSQL', 'Redis', 'GraphQL', 'REST API'];\n    let selectedTags = [];\n    let activeSuggestionIndex = -1;\n\n    const filterSuggestions = input => {\n      if (!input) return [];\n      const inputLower = input.toLowerCase();\n      return availableTags.filter(tag => tag.toLowerCase().includes(inputLower) && !selectedTags.includes(tag));\n    };\n\n    const showSuggestions = filteredSuggestions => {\n      suggestions.innerHTML = '';\n\n      if (filteredSuggestions.length === 0) {\n        suggestions.style.display = 'none';\n        return;\n      }\n\n      filteredSuggestions.forEach((suggestion, index) => {\n        const item = document.createElement('div');\n        item.className = 'suggestion-item';\n        item.textContent = suggestion;\n        item.addEventListener('click', () => {\n          addTag(suggestion);\n          tagInput.value = '';\n          suggestions.style.display = 'none';\n          tagInput.focus();\n        });\n        suggestions.appendChild(item);\n      });\n      suggestions.style.display = 'block';\n      activeSuggestionIndex = -1;\n    };\n\n    const addTag = text => {\n      if (!text || selectedTags.includes(text)) return;\n      selectedTags.push(text);\n      const tag = document.createElement('div');\n      tag.className = 'tag';\n      const tagText = document.createElement('span');\n      tagText.textContent = text;\n      tag.appendChild(tagText);\n      const removeBtn = document.createElement('button');\n      removeBtn.textContent = 'Ã—';\n      removeBtn.addEventListener('click', () => {\n        tag.remove();\n        selectedTags = selectedTags.filter(t => t !== text);\n        this.jobForm.patchValue({\n          skills: selectedTags\n        });\n      });\n      tag.appendChild(removeBtn);\n      tagContainer.insertBefore(tag, tagInput);\n      this.jobForm.patchValue({\n        skills: selectedTags\n      });\n    };\n\n    const navigateSuggestions = direction => {\n      const items = suggestions.querySelectorAll('.suggestion-item');\n      if (items.length === 0) return;\n\n      if (activeSuggestionIndex >= 0 && activeSuggestionIndex < items.length) {\n        items[activeSuggestionIndex].classList.remove('active-suggestion');\n      }\n\n      if (direction === 'down') {\n        activeSuggestionIndex = (activeSuggestionIndex + 1) % items.length;\n      } else {\n        activeSuggestionIndex = activeSuggestionIndex <= 0 ? items.length - 1 : activeSuggestionIndex - 1;\n      }\n\n      items[activeSuggestionIndex].classList.add('active-suggestion');\n      items[activeSuggestionIndex].scrollIntoView({\n        block: 'nearest'\n      });\n    };\n\n    tagInput.addEventListener('input', () => {\n      const filteredSuggestions = filterSuggestions(tagInput.value);\n      showSuggestions(filteredSuggestions);\n    });\n    tagInput.addEventListener('keydown', e => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        const items = suggestions.querySelectorAll('.suggestion-item');\n\n        if (activeSuggestionIndex >= 0 && activeSuggestionIndex < items.length) {\n          addTag(items[activeSuggestionIndex].textContent);\n        } else if (tagInput.value) {\n          addTag(tagInput.value);\n        }\n\n        tagInput.value = '';\n        suggestions.style.display = 'none';\n      } else if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        navigateSuggestions('down');\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        navigateSuggestions('up');\n      } else if (e.key === 'Backspace' && !tagInput.value) {\n        const lastIndex = selectedTags.length - 1;\n\n        if (lastIndex >= 0) {\n          const lastTag = selectedTags[lastIndex];\n          selectedTags.pop();\n          const tags = tagContainer.querySelectorAll('.tag');\n          tags[tags.length - 1].remove();\n          this.jobForm.patchValue({\n            skills: selectedTags\n          });\n        }\n      } else if (e.key === 'Escape') {\n        suggestions.style.display = 'none';\n      }\n    });\n    document.addEventListener('click', e => {\n      if (!tagContainer.contains(e.target) && !suggestions.contains(e.target)) {\n        suggestions.style.display = 'none';\n      }\n    });\n    tagContainer.addEventListener('click', e => {\n      if (e.target === tagContainer) {\n        tagInput.focus();\n      }\n    });\n  } // Setup job description editor\n\n\n  setupJobDescriptionEditor() {\n    const editor = document.getElementById('editor');\n    editor.addEventListener('input', () => {\n      this.jobForm.patchValue({\n        job_description: editor.innerHTML\n      });\n    });\n  } // Handle Submit button click\n\n\n  onSubmit() {\n    if (this.currentStep === 'jobPost') {\n      // Validate job form\n      if (this.jobForm.invalid) {\n        this.snackBar.open('Please fill all required fields correctly.', 'Close', {\n          duration: 5000\n        });\n        this.jobForm.markAllAsTouched();\n        return;\n      } // Check for authentication token\n\n\n      const token = this.corporateAuthService.getJWTToken();\n\n      if (!token) {\n        this.snackBar.open('Authentication required. Please log in.', 'Close', {\n          duration: 5000\n        });\n        return;\n      } // Prepare job details from form\n\n\n      const formValues = this.jobForm.value;\n      const jobDetails = Object.assign(Object.assign({}, formValues), {\n        skills: {\n          primary: formValues.skills.slice(0, Math.ceil(formValues.skills.length / 2)).map(skill => ({\n            skill,\n            skill_confidence: 0.9,\n            type_confidence: 0.9\n          })),\n          secondary: formValues.skills.slice(Math.ceil(formValues.skills.length / 2)).map(skill => ({\n            skill,\n            skill_confidence: 0.8,\n            type_confidence: 0.8\n          }))\n        }\n      }); // Save job data to service\n\n      this.jobService.setJobPostData(jobDetails); // Save job post to backend\n\n      this.jobDescriptionService.saveJobPost(jobDetails, token).subscribe({\n        next: () => {\n          this.snackBar.open('Job post saved successfully.', 'Close', {\n            duration: 3000\n          }); // Switch to assessment step\n\n          this.currentStep = 'assessment';\n        },\n        error: error => {\n          this.snackBar.open(`Job post creation failed: ${error.message || 'Unknown error'}`, 'Close', {\n            duration: 5000\n          });\n        }\n      });\n    } else if (this.currentStep === 'assessment') {\n      // Validate assessment questions\n      if (!this.assessmentQuestionsValid) {\n        this.snackBar.open('Please complete the assessment questions.', 'Close', {\n          duration: 5000\n        });\n        return;\n      } // Get unique_id for finalizing job post\n\n\n      const uniqueId = this.jobService.getUniqueId();\n\n      if (uniqueId) {\n        // Update job post status to final\n        this.jobDescriptionService.updateJobPostStatus(uniqueId, 'final').subscribe({\n          next: () => {\n            this.snackBar.open('Job post finalized successfully.', 'Close', {\n              duration: 3000\n            }); // Reset form and step\n\n            this.currentStep = 'jobPost';\n            this.jobForm.reset();\n            localStorage.removeItem('unique_id');\n          },\n          error: error => {\n            this.snackBar.open(`Failed to finalize job post: ${error.message}`, 'Close', {\n              duration: 5000\n            });\n          }\n        });\n      }\n    }\n  } // Handle Cancel button click\n\n\n  onCancel() {\n    if (this.currentStep === 'assessment') {\n      // Return to job post form\n      this.currentStep = 'jobPost';\n    } else {\n      // Reset form and clear local storage\n      this.jobForm.reset();\n      localStorage.removeItem('unique_id');\n      this.snackBar.open('Job post cancelled.', 'Close', {\n        duration: 3000\n      });\n    }\n  } // Update assessment validity based on child component output\n\n\n  onAssessmentValidityChange(isValid) {\n    this.assessmentQuestionsValid = isValid;\n  }\n\n};\nCreateJobPost1stPageComponent = __decorate([Component({\n  selector: 'create-job-post-1st-page',\n  templateUrl: './create-job-post-1st-page.component.html',\n  styleUrls: ['./create-job-post-1st-page.component.css']\n})], CreateJobPost1stPageComponent);\nexport { CreateJobPost1stPageComponent };","map":null,"metadata":{},"sourceType":"module"}