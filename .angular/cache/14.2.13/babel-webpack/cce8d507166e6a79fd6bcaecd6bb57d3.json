{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { environment } from '../../../environments/environment';\nlet CandidateHome = class CandidateHome {\n  constructor(title, meta, http, router, authService, jobService) {\n    this.title = title;\n    this.meta = meta;\n    this.http = http;\n    this.router = router;\n    this.authService = authService;\n    this.jobService = jobService;\n    this.userProfile = {};\n    this.defaultProfilePicture = \"/assets/placeholders/profile-placeholder.jpg\";\n    this.jobs = [];\n    this.displayedJobs = [];\n    this.appliedJobIds = [];\n    this.processingApplications = {};\n    this.applicationSuccess = {};\n    this.isLoading = true;\n    this.images = ['src/assets/temp-jobs-icon/1.png', 'src/assets/temp-jobs-icon/2.png', 'src/assets/temp-jobs-icon/3.png', 'src/assets/temp-jobs-icon/4.png', 'src/assets/temp-jobs-icon/5.png', 'src/assets/temp-jobs-icon/6.png', 'src/assets/temp-jobs-icon/7.png', 'src/assets/temp-jobs-icon/8.png'];\n    this.jobsWithImages = this.jobs.map(job => Object.assign(Object.assign({}, job), {\n      imageSrc: this.getRandomImage()\n    }));\n    this.apiUrl = environment.apiUrl + 'api/jobs/';\n    this.title.setTitle('Candidate-Home - Flashyre');\n    this.meta.addTags([{\n      property: 'og:title',\n      content: 'Candidate-Home - Flashyre'\n    }, {\n      property: 'og:image',\n      content: 'https://aheioqhobo.cloudimg.io/v7/_playground-bucket-v2.teleporthq.io_/8203932d-6f2d-4493-a7b2-7000ee521aa2/9aea8e9c-27ce-4011-a345-94a92ae2dbf8?org_if_sml=1&force_format=original'\n    }]);\n  }\n\n  getRandomImage() {\n    const randomIndex = Math.floor(Math.random() * this.images.length);\n    return this.images[randomIndex];\n  }\n\n  ngOnInit() {\n    this.jobService.fetchJobs();\n    this.loadJobsAndFilterApplied();\n    this.loadUserProfile();\n  }\n\n  ngAfterViewInit() {\n    const options = {\n      root: null,\n      rootMargin: '0px',\n      threshold: 0.1\n    };\n    const observer = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting) {\n        this.loadMoreJobs();\n      }\n    }, options);\n    const loadMoreElement = document.getElementById('load-more');\n\n    if (loadMoreElement) {\n      observer.observe(loadMoreElement);\n    }\n  }\n\n  loadJobsAndFilterApplied() {\n    this.isLoading = true;\n    this.authService.getAppliedJobs().subscribe(appliedJobs => {\n      this.appliedJobIds = appliedJobs.applied_job_ids || [];\n      this.jobService.getJobs().subscribe(jobs => {\n        this.jobs = jobs.filter(job => !this.appliedJobIds.includes(job.job_id));\n        this.displayedJobs = this.jobs.slice(0, 30);\n        this.isLoading = false;\n      });\n    }, error => {\n      console.error('Error fetching applied jobs:', error);\n      this.isLoading = false;\n      this.fetchJobsFallback();\n    });\n  }\n\n  fetchJobsFallback() {\n    this.jobService.fetchJobs();\n    this.jobService.getJobs().subscribe(jobs => {\n      this.jobs = jobs;\n      this.displayedJobs = this.jobs.slice(0, 30);\n    }, error => console.error('Error fetching jobs:', error));\n  }\n\n  loadMoreJobs() {\n    const nextJobs = this.jobs.slice(this.displayedJobs.length, this.displayedJobs.length + 30);\n    this.displayedJobs = [...this.displayedJobs, ...nextJobs];\n  }\n\n  loadUserProfile() {\n    const profileData = localStorage.getItem('userProfile');\n\n    if (profileData) {\n      this.userProfile = JSON.parse(profileData);\n    } else {\n      console.log(\"User Profile NOT fetched\");\n    }\n  }\n\n  navigateToAssessment(jobId) {\n    this.router.navigate(['/flashyre-rules', jobId]);\n  }\n\n  applyForJob(jobId, index) {\n    this.processingApplications[jobId] = true;\n    this.authService.applyForJob(jobId).subscribe(response => {\n      console.log('Application successful:', response);\n      this.applicationSuccess[jobId] = true;\n      this.appliedJobIds.push(jobId);\n      setTimeout(() => {\n        this.jobs = this.jobs.filter(job => job.job_id !== jobId);\n        this.displayedJobs = this.displayedJobs.filter(job => job.job_id !== jobId);\n      }, 2000);\n    }, error => {\n      var _a;\n\n      console.error('Application failed:', error);\n      this.processingApplications[jobId] = false;\n      alert(((_a = error.error) === null || _a === void 0 ? void 0 : _a.error) || 'Failed to apply for this job');\n    });\n  }\n\n};\nCandidateHome = __decorate([Component({\n  selector: 'candidate-home',\n  templateUrl: 'candidate-home.component.html',\n  styleUrls: ['candidate-home.component.css']\n})], CandidateHome);\nexport { CandidateHome };","map":null,"metadata":{},"sourceType":"module"}