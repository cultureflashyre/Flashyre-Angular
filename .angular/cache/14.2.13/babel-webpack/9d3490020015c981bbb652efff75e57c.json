{"ast":null,"code":"import { __decorate, __param } from \"tslib\"; // src/app/components/assessment-questions-main-container/assessment-questions-main-container.component.ts\n\nimport { Component, Input, ContentChild, ViewChild, Inject, PLATFORM_ID } from '@angular/core';\nimport { isPlatformBrowser, DOCUMENT } from '@angular/common';\nlet AssessmentQuestionsMainContainer = class AssessmentQuestionsMainContainer {\n  constructor(mcqAssessmentService, corporateAuthService, snackBar, document, platformId) {\n    this.mcqAssessmentService = mcqAssessmentService;\n    this.corporateAuthService = corporateAuthService;\n    this.snackBar = snackBar;\n    this.document = document; // ... (rename all your @ContentChild refs like this to avoid conflicts with property names)\n\n    this.assessmentNameInputPlaceholder = 'Assessment Name';\n    this.uploadInputFieldPlaceholder = 'Upload Questions';\n    this.rawbj7x = ' '; // Example, ensure these are used or remove\n\n    this.rawnawq = ' '; // Example\n\n    this.assessmentName = '';\n    this.aiGeneratedMcqsBySkill = {};\n    this.selectedMcqItemIds = new Set(); // Stores MCQItem.id\n\n    this.isLoadingMcqs = false;\n    this.activeTab = 'ai'; // Default to 'ai'\n    // Proctoring and assessment settings\n\n    this.isProctored = false; // Default values\n\n    this.hasVideoRecording = false;\n    this.allowPhoneAccess = false;\n    this.shuffleQuestionsOverall = false;\n    this.totalQuestionsToPresentInput = ''; // Bound to the input, will be parsed to number\n\n    this.selectAllAiQuestions = false; // For the \"Select All\" checkbox for AI questions\n\n    this.isBrowser = isPlatformBrowser(platformId);\n  }\n\n  ngOnInit() {\n    // Initial load if jobUniqueId is already set\n    if (this.jobUniqueId && this.isBrowser) {\n      this.loadAiGeneratedMcqs();\n    }\n  }\n\n  ngOnChanges(changes) {\n    if (changes['jobUniqueId'] && this.jobUniqueId && this.isBrowser) {\n      this.loadAiGeneratedMcqs();\n    }\n  }\n\n  loadAiGeneratedMcqs() {\n    if (!this.jobUniqueId) {\n      // console.warn('Job Unique ID is not available to load MCQs.');\n      return;\n    }\n\n    const token = this.corporateAuthService.getJWTToken();\n\n    if (!token) {\n      this.snackBar.open('Authentication token not found.', 'Close', {\n        duration: 3000\n      });\n      return;\n    }\n\n    this.isLoadingMcqs = true;\n    this.aiGeneratedMcqsBySkill = {}; // Reset before loading\n\n    this.selectedMcqItemIds.clear();\n    this.selectAllAiQuestions = false;\n    this.mcqAssessmentService.getMcqsForJobPost(this.jobUniqueId, token).subscribe({\n      next: response => {\n        if (response && typeof response === 'object') {\n          Object.keys(response).forEach(skill => {\n            const skillGroup = response[skill];\n\n            if (skillGroup && skillGroup.mcq_items) {\n              if (!this.aiGeneratedMcqsBySkill[skill]) {\n                this.aiGeneratedMcqsBySkill[skill] = {\n                  jobMcqId: skillGroup.job_mcq_id,\n                  items: []\n                };\n              }\n\n              this.aiGeneratedMcqsBySkill[skill].items = skillGroup.mcq_items.map(rawItem => Object.assign(Object.assign({}, rawItem), {\n                parsedDetails: this.parseMcqRawText(rawItem.question_text),\n                isSelected: false // Initialize isSelected\n\n              }));\n            }\n          });\n        }\n\n        this.isLoadingMcqs = false;\n      },\n      error: err => {\n        this.isLoadingMcqs = false;\n        this.snackBar.open(`Error loading MCQs: ${err.message || 'Unknown error'}`, 'Close', {\n          duration: 5000\n        });\n        console.error('Error loading MCQs:', err);\n      }\n    });\n  }\n\n  parseMcqRawText(rawText) {\n    const lines = rawText.split('\\n').map(line => line.trim()).filter(line => line);\n    let question = '';\n    const options = [];\n    let correctAnswerLabel = '';\n\n    if (lines.length > 0) {\n      // Extract question (handle potential \"Qx. \" prefix)\n      question = lines[0].replace(/^Q\\d+\\.?\\s*/i, '').trim();\n    }\n\n    const optionRegex = /^\\s*([a-dA-D])\\)\\s*(.+)/; // Matches \"a) Option text\"\n\n    const answerRegex = /^\\s*Correct Answer:\\s*([a-dA-D])\\s*$/i; // Matches \"Correct Answer: a\"\n\n    for (let i = 1; i < lines.length; i++) {\n      const line = lines[i];\n      const optionMatch = line.match(optionRegex);\n\n      if (optionMatch) {\n        // We only store the option text, the label (a,b,c,d) is derived by index later\n        options.push(optionMatch[2].trim());\n      } else {\n        const answerMatch = line.match(answerRegex);\n\n        if (answerMatch) {\n          correctAnswerLabel = answerMatch[1].toLowerCase(); // No break here, continue in case there's more text after answer (though unlikely for well-formed data)\n        }\n      }\n    } // Ensure at least 4 options, pad with empty strings if necessary (or handle display differently)\n\n\n    while (options.length < 4) {\n      options.push(''); // Or \"N/A\"\n    }\n\n    return {\n      question,\n      options: options.slice(0, 4),\n      correctAnswerLabel\n    }; // Take only first 4 options\n  }\n\n  getObjectKeys(obj) {\n    return obj ? Object.keys(obj) : [];\n  }\n\n  getOptionLabel(index) {\n    return String.fromCharCode(97 + index); // a, b, c, d\n  }\n\n  toggleMcqSelection(mcqItemId, event) {\n    const isChecked = event.target.checked;\n\n    if (isChecked) {\n      this.selectedMcqItemIds.add(mcqItemId);\n    } else {\n      this.selectedMcqItemIds.delete(mcqItemId);\n    }\n\n    this.updateSelectAllCheckboxState();\n  }\n\n  toggleSelectAllAiQuestions() {\n    // This method is called when the \"Select All\" checkbox state is changed BY THE USER\n    // So, this.selectAllAiQuestions already reflects the new desired state\n    const currentSkillKeys = this.getObjectKeys(this.aiGeneratedMcqsBySkill);\n\n    if (this.selectAllAiQuestions) {\n      // If \"Select All\" is now checked\n      currentSkillKeys.forEach(skill => {\n        this.aiGeneratedMcqsBySkill[skill].items.forEach(item => {\n          this.selectedMcqItemIds.add(item.mcq_item_id);\n          item.isSelected = true; // Update individual item state for UI if needed\n        });\n      });\n    } else {\n      // If \"Select All\" is now unchecked\n      this.selectedMcqItemIds.clear();\n      currentSkillKeys.forEach(skill => {\n        this.aiGeneratedMcqsBySkill[skill].items.forEach(item => {\n          item.isSelected = false; // Update individual item state\n        });\n      });\n    }\n  } // Call this after individual checkbox changes to see if \"Select All\" should be checked/unchecked\n\n\n  updateSelectAllCheckboxState() {\n    const currentSkillKeys = this.getObjectKeys(this.aiGeneratedMcqsBySkill);\n\n    if (currentSkillKeys.length === 0 && this.selectedMcqItemIds.size === 0) {\n      this.selectAllAiQuestions = false;\n      return;\n    }\n\n    let allSelected = true;\n\n    for (const skill of currentSkillKeys) {\n      for (const item of this.aiGeneratedMcqsBySkill[skill].items) {\n        if (!this.selectedMcqItemIds.has(item.mcq_item_id)) {\n          allSelected = false;\n          break;\n        }\n      }\n\n      if (!allSelected) break;\n    }\n\n    this.selectAllAiQuestions = allSelected;\n  }\n\n  setActiveTab(tab) {\n    this.activeTab = tab; // Potentially load uploaded questions if that tab is selected and not yet loaded\n  } // Method to be called by the parent component\n\n\n  getAssessmentPayload() {\n    var _a;\n\n    const assessmentNameTrimmed = this.assessmentName.trim();\n\n    if (!assessmentNameTrimmed) {\n      this.snackBar.open('Assessment Name is required.', 'Close', {\n        duration: 3000\n      });\n\n      if ((_a = this.assessmentNameInputEl) === null || _a === void 0 ? void 0 : _a.nativeElement) {\n        this.assessmentNameInputEl.nativeElement.focus();\n      }\n\n      return null;\n    }\n\n    if (this.activeTab === 'ai' && this.selectedMcqItemIds.size === 0) {\n      this.snackBar.open('Please select at least one AI-generated question.', 'Close', {\n        duration: 3000\n      });\n      return null;\n    } // Add similar validation if activeTab === 'uploaded'\n\n\n    let totalQuestionsNum = null;\n\n    if (this.totalQuestionsToPresentInput.trim() !== '') {\n      const parsedNum = parseInt(this.totalQuestionsToPresentInput.trim(), 10);\n\n      if (!isNaN(parsedNum) && parsedNum > 0) {\n        totalQuestionsNum = parsedNum;\n      } else {\n        this.snackBar.open('Total Questions to Present must be a valid positive number if provided.', 'Close', {\n          duration: 4000\n        });\n        return null;\n      }\n    } // Ensure total_questions_to_present is not greater than selected questions\n\n\n    if (totalQuestionsNum !== null && totalQuestionsNum > this.selectedMcqItemIds.size) {\n      this.snackBar.open(`Total Questions to Present (${totalQuestionsNum}) cannot exceed the number of selected questions (${this.selectedMcqItemIds.size}).`, 'Close', {\n        duration: 5000\n      });\n      return null;\n    }\n\n    return {\n      job_unique_id: this.jobUniqueId,\n      name: assessmentNameTrimmed,\n      selected_mcq_item_ids: Array.from(this.selectedMcqItemIds),\n      is_proctored: this.isProctored,\n      has_video_recording: this.hasVideoRecording,\n      allow_phone_access: this.allowPhoneAccess,\n      shuffle_questions_overall: this.shuffleQuestionsOverall,\n      total_questions_to_present: totalQuestionsNum\n    };\n  } // --- Functions to update proctoring settings based on toggle switch events ---\n\n\n  onProctoredChange(event) {\n    this.isProctored = event.target.checked;\n  }\n\n  onVideoRecordingChange(event) {\n    this.hasVideoRecording = event.target.checked;\n  }\n\n  onPhoneAccessChange(event) {\n    this.allowPhoneAccess = event.target.checked;\n  }\n\n  onShuffleChange(event) {\n    this.shuffleQuestionsOverall = event.target.checked;\n  }\n\n};\n\n__decorate([ContentChild('aiGeneratedText')], AssessmentQuestionsMainContainer.prototype, \"aiGeneratedTextRef\", void 0);\n\n__decorate([ContentChild('phoneAccessText')], AssessmentQuestionsMainContainer.prototype, \"phoneAccessTextRef\", void 0);\n\n__decorate([Input()], AssessmentQuestionsMainContainer.prototype, \"assessmentNameInputPlaceholder\", void 0);\n\n__decorate([Input()], AssessmentQuestionsMainContainer.prototype, \"uploadInputFieldPlaceholder\", void 0);\n\n__decorate([Input()], AssessmentQuestionsMainContainer.prototype, \"jobUniqueId\", void 0);\n\n__decorate([ViewChild('assessmentNameInput')], AssessmentQuestionsMainContainer.prototype, \"assessmentNameInputEl\", void 0);\n\n__decorate([ViewChild('selectAllAiCheckbox')], AssessmentQuestionsMainContainer.prototype, \"selectAllAiCheckboxEl\", void 0);\n\nAssessmentQuestionsMainContainer = __decorate([Component({\n  selector: 'assessment-questions-main-container',\n  templateUrl: 'assessment-questions-main-container.component.html',\n  styleUrls: ['assessment-questions-main-container.component.css']\n}), __param(3, Inject(DOCUMENT)), __param(4, Inject(PLATFORM_ID))], AssessmentQuestionsMainContainer);\nexport { AssessmentQuestionsMainContainer };","map":null,"metadata":{},"sourceType":"module"}