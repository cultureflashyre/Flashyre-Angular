{"ast":null,"code":"import { __awaiter, __decorate } from \"tslib\";\nimport { Component, ContentChild } from '@angular/core';\nimport { environment } from '../../../environments/environment';\nimport { forkJoin } from 'rxjs';\nlet ProfileCertificationsComponent = class ProfileCertificationsComponent {\n  constructor(fb, http, spinner, certificationService) {\n    this.fb = fb;\n    this.http = http;\n    this.spinner = spinner;\n    this.certificationService = certificationService;\n    this.baseUrl = environment.apiUrl;\n    this.certifications = [{\n      certificate_name: '',\n      issuing_institute: '',\n      issued_date: '',\n      renewal_date: '',\n      credentials: ''\n    }];\n    this.apiUrl = 'http://localhost:8000/api/certifications/';\n    this.certificationForm = this.fb.group({\n      certifications: this.fb.array([this.createCertificationGroup()])\n    });\n  }\n\n  addCertification() {\n    this.certifications.push({\n      certificate_name: '',\n      issuing_institute: '',\n      issued_date: '',\n      renewal_date: '',\n      credentials: ''\n    });\n    this.emitData();\n  }\n\n  removeCertification(index) {\n    if (this.certifications.length > 1) {\n      this.certifications.splice(index, 1);\n      this.emitData();\n    }\n  }\n\n  onFieldChange(index) {\n    this.emitData();\n  }\n\n  onIssuedDateChange(index) {\n    const cert = this.certifications[index];\n\n    if (cert.issued_date) {\n      const issuedDate = new Date(cert.issued_date);\n      const today = new Date();\n\n      if (issuedDate > today) {\n        cert.issued_date = this.getTodayDate();\n      }\n\n      if (cert.renewal_date && new Date(cert.renewal_date) <= issuedDate) {\n        cert.renewal_date = '';\n      }\n    }\n\n    this.emitData();\n  }\n\n  submitCertification() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.certificationForm.valid) {\n        const data = this.certificationForm.value.certifications;\n        const requests = data.map(cert => this.certificationService.saveCertification(cert));\n        getMinRenewalDate(index, number);\n        string;\n        {\n          const cert = this.certifications[index];\n\n          if (cert.issued_date) {\n            const issuedDate = new Date(cert.issued_date);\n            issuedDate.setDate(issuedDate.getDate() + 1);\n            return issuedDate.toISOString().split('T')[0];\n          }\n\n          return this.getTodayDate();\n        }\n        emitData();\n        {\n          this.certificationData.emit(this.certifications);\n        }\n\n        try {\n          yield forkJoin(requests).toPromise(); // Wait for all requests to complete\n\n          this.certificationForm.reset();\n          this.certifications.clear();\n          this.certifications.push(this.createCertificationGroup());\n          console.log('All certifications saved successfully');\n        } catch (error) {\n          console.error('Error saving certifications:', error); // Handle error accordingly, e.g., show a notification to the user\n        } finally {\n          // Hide spinner after all requests are completed\n          this.spinner.hide();\n        }\n      }\n\n      ;\n    });\n  }\n\n};\n\n__decorate([ContentChild('text1')], ProfileCertificationsComponent.prototype, \"text1\", void 0);\n\n__decorate([ContentChild('text312')], ProfileCertificationsComponent.prototype, \"text312\", void 0);\n\n__decorate([ContentChild('text12')], ProfileCertificationsComponent.prototype, \"text12\", void 0);\n\n__decorate([ContentChild('text1111')], ProfileCertificationsComponent.prototype, \"text1111\", void 0);\n\n__decorate([ContentChild('text311')], ProfileCertificationsComponent.prototype, \"text311\", void 0);\n\n__decorate([ContentChild('text1121')], ProfileCertificationsComponent.prototype, \"text1121\", void 0);\n\n__decorate([ContentChild('text3121')], ProfileCertificationsComponent.prototype, \"text3121\", void 0);\n\n__decorate([ContentChild('text11')], ProfileCertificationsComponent.prototype, \"text11\", void 0);\n\n__decorate([ContentChild('text112')], ProfileCertificationsComponent.prototype, \"text112\", void 0);\n\n__decorate([ContentChild('text111')], ProfileCertificationsComponent.prototype, \"text111\", void 0);\n\n__decorate([ContentChild('text')], ProfileCertificationsComponent.prototype, \"text\", void 0);\n\n__decorate([ContentChild('text31')], ProfileCertificationsComponent.prototype, \"text31\", void 0);\n\n__decorate([ContentChild('text3111')], ProfileCertificationsComponent.prototype, \"text3111\", void 0);\n\n__decorate([ViewChild('scrollContainer', {\n  static: false\n})], ProfileCertificationsComponent.prototype, \"scrollContainer\", void 0);\n\n__decorate([ViewChildren('certificationBlock')], ProfileCertificationsComponent.prototype, \"certificationBlocks\", void 0);\n\nProfileCertificationsComponent = __decorate([Component({\n  selector: 'profile-certifications-component',\n  templateUrl: './profile-certifications-component.component.html',\n  styleUrls: ['./profile-certifications-component.component.css']\n})], ProfileCertificationsComponent);\nexport { ProfileCertificationsComponent };","map":null,"metadata":{},"sourceType":"module"}