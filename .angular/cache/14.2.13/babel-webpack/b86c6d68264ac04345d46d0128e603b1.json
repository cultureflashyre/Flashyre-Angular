{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, Input, ContentChild } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { of } from 'rxjs';\nimport { debounceTime, switchMap, map, catchError } from 'rxjs/operators';\nlet SignupCorporate1 = class SignupCorporate1 {\n  constructor(fb, corporateAuthService, router) {\n    this.fb = fb;\n    this.corporateAuthService = corporateAuthService;\n    this.router = router;\n    this.rootClassName = '';\n    this.errorMessage = '';\n    this.showSuccessPopup = false;\n    this.passwordType = 'password';\n    this.confirmPasswordType = 'password';\n    this.passwordButtonText = 'Show';\n    this.confirmPasswordButtonText = 'Show';\n    this.signupForm = this.fb.group({\n      first_name: ['', Validators.required],\n      last_name: ['', Validators.required],\n      company_name: ['', Validators.required],\n      phone_number: ['', [Validators.required, Validators.pattern(/^\\d{10}$/), Validators.maxLength(10)], [this.phoneExistsValidator()] // Add async validator\n      ],\n      email: ['', [Validators.required, Validators.email], [this.emailExistsValidator()] // Add async validator\n      ],\n      password: ['', [Validators.required, Validators.minLength(8), Validators.maxLength(15)]],\n      confirm_password: ['', Validators.required]\n    }, {\n      validator: this.passwordMatchValidator\n    });\n  }\n\n  passwordMatchValidator(form) {\n    const password = form.get('password').value;\n    const confirmPassword = form.get('confirm_password').value;\n    return password === confirmPassword ? null : {\n      mismatch: true\n    };\n  }\n\n  restrictToNumbers(event) {\n    const input = event.target.value;\n    const charCode = event.charCode ? event.charCode : event.keyCode;\n\n    if (charCode < 48 || charCode > 57) {\n      event.preventDefault();\n      return false;\n    }\n\n    if (input.length >= 10) {\n      event.preventDefault();\n      return false;\n    }\n\n    return true;\n  } // Async validator for phone number\n\n\n  phoneExistsValidator() {\n    return control => {\n      const phone = control.value;\n      if (!phone) return of(null);\n      return of(phone).pipe(debounceTime(500), // Wait 500ms after typing stops\n      switchMap(value => this.corporateAuthService.checkExistence({\n        phone_number: value\n      }).pipe(map(res => res.exists ? {\n        phoneExists: true\n      } : null), catchError(() => of(null)))));\n    };\n  } // Async validator for email\n\n\n  emailExistsValidator() {\n    return control => {\n      const email = control.value;\n      if (!email) return of(null);\n      return of(email).pipe(debounceTime(500), // Wait 500ms after typing stops\n      switchMap(value => this.corporateAuthService.checkExistence({\n        email: value\n      }).pipe(map(res => res.exists ? {\n        emailExists: true\n      } : null), catchError(() => of(null)))));\n    };\n  }\n\n  onSubmit() {\n    var _a, _b, _c, _d, _e, _f, _g;\n\n    if (this.signupForm.valid) {\n      const formData = Object.assign({}, this.signupForm.value);\n      delete formData.confirm_password;\n      console.log('Sending signup data:', formData);\n      this.corporateAuthService.signupCorporate(formData).subscribe({\n        next: response => {\n          console.log('Signup response:', response);\n          this.showSuccessPopup = true;\n          this.errorMessage = '';\n        },\n        error: error => {\n          var _a, _b, _c, _d;\n\n          console.log('Signup error:', error);\n          this.errorMessage = '';\n          const errors = ((_a = error.error) === null || _a === void 0 ? void 0 : _a.errors) || {};\n\n          if (errors.phone_number) {\n            (_b = this.signupForm.get('phone_number')) === null || _b === void 0 ? void 0 : _b.setErrors({\n              serverError: errors.phone_number[0]\n            });\n          }\n\n          if (errors.email) {\n            (_c = this.signupForm.get('email')) === null || _c === void 0 ? void 0 : _c.setErrors({\n              serverError: errors.email[0]\n            });\n          }\n\n          if (!((_d = error.error) === null || _d === void 0 ? void 0 : _d.errors)) {\n            this.errorMessage = error.message || 'An error occurred during signup.';\n          }\n        }\n      });\n    } else {\n      this.signupForm.markAllAsTouched();\n\n      if ((_a = this.signupForm.errors) === null || _a === void 0 ? void 0 : _a.mismatch) {\n        this.errorMessage = 'Passwords do not match';\n      } else if ((_c = (_b = this.signupForm.get('password')) === null || _b === void 0 ? void 0 : _b.errors) === null || _c === void 0 ? void 0 : _c.minlength) {\n        this.errorMessage = 'Password must be at least 8 characters long';\n      } else if ((_e = (_d = this.signupForm.get('password')) === null || _d === void 0 ? void 0 : _d.errors) === null || _e === void 0 ? void 0 : _e.maxlength) {\n        this.errorMessage = 'Password cannot exceed 15 characters';\n      } else if ((_g = (_f = this.signupForm.get('phone_number')) === null || _f === void 0 ? void 0 : _f.errors) === null || _g === void 0 ? void 0 : _g.pattern) {\n        this.errorMessage = 'Phone number must be exactly 10 digits';\n      } else {\n        this.errorMessage = 'Please fill in all required fields correctly';\n      }\n    }\n  }\n\n  togglePasswordVisibility() {\n    this.passwordType = this.passwordType === 'password' ? 'text' : 'password';\n    this.passwordButtonText = this.passwordType === 'password' ? 'Show' : 'Hide';\n  }\n\n  toggleConfirmPasswordVisibility() {\n    this.confirmPasswordType = this.confirmPasswordType === 'password' ? 'text' : 'password';\n    this.confirmPasswordButtonText = this.confirmPasswordType === 'password' ? 'Show' : 'Hide';\n  }\n\n  navigateToLogin() {\n    this.router.navigate(['/login-corporate']);\n  }\n\n  closePopup() {\n    this.showSuccessPopup = false;\n    this.router.navigate(['/login-corporate']);\n  }\n\n};\n\n__decorate([ContentChild('button')], SignupCorporate1.prototype, \"button\", void 0);\n\n__decorate([ContentChild('text12')], SignupCorporate1.prototype, \"text12\", void 0);\n\n__decorate([ContentChild('text13')], SignupCorporate1.prototype, \"text13\", void 0);\n\n__decorate([ContentChild('text1111')], SignupCorporate1.prototype, \"text1111\", void 0);\n\n__decorate([Input()], SignupCorporate1.prototype, \"rootClassName\", void 0);\n\n__decorate([ContentChild('text')], SignupCorporate1.prototype, \"text\", void 0);\n\n__decorate([ContentChild('text1')], SignupCorporate1.prototype, \"text1\", void 0);\n\n__decorate([ContentChild('text11')], SignupCorporate1.prototype, \"text11\", void 0);\n\n__decorate([ContentChild('text5')], SignupCorporate1.prototype, \"text5\", void 0);\n\n__decorate([ContentChild('text21')], SignupCorporate1.prototype, \"text21\", void 0);\n\n__decorate([ContentChild('text111')], SignupCorporate1.prototype, \"text111\", void 0);\n\n__decorate([ContentChild('text2')], SignupCorporate1.prototype, \"text2\", void 0);\n\n__decorate([ContentChild('text6')], SignupCorporate1.prototype, \"text6\", void 0);\n\n__decorate([ContentChild('text71')], SignupCorporate1.prototype, \"text71\", void 0);\n\n__decorate([ContentChild('heading')], SignupCorporate1.prototype, \"heading\", void 0);\n\nSignupCorporate1 = __decorate([Component({\n  selector: 'signup-corporate1',\n  templateUrl: './signup-corporate1.component.html',\n  styleUrls: ['./signup-corporate1.component.css']\n})], SignupCorporate1);\nexport { SignupCorporate1 };","map":null,"metadata":{},"sourceType":"module"}