{"ast":null,"code":"import { __awaiter, __decorate } from \"tslib\";\nimport { Component, Input, ContentChild, ViewChild, ViewChildren } from '@angular/core';\nimport { Validators } from '@angular/forms';\nlet ProfileCertificationsComponent = class ProfileCertificationsComponent {\n  constructor(fb, http, spinner) {\n    this.fb = fb;\n    this.http = http;\n    this.spinner = spinner;\n    this.rootClassName = '';\n    this.certificationForm = this.fb.group({\n      certifications: this.fb.array([this.createCertificationGroup()])\n    });\n  }\n\n  ngOnInit() {\n    const today = new Date();\n    this.todayDate = today.toISOString().split('T')[0];\n  }\n\n  get certifications() {\n    return this.certificationForm.get('certifications');\n  }\n\n  createCertificationGroup() {\n    return this.fb.group({\n      certificate_name: ['', Validators.required],\n      issuing_institute: ['', Validators.required],\n      issued_date: ['', Validators.required],\n      renewal_date: [''],\n      credentials: ['', Validators.required]\n    });\n  }\n\n  addCertification() {\n    this.certifications.push(this.createCertificationGroup()); // Wait for the DOM to update, then scroll to the last block within the container\n\n    setTimeout(() => {\n      this.scrollToLastCertification();\n    }, 0);\n  }\n\n  removeCertification(index) {\n    if (this.certifications.length > 1) {\n      this.certifications.removeAt(index);\n    }\n  }\n\n  scrollToLastCertification() {\n    const blocks = this.certificationBlocks.toArray();\n\n    if (blocks.length > 0 && this.scrollContainer) {\n      const lastBlock = blocks[blocks.length - 1].nativeElement;\n      const container = this.scrollContainer.nativeElement;\n      const blockOffsetTop = lastBlock.offsetTop - container.offsetTop;\n      container.scrollTo({\n        top: blockOffsetTop,\n        behavior: 'smooth'\n      });\n    }\n  }\n\n  updateRenewalDateMin(index) {\n    var _a;\n\n    const certification = this.certifications.at(index);\n    const issuedDate = (_a = certification.get('issued_date')) === null || _a === void 0 ? void 0 : _a.value;\n    const renewalDateControl = certification.get('renewal_date');\n\n    if (issuedDate) {\n      const renewalDate = renewalDateControl === null || renewalDateControl === void 0 ? void 0 : renewalDateControl.value;\n      const today = new Date(this.todayDate);\n      const issued = new Date(issuedDate);\n      const renewal = renewalDate ? new Date(renewalDate) : null;\n\n      if (renewal && (renewal < issued || renewal > today)) {\n        renewalDateControl === null || renewalDateControl === void 0 ? void 0 : renewalDateControl.setValue('');\n      }\n    }\n  }\n\n  submitCertification() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.certificationForm.valid) {\n        const data = this.certificationForm.value.certifications;\n        const promises = data.map(cert => this.http.post('http://localhost:8000/api/certifications/', cert, {\n          withCredentials: true\n        }).toPromise().then(response => {\n          console.log('Certification saved:', response);\n        }).catch(error => {\n          console.error('Error saving certification:', error);\n          throw error;\n        })); // Show spinner before making requests\n\n        this.spinner.show();\n\n        try {\n          yield Promise.all(promises);\n          this.certificationForm.reset();\n          this.certifications.clear();\n          this.certifications.push(this.createCertificationGroup());\n        } catch (error) {// Error already logged in catch block above\n        } finally {\n          // Hide spinner after all requests are completed\n          this.spinner.hide();\n        }\n      } else {\n        console.log('Form is invalid');\n      }\n    });\n  }\n\n};\n\n__decorate([ContentChild('text1')], ProfileCertificationsComponent.prototype, \"text1\", void 0);\n\n__decorate([ContentChild('text312')], ProfileCertificationsComponent.prototype, \"text312\", void 0);\n\n__decorate([ContentChild('text1111')], ProfileCertificationsComponent.prototype, \"text1111\", void 0);\n\n__decorate([ContentChild('text311')], ProfileCertificationsComponent.prototype, \"text311\", void 0);\n\n__decorate([ContentChild('text1121')], ProfileCertificationsComponent.prototype, \"text1121\", void 0);\n\n__decorate([ContentChild('text3121')], ProfileCertificationsComponent.prototype, \"text3121\", void 0);\n\n__decorate([ContentChild('text11')], ProfileCertificationsComponent.prototype, \"text11\", void 0);\n\n__decorate([Input()], ProfileCertificationsComponent.prototype, \"rootClassName\", void 0);\n\n__decorate([ContentChild('text112')], ProfileCertificationsComponent.prototype, \"text112\", void 0);\n\n__decorate([ContentChild('text111')], ProfileCertificationsComponent.prototype, \"text111\", void 0);\n\n__decorate([ContentChild('text')], ProfileCertificationsComponent.prototype, \"text\", void 0);\n\n__decorate([ContentChild('text31')], ProfileCertificationsComponent.prototype, \"text31\", void 0);\n\n__decorate([ContentChild('text3111')], ProfileCertificationsComponent.prototype, \"text3111\", void 0);\n\n__decorate([ViewChild('scrollContainer', {\n  static: false\n})], ProfileCertificationsComponent.prototype, \"scrollContainer\", void 0);\n\n__decorate([ViewChildren('certificationBlock')], ProfileCertificationsComponent.prototype, \"certificationBlocks\", void 0);\n\nProfileCertificationsComponent = __decorate([Component({\n  selector: 'profile-certifications-component',\n  templateUrl: 'profile-certifications-component.component.html',\n  styleUrls: ['profile-certifications-component.component.css']\n})], ProfileCertificationsComponent);\nexport { ProfileCertificationsComponent };","map":null,"metadata":{},"sourceType":"module"}