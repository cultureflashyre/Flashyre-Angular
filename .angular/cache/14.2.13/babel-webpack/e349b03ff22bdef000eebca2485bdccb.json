{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, Input, ContentChild, ViewChildren, Output, EventEmitter } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { forkJoin } from 'rxjs';\nlet ProfileEducationComponent = class ProfileEducationComponent {\n  constructor(fb, educationService, router) {\n    this.fb = fb;\n    this.educationService = educationService;\n    this.router = router;\n    /** Input and Output decorators */\n\n    this.rootClassName = '';\n    this.formsUpdated = new EventEmitter();\n    /** Form and data properties */\n\n    this.educationForms = [];\n    this.years = Array.from({\n      length: 50\n    }, (_, i) => new Date().getFullYear() - i);\n    this.months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n    this.universities = [];\n    this.educationLevels = [];\n    this.courses = [];\n    this.specializations = [];\n    this.todayDate = new Date().toISOString().split('T')[0];\n    this.addNewForm(); // Initialize with one form\n\n    this.loadReferenceData(); // Fetch reference data on init\n  }\n\n  ngAfterViewInit() {\n    console.log('Education component view initialized');\n    console.log('Universities in view:', this.universities);\n    console.log('Education Levels in view:', this.educationLevels);\n    console.log('Courses in view:', this.courses);\n    console.log('Specializations in view:', this.specializations);\n  }\n  /**\r\n   * Fetches reference data from the backend\r\n   */\n\n\n  loadReferenceData() {\n    this.educationService.getReferenceData().subscribe({\n      next: data => {\n        console.log('Fetched Data:', data);\n        this.universities = data.colleges || [];\n        this.educationLevels = data.education_levels || [];\n        this.courses = data.courses || [];\n        this.specializations = data.specializations || []; // Apply fallback data if arrays are empty\n\n        if (this.universities.length === 0) {\n          console.log('No universities found, applying fallback data');\n          this.universities = [{\n            name: 'MIT'\n          }, {\n            name: 'Stanford'\n          }];\n        }\n\n        if (this.educationLevels.length === 0) {\n          console.log('No education levels found, applying fallback data');\n          this.educationLevels = [{\n            name: \"Bachelor's\"\n          }, {\n            name: \"Master's\"\n          }];\n        }\n\n        if (this.courses.length === 0) {\n          console.log('No courses found, applying fallback data');\n          this.courses = [{\n            name: 'Computer Science'\n          }, {\n            name: 'Engineering'\n          }];\n        }\n\n        if (this.specializations.length === 0) {\n          console.log('No specializations found, applying fallback data');\n          this.specializations = [{\n            name: 'AI'\n          }, {\n            name: 'Data Science'\n          }];\n        }\n\n        console.log('Universities assigned:', this.universities);\n        console.log('Education Levels assigned:', this.educationLevels);\n        console.log('Courses assigned:', this.courses);\n        console.log('Specializations assigned:', this.specializations);\n      },\n      error: error => {\n        console.error('Failed to load reference data. Full error:', error);\n        alert(`Error loading dropdown data: ${error.message || 'Unknown error. Check console for details.'}`); // Fallback data to test dropdowns\n\n        this.universities = [{\n          name: 'MIT'\n        }, {\n          name: 'Stanford'\n        }];\n        this.educationLevels = [{\n          name: \"Bachelor's\"\n        }, {\n          name: \"Master's\"\n        }];\n        this.courses = [{\n          name: 'Computer Science'\n        }, {\n          name: 'Engineering'\n        }];\n        this.specializations = [{\n          name: 'AI'\n        }, {\n          name: 'Data Science'\n        }];\n        console.log('Fallback data applied:');\n        console.log('Universities:', this.universities);\n        console.log('Education Levels:', this.educationLevels);\n        console.log('Courses:', this.courses);\n        console.log('Specializations:', this.specializations);\n      }\n    });\n  }\n  /**\r\n   * Creates a new education form with validation\r\n   */\n\n\n  createEducationForm() {\n    return this.fb.group({\n      startDate: ['', Validators.required],\n      endDate: ['', Validators.required],\n      university: ['', Validators.required],\n      educationLevel: ['', Validators.required],\n      course: ['', Validators.required],\n      specialization: ['', Validators.required]\n    }, {\n      validators: this.dateRangeValidator\n    });\n  }\n  /**\r\n   * Custom validator to ensure end date is not before start date\r\n   */\n\n\n  dateRangeValidator(form) {\n    var _a, _b;\n\n    const startDate = (_a = form.get('startDate')) === null || _a === void 0 ? void 0 : _a.value;\n    const endDate = (_b = form.get('endDate')) === null || _b === void 0 ? void 0 : _b.value;\n\n    if (startDate && endDate && new Date(endDate) < new Date(startDate)) {\n      return {\n        dateRangeInvalid: true\n      };\n    }\n\n    return null;\n  }\n  /**\r\n   * Adds a new form, emits the updated forms, and scrolls to it\r\n   */\n\n\n  addNewForm() {\n    this.educationForms.push(this.createEducationForm());\n    this.formsUpdated.emit(this.educationForms);\n    setTimeout(() => {\n      const lastForm = this.educationFormInstances.last;\n\n      if (lastForm) {\n        lastForm.nativeElement.scrollIntoView({\n          behavior: 'smooth',\n          block: 'start'\n        });\n      }\n    }, 0); // Delay to ensure DOM updates\n  }\n  /**\r\n   * Removes a form by index and emits the updated forms\r\n   */\n\n\n  removeForm(index) {\n    this.educationForms.splice(index, 1);\n    this.formsUpdated.emit(this.educationForms);\n  }\n  /**\r\n   * Saves all valid forms to the backend\r\n   */\n\n\n  saveEducation() {\n    return new Promise(resolve => {\n      const validForms = this.educationForms.filter(form => form.valid);\n\n      if (validForms.length === 0) {\n        console.log('No valid forms to save');\n        resolve(true); // Nothing to save, treat as success\n\n        return;\n      }\n\n      const saveObservables = validForms.map(form => {\n        const data = {\n          select_start_date: form.value.startDate,\n          select_end_date: form.value.endDate,\n          university: form.value.university,\n          education_level: form.value.educationLevel,\n          course: form.value.course,\n          specialization: form.value.specialization\n        };\n        return this.educationService.addEducation(data);\n      });\n      forkJoin(saveObservables).subscribe({\n        next: () => {\n          this.formsUpdated.emit(this.educationForms);\n          console.log('All educations saved successfully');\n          resolve(true);\n        },\n        error: error => {\n          var _a;\n\n          console.error('Error saving educations:', error);\n          alert('Error saving education data: ' + (((_a = error.error) === null || _a === void 0 ? void 0 : _a.detail) || 'Unknown error'));\n          resolve(false);\n        }\n      });\n    });\n  }\n\n  goToPrevious() {\n    this.router.navigate(['/profile-employment-page']);\n  }\n\n  skipToNextSection() {\n    console.log('Skipping to next section');\n    this.router.navigate(['/profile-certification-page']);\n  }\n\n};\n\n__decorate([ContentChild('text3136')], ProfileEducationComponent.prototype, \"text3136\", void 0);\n\n__decorate([ContentChild('text313')], ProfileEducationComponent.prototype, \"text313\", void 0);\n\n__decorate([ContentChild('text3137')], ProfileEducationComponent.prototype, \"text3137\", void 0);\n\n__decorate([ContentChild('text1112')], ProfileEducationComponent.prototype, \"text1112\", void 0);\n\n__decorate([ContentChild('text111')], ProfileEducationComponent.prototype, \"text111\", void 0);\n\n__decorate([ContentChild('text112')], ProfileEducationComponent.prototype, \"text112\", void 0);\n\n__decorate([ContentChild('text3132')], ProfileEducationComponent.prototype, \"text3132\", void 0);\n\n__decorate([ContentChild('text3131')], ProfileEducationComponent.prototype, \"text3131\", void 0);\n\n__decorate([ContentChild('text314')], ProfileEducationComponent.prototype, \"text314\", void 0);\n\n__decorate([ContentChild('text')], ProfileEducationComponent.prototype, \"text\", void 0);\n\n__decorate([ContentChild('text1111')], ProfileEducationComponent.prototype, \"text1111\", void 0);\n\n__decorate([ContentChild('text2')], ProfileEducationComponent.prototype, \"text2\", void 0);\n\n__decorate([ContentChild('text1')], ProfileEducationComponent.prototype, \"text1\", void 0);\n\n__decorate([Input()], ProfileEducationComponent.prototype, \"rootClassName\", void 0);\n\n__decorate([Output()], ProfileEducationComponent.prototype, \"formsUpdated\", void 0);\n\n__decorate([ViewChildren('educationFormInstance')], ProfileEducationComponent.prototype, \"educationFormInstances\", void 0);\n\nProfileEducationComponent = __decorate([Component({\n  selector: 'profile-education-component',\n  templateUrl: './profile-education-component.component.html',\n  styleUrls: ['./profile-education-component.component.css']\n})], ProfileEducationComponent);\nexport { ProfileEducationComponent };","map":null,"metadata":{},"sourceType":"module"}