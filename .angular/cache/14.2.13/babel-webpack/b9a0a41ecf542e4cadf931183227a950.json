{"ast":null,"code":"import { HttpHeaders, HttpErrorResponse } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\nimport { environment } from '../../environments/environment'; // Ensure this path is correct\n\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let JobDescriptionService = /*#__PURE__*/(() => {\n  class JobDescriptionService {\n    constructor(http) {\n      this.http = http; // Base API URL from environment configuration (e.g., 'http://localhost:8000/api')\n\n      this.apiUrl = environment.apiUrl;\n    }\n    /**\r\n     * Uploads a file, processes it with AI for job details (NO MCQs).\r\n     * @param file The file to upload\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with file URL, unique ID, and job details.\r\n     */\n\n\n    uploadFile(file, token) {\n      if (!file) {\n        console.error('No file provided for upload');\n        return throwError(() => new Error('No file selected for upload'));\n      }\n\n      if (file.size > 10 * 1024 * 1024) {\n        return throwError(() => new Error('File size exceeds 10MB'));\n      }\n\n      const allowedExtensions = ['.pdf', '.docx', '.txt', '.xml', '.csv', '.doc'];\n      const ext = file.name.toLowerCase().split('.').pop();\n\n      if (!ext || !allowedExtensions.includes(`.${ext}`)) {\n        return throwError(() => new Error(`Invalid file format. Supported: ${allowedExtensions.join(', ')}`));\n      }\n\n      const formData = new FormData();\n      formData.append('file', file, file.name);\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}` // 'Content-Type' is not set for FormData, browser handles it with boundary\n\n      }); // Corrected URL construction:\n\n      const endpoint = `${this.apiUrl}/file-upload/`;\n      return this.http.post(endpoint, formData, {\n        headers\n      }).pipe(map(response => {\n        var _a;\n\n        if (response.status === 'success' && response.data) {\n          return response.data;\n        }\n\n        throw new Error(((_a = response.data) === null || _a === void 0 ? void 0 : _a.toString()) || 'Unexpected response structure during file upload');\n      }), catchError(error => this.handleError(error, 'uploadFile')));\n    }\n    /**\r\n     * Saves or updates a job post by sending a POST request to the backend.\r\n     * @param jobDetails The job post details to save or update.\r\n     * @param token JWT token for authentication.\r\n     * @returns Observable with the response containing unique_id and message.\r\n     */\n\n\n    saveJobPost(jobDetails, token) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }); // Corrected URL construction:\n\n      const endpoint = `${this.apiUrl}/job-post/`;\n      return this.http.post(endpoint, jobDetails, {\n        headers\n      }).pipe(map(response => {\n        if (response.status === 'success' && response.data) {\n          return {\n            unique_id: response.data.unique_id,\n            message: response.data.message\n          };\n        } // If status is 'error' but a 2xx response (unlikely but possible)\n\n\n        if (response.status === 'error' && response.errors) {\n          throw new HttpErrorResponse({\n            error: response,\n            status: 400\n          }); // Simulate an error\n        }\n\n        throw new Error('Unexpected response status or missing data during save job post');\n      }), catchError(error => this.handleError(error, 'saveJobPost')));\n    }\n    /**\r\n     * *** NEW METHOD as per the plan ***\r\n     * Triggers the backend to generate MCQs for a specific job post.\r\n     * @param uniqueId The unique ID of the job post.\r\n     * @param token JWT token for authentication.\r\n     */\n\n\n    generateMcqsForJob(uniqueId, token) {\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`\n      });\n      const endpoint = `${this.apiUrl}/job-post/${uniqueId}/generate-mcqs/`; // The body is an empty object {} because the required data (uniqueId) is in the URL.\n\n      return this.http.post(endpoint, {}, {\n        headers\n      }).pipe(map(response => {\n        if (response.status === 'success') {\n          return response;\n        } // If status is not 'success', throw an error with the backend message\n\n\n        throw new Error(response.message || 'Failed to generate MCQs due to an unknown server issue.');\n      }), catchError(error => this.handleError(error, 'generateMcqsForJob')));\n    }\n    /**\r\n     * Updates the status of a job post\r\n     * @param uniqueId Unique identifier of the job post\r\n     * @param status New status ('draft' or 'final')\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with success message and unique_id\r\n     */\n\n\n    updateJobPostStatus(uniqueId, status, token) {\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      });\n      const payload = {\n        unique_id: uniqueId,\n        status\n      };\n      const endpoint = `${this.apiUrl}/job-post/update-status/`;\n      return this.http.post(endpoint, payload, {\n        headers\n      }).pipe(map(response => {\n        if (response.status === 'success' && response.data) {\n          return response.data;\n        }\n\n        throw new Error('Unexpected response structure during status update');\n      }), catchError(error => this.handleError(error, 'updateJobPostStatus')));\n    }\n    /**\r\n     * Soft deletes a job post\r\n     * @param uniqueId Unique identifier of the job post\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with success message and unique_id\r\n     */\n\n\n    deleteJobPost(uniqueId, token) {\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json' // Django expects body for delete with unique_id\n\n      });\n      const payload = {\n        unique_id: uniqueId\n      };\n      const endpoint = `${this.apiUrl}/job-post/delete/`;\n      return this.http.delete(endpoint, {\n        headers,\n        body: payload\n      } // Send payload in body for DELETE\n      ).pipe(map(response => {\n        if (response.status === 'success' && response.data) {\n          return response.data;\n        }\n\n        throw new Error('Unexpected response structure during delete job post');\n      }), catchError(error => this.handleError(error, 'deleteJobPost')));\n    }\n    /**\r\n     * Soft deletes an uploaded file\r\n     * @param uniqueId Unique identifier of the file\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with success message and unique_id\r\n     */\n\n\n    deleteFile(uniqueId, token) {\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json' // Django expects body for delete with unique_id\n\n      });\n      const payload = {\n        unique_id: uniqueId\n      };\n      const endpoint = `${this.apiUrl}/file-upload/delete/`;\n      return this.http.delete(endpoint, {\n        headers,\n        body: payload\n      } // Send payload in body for DELETE\n      ).pipe(map(response => {\n        if (response.status === 'success' && response.data) {\n          return response.data;\n        }\n\n        throw new Error('Unexpected response structure during delete file');\n      }), catchError(error => this.handleError(error, 'deleteFile')));\n    }\n    /**\r\n     * Lists all job posts for the authenticated user (paginated)\r\n     * @param token JWT token for authentication\r\n     * @param page Page number for pagination (optional)\r\n     * @returns Observable with paginated job posts\r\n     */\n\n\n    listJobPosts(token, page) {\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`\n      });\n      let endpoint = `${this.apiUrl}/job-post/`;\n\n      if (page) {\n        endpoint += `?page=${page}`;\n      }\n\n      return this.http.get(endpoint, {\n        headers\n      }).pipe(map(response => {\n        if (response.status === 'success' && response.data) {\n          return response.data;\n        }\n\n        throw new Error('Unexpected response structure when listing job posts');\n      }), catchError(error => this.handleError(error, 'listJobPosts')));\n    }\n    /**\r\n     * Retrieves a single job post by unique_id\r\n     * @param uniqueId Unique identifier of the job post\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with job post details\r\n     */\n\n\n    getJobPost(uniqueId, token) {\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`\n      });\n      const endpoint = `${this.apiUrl}/job-post/${uniqueId}/`;\n      return this.http.get(endpoint, {\n        headers\n      }).pipe(map(response => {\n        if (response.status === 'success' && response.data) {\n          return response.data;\n        }\n\n        throw new Error('Unexpected response structure when fetching a single job post');\n      }), catchError(error => this.handleError(error, 'getJobPost')));\n    }\n    /**\r\n     * Handles HTTP errors and formats error messages for user display.\r\n     * @param error The HTTP error response.\r\n     * @param operation The name of the operation that failed (for logging).\r\n     * @returns Observable that throws a formatted error.\r\n     */\n\n\n    handleError(error, operation = 'operation') {\n      let errorMessage = `An unknown error occurred during ${operation}`;\n\n      if (error.error instanceof ErrorEvent) {\n        // Client-side error (e.g., network issue)\n        errorMessage = `Client-side error in ${operation}: ${error.error.message}`;\n      } else {\n        // Server-side error\n        const serverError = error.error;\n\n        if (serverError) {\n          if (serverError.status === 'error') {\n            if (serverError.message) {\n              errorMessage = serverError.message;\n            }\n\n            if (serverError.errors && typeof serverError.errors === 'object') {\n              const fieldErrors = Object.keys(serverError.errors).map(key => `${key}: ${Array.isArray(serverError.errors[key]) ? serverError.errors[key].join(', ') : serverError.errors[key]}`).join('; ');\n\n              if (fieldErrors) {\n                errorMessage = fieldErrors; // Prioritize specific field errors\n              } else if (!serverError.message) {\n                errorMessage = `Validation errors occurred in ${operation}.`;\n              }\n            } else if (serverError.errors && typeof serverError.errors === 'string') {\n              errorMessage = serverError.errors;\n            } else if (!serverError.message && !serverError.errors) {\n              errorMessage = `An error occurred on the server during ${operation}.`;\n            }\n          } else if (serverError.detail) {\n            // Standard DRF error\n            errorMessage = serverError.detail;\n          } else if (typeof serverError === 'string') {\n            // Plain text error response\n            errorMessage = serverError;\n          } else {\n            errorMessage = `Server error ${error.status} in ${operation}: ${error.message || 'No specific message'}`;\n          }\n        } else {\n          errorMessage = `HTTP ${error.status} in ${operation}: ${error.statusText || error.message || 'Server error'}`;\n        }\n      }\n\n      console.error(`Operation: ${operation} failed. Status: ${error.status}. Message: ${errorMessage}. Full Error:`, error);\n      return throwError(() => new Error(errorMessage));\n    }\n\n  }\n\n  JobDescriptionService.ɵfac = function JobDescriptionService_Factory(t) {\n    return new (t || JobDescriptionService)(i0.ɵɵinject(i1.HttpClient));\n  };\n\n  JobDescriptionService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: JobDescriptionService,\n    factory: JobDescriptionService.ɵfac,\n    providedIn: 'root'\n  });\n  return JobDescriptionService;\n})();","map":null,"metadata":{},"sourceType":"module"}