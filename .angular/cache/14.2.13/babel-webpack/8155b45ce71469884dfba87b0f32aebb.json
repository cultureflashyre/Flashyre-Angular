{"ast":null,"code":"import { __awaiter, __decorate } from \"tslib\";\nimport { Component, ViewChild } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { Subject } from 'rxjs';\nimport { debounceTime, distinctUntilChanged, switchMap } from 'rxjs/operators';\nlet CreateJobPost1stPageComponent = class CreateJobPost1stPageComponent {\n  constructor(title, // Service for setting page title\n  meta, // Service for setting meta tags\n  fb, // FormBuilder for reactive forms\n  snackBar, // Material snackbar for notifications\n  jobDescriptionService, // Service for job-related API calls\n  corporateAuthService // Service for corporate authentication\n  ) {\n    this.title = title;\n    this.meta = meta;\n    this.fb = fb;\n    this.snackBar = snackBar;\n    this.jobDescriptionService = jobDescriptionService;\n    this.corporateAuthService = corporateAuthService; // RxJS subject for location search terms\n\n    this.searchTerms = new Subject(); // Location autocomplete suggestions\n\n    this.suggestions = []; // Loading state for autocomplete\n\n    this.isLoading = false; // Show/hide suggestions dropdown\n\n    this.showSuggestions = false; // File selected for upload\n\n    this.selectedFile = null; // Debounce delay for location search\n\n    this.DEBOUNCE_DELAY = 300; // Placeholder for real location API (e.g., Google Places API)\n\n    this.LOCATION_API_URL = 'https://api.example.com/locations/autocomplete'; // Initialize reactive form with validators\n\n    this.jobForm = this.fb.group({\n      role: ['', [Validators.required, Validators.maxLength(100)]],\n      location: ['', [Validators.required, Validators.maxLength(200)]],\n      job_type: ['', [Validators.required]],\n      workplace_type: ['', [Validators.required]],\n      total_experience_min: [0, [Validators.required, Validators.min(0)]],\n      total_experience_max: [0, [Validators.required, Validators.min(0)]],\n      relevant_experience_min: [0, [Validators.required, Validators.min(0)]],\n      relevant_experience_max: [0, [Validators.required, Validators.min(0)]],\n      budget_type: ['', [Validators.required]],\n      min_budget: [0, [Validators.required, Validators.min(0)]],\n      max_budget: [0, [Validators.required, Validators.min(0)]],\n      notice_period: ['', [Validators.required, Validators.maxLength(50)]],\n      skills: [[], [Validators.required]],\n      job_description: ['', [Validators.maxLength(5000)]],\n      job_description_url: ['', [Validators.maxLength(200)]],\n      unique_id: ['']\n    }, {\n      validators: this.experienceRangeValidator\n    }); // Set page title and meta tags for SEO\n\n    this.title.setTitle('Create Job Post - Flashyre');\n    this.meta.addTags([{\n      property: 'og:title',\n      content: 'Create Job Post - Flashyre'\n    }, {\n      property: 'og:image',\n      content: 'https://aheioqhobo.cloudimg.io/v7/_playground-bucket-v2.teleporthq.io_/8203932d-6f2d-4493-a7b2-7000ee521aa2/9aea8e9c-27ce-4011-a345-94a92ae2dbf8?org_if_sml=1&force_format=original'\n    }]); // Setup location autocomplete search\n\n    this.setupSearch();\n  }\n\n  ngOnInit() {\n    // Retrieve token from CorporateAuthService\n    this.corporateAuthService.getAuthState().subscribe(auth => {\n      if (!auth.token) {\n        this.snackBar.open('Please log in to create a job post.', 'Close', {\n          duration: 5000\n        });\n      }\n    });\n  } // Custom validator for experience ranges\n\n\n  experienceRangeValidator(form) {\n    var _a, _b, _c, _d;\n\n    const totalMin = (_a = form.get('total_experience_min')) === null || _a === void 0 ? void 0 : _a.value;\n    const totalMax = (_b = form.get('total_experience_max')) === null || _b === void 0 ? void 0 : _b.value;\n    const relevantMin = (_c = form.get('relevant_experience_min')) === null || _c === void 0 ? void 0 : _c.value;\n    const relevantMax = (_d = form.get('relevant_experience_max')) === null || _d === void 0 ? void 0 : _d.value;\n\n    if (totalMin > totalMax) {\n      return {\n        invalidTotalExperience: true\n      };\n    }\n\n    if (relevantMin > relevantMax) {\n      return {\n        invalidRelevantExperience: true\n      };\n    }\n\n    return null;\n  } // Handle file selection\n\n\n  onFileSelected(event) {\n    const input = event.target;\n\n    if (input.files && input.files.length > 0) {\n      this.selectedFile = input.files[0];\n    }\n  } // Upload file and trigger AI processing\n\n\n  uploadFile() {\n    if (!this.selectedFile) {\n      this.snackBar.open('Please select a file to upload.', 'Close', {\n        duration: 5000\n      });\n      return;\n    } // Validate file type\n\n\n    const allowedExtensions = ['.pdf', '.docx', '.doc'];\n    const ext = this.selectedFile.name.toLowerCase().substring(this.selectedFile.name.lastIndexOf('.'));\n\n    if (!allowedExtensions.includes(ext)) {\n      this.snackBar.open('Invalid file format. Supported: PDF, DOCX, DOC.', 'Close', {\n        duration: 5000\n      });\n      return;\n    } // Get token from CorporateAuthService\n\n\n    this.corporateAuthService.getAuthState().subscribe(auth => {\n      if (!auth.token) {\n        this.snackBar.open('Authentication required. Please log in.', 'Close', {\n          duration: 5000\n        });\n        return;\n      } // Upload file to Django backend\n\n\n      this.jobDescriptionService.uploadFile(this.selectedFile, auth.token).subscribe({\n        next: response => {\n          this.jobForm.patchValue({\n            job_description_url: response.file_url,\n            unique_id: response.unique_id\n          });\n          this.snackBar.open('File uploaded successfully.', 'Close', {\n            duration: 3000\n          }); // Trigger AI processing\n\n          this.processJobDescription(response.file_url, response.unique_id, auth.token);\n        },\n        error: error => {\n          var _a;\n\n          this.snackBar.open(`File upload failed: ${((_a = error.error) === null || _a === void 0 ? void 0 : _a.error) || 'Unknown error'}`, 'Close', {\n            duration: 5000\n          });\n          console.error('File upload failed:', error);\n        }\n      });\n    });\n  } // Process job description using AI\n\n\n  processJobDescription(fileUrl, uniqueId, token) {\n    this.jobDescriptionService.processJobDescription(fileUrl, uniqueId, token).subscribe({\n      next: response => {\n        // Store MCQs in local storage\n        localStorage.setItem('job_mcqs', JSON.stringify(response.mcqs)); // Populate form with AI response\n\n        this.populateForm(response);\n        this.snackBar.open('Job description processed successfully.', 'Close', {\n          duration: 3000\n        });\n      },\n      error: error => {\n        var _a;\n\n        this.snackBar.open(`AI processing failed: ${((_a = error.error) === null || _a === void 0 ? void 0 : _a.error) || 'Unknown error'}`, 'Close', {\n          duration: 5000\n        });\n        console.error('AI processing failed:', error);\n      }\n    });\n  } // Populate form with AI response data\n\n\n  populateForm(jobData) {\n    var _a, _b, _c;\n\n    const jobDetails = jobData.job_details;\n    const [minExp, maxExp] = this.parseExperience(((_a = jobDetails.experience) === null || _a === void 0 ? void 0 : _a.value) || '0-0 years');\n    this.jobForm.patchValue({\n      role: ((_b = jobDetails.job_titles[0]) === null || _b === void 0 ? void 0 : _b.value) || 'Unknown',\n      location: jobDetails.location || 'Unknown',\n      job_type: this.mapJobType(((_c = jobDetails.job_titles[0]) === null || _c === void 0 ? void 0 : _c.value) || ''),\n      workplace_type: jobDetails.workplace_type || 'Remote',\n      total_experience_min: minExp,\n      total_experience_max: maxExp,\n      relevant_experience_min: Math.max(0, minExp - 1),\n      relevant_experience_max: Math.min(maxExp, minExp + 2),\n      budget_type: jobDetails.budget_type || 'Annually',\n      min_budget: jobDetails.min_budget || 0,\n      max_budget: jobDetails.max_budget || 0,\n      notice_period: jobDetails.notice_period || '30 days',\n      skills: [...(jobDetails.skills.primary || []).map(s => s.skill), ...(jobDetails.skills.secondary || []).map(s => s.skill)],\n      job_description: jobDetails.job_description || '',\n      unique_id: jobData.unique_id\n    });\n  } // Map job title to job type\n\n\n  mapJobType(title) {\n    const lowerTitle = title.toLowerCase();\n    if (lowerTitle.includes('intern')) return 'Internship';\n    if (lowerTitle.includes('contract')) return 'Contract';\n    if (lowerTitle.includes('part-time')) return 'Part-time';\n    return 'Permanent';\n  } // Parse experience range from string\n\n\n  parseExperience(exp) {\n    const match = exp.match(/(\\d+)-(\\d+)/);\n    return match ? [parseInt(match[1]), parseInt(match[2])] : [0, 0];\n  } // Setup location autocomplete search\n\n\n  setupSearch() {\n    this.searchTerms.pipe(debounceTime(this.DEBOUNCE_DELAY), distinctUntilChanged(), switchMap(query => {\n      this.isLoading = true;\n      return this.fetchLocationSuggestions(query);\n    })).subscribe({\n      next: suggestions => {\n        this.suggestions = suggestions;\n        this.showSuggestions = suggestions.length > 0;\n        this.isLoading = false;\n      },\n      error: error => {\n        this.snackBar.open('Failed to fetch location suggestions.', 'Close', {\n          duration: 5000\n        });\n        this.suggestions = [];\n        this.showSuggestions = false;\n        this.isLoading = false;\n        console.error('Error fetching location suggestions:', error);\n      }\n    });\n  } // Handle location input\n\n\n  onInput(event) {\n    const query = event.target.value.trim();\n\n    if (query.length === 0) {\n      this.showSuggestions = false;\n      this.suggestions = [];\n      return;\n    }\n\n    this.searchTerms.next(query);\n  } // Fetch location suggestions (mock implementation)\n\n\n  fetchLocationSuggestions(query) {\n    return __awaiter(this, void 0, void 0, function* () {\n      // TODO: Replace with real API call (e.g., Google Places API)\n      yield new Promise(resolve => setTimeout(resolve, 500));\n      return this.getMockSuggestions(query);\n    });\n  } // Mock location suggestions\n\n\n  getMockSuggestions(query) {\n    query = query.toLowerCase();\n    const cities = ['Multiple', 'New York, NY, USA', 'Los Angeles, CA, USA', 'Chicago, IL, USA', 'Houston, TX, USA', 'Phoenix, AZ, USA', 'Philadelphia, PA, USA', 'San Antonio, TX, USA', 'San Diego, CA, USA', 'Dallas, TX, USA', 'San Jose, CA, USA', 'London, UK', 'Paris, France', 'Tokyo, Japan', 'Sydney, Australia', 'Toronto, Canada'];\n    return cities.filter(city => city.toLowerCase().includes(query));\n  } // Select a location suggestion\n\n\n  selectSuggestion(location) {\n    this.jobForm.patchValue({\n      location\n    });\n    this.showSuggestions = false;\n    this.suggestions = [];\n  } // Handle clicks outside suggestions dropdown\n\n\n  handleOutsideClick(event) {\n    const target = event.target;\n\n    if (this.suggestionsContainer && !this.suggestionsContainer.nativeElement.contains(target) && target !== this.locationInput.nativeElement) {\n      this.showSuggestions = false;\n    }\n  } // Submit job post\n\n\n  submitJobPost() {\n    if (this.jobForm.invalid) {\n      this.snackBar.open('Please fill all required fields correctly.', 'Close', {\n        duration: 5000\n      });\n      this.jobForm.markAllAsTouched();\n      return;\n    }\n\n    this.corporateAuthService.getAuthState().subscribe(auth => {\n      if (!auth.token) {\n        this.snackBar.open('Authentication required. Please log in.', 'Close', {\n          duration: 5000\n        });\n        return;\n      }\n\n      const jobDetails = this.jobForm.value; // Format skills as JSON object to match Django JobPostSerializer\n\n      jobDetails.skills = {\n        primary: jobDetails.skills.slice(0, Math.ceil(jobDetails.skills.length / 2)),\n        secondary: jobDetails.skills.slice(Math.ceil(jobDetails.skills.length / 2))\n      };\n      this.jobDescriptionService.saveJobPost(jobDetails, auth.token).subscribe({\n        next: () => {\n          this.snackBar.open('Job post created successfully.', 'Close', {\n            duration: 3000\n          });\n          this.resetForm();\n        },\n        error: error => {\n          var _a;\n\n          this.snackBar.open(`Job post creation failed: ${((_a = error.error) === null || _a === void 0 ? void 0 : _a.error) || 'Unknown error'}`, 'Close', {\n            duration: 5000\n          });\n          console.error('Job post creation failed:', error);\n        }\n      });\n    });\n  } // Reset form and file input\n\n\n  resetForm() {\n    this.jobForm.reset({\n      role: '',\n      location: '',\n      job_type: '',\n      workplace_type: '',\n      total_experience_min: 0,\n      total_experience_max: 0,\n      relevant_experience_min: 0,\n      relevant_experience_max: 0,\n      budget_type: '',\n      min_budget: 0,\n      max_budget: 0,\n      notice_period: '',\n      skills: [],\n      job_description: '',\n      job_description_url: '',\n      unique_id: ''\n    });\n    this.selectedFile = null;\n\n    if (this.fileInput) {\n      this.fileInput.nativeElement.value = '';\n    }\n  }\n\n};\n\n__decorate([ViewChild('locationInput')], CreateJobPost1stPageComponent.prototype, \"locationInput\", void 0);\n\n__decorate([ViewChild('suggestionsContainer')], CreateJobPost1stPageComponent.prototype, \"suggestionsContainer\", void 0);\n\n__decorate([ViewChild('fileInput')], CreateJobPost1stPageComponent.prototype, \"fileInput\", void 0);\n\nCreateJobPost1stPageComponent = __decorate([Component({\n  selector: 'create-job-post1st-page',\n  templateUrl: './create-job-post-1st-page.component.html',\n  styleUrls: ['./create-job-post-1st-page.component.css']\n})], CreateJobPost1stPageComponent);\nexport { CreateJobPost1stPageComponent };","map":null,"metadata":{},"sourceType":"module"}