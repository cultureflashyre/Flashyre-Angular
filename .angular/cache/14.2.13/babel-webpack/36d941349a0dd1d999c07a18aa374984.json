{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, ViewChildren, Input } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { forkJoin } from 'rxjs';\nimport { tap, catchError } from 'rxjs/operators';\nlet ProfileEducationComponent = class ProfileEducationComponent {\n  constructor(fb, educationService, router) {\n    this.fb = fb;\n    this.educationService = educationService;\n    this.router = router;\n    this.rootClassName = '';\n    this.educationForms = [];\n    this.universities = [];\n    this.educationLevels = [];\n    this.courses = [];\n    this.specializations = [];\n    this.todayDate = new Date().toISOString().split('T')[0];\n    this.isLoading = false;\n    this.errorMessage = null;\n  }\n\n  ngOnInit() {\n    this.loadReferenceData();\n  }\n  /**\r\n   * Loads reference data for dropdowns from the backend\r\n   */\n\n\n  loadReferenceData() {\n    this.isLoading = true;\n    this.errorMessage = null;\n    this.educationService.getReferenceData().pipe(tap(data => {\n      this.universities = data.colleges;\n      this.educationLevels = data.education_levels;\n      this.courses = data.courses;\n      this.specializations = data.specializations;\n      this.addNewForm();\n    }), catchError(error => {\n      this.errorMessage = error.message || 'Failed to load dropdown data';\n      this.addNewForm(); // Add a form even if data fails\n\n      return [];\n    })).subscribe({\n      complete: () => this.isLoading = false\n    });\n  }\n  /**\r\n   * Creates a new education form with validation\r\n   */\n\n\n  createEducationForm() {\n    return this.fb.group({\n      startDate: ['', Validators.required],\n      endDate: ['', Validators.required],\n      university: ['', Validators.required],\n      educationLevel: ['', Validators.required],\n      course: ['', Validators.required],\n      specialization: ['', Validators.required]\n    }, {\n      validators: this.dateRangeValidator\n    });\n  }\n  /**\r\n   * Validates that end date is not before start date\r\n   */\n\n\n  dateRangeValidator(form) {\n    var _a, _b;\n\n    const startDate = (_a = form.get('startDate')) === null || _a === void 0 ? void 0 : _a.value;\n    const endDate = (_b = form.get('endDate')) === null || _b === void 0 ? void 0 : _b.value;\n    return startDate && endDate && new Date(endDate) < new Date(startDate) ? {\n      dateRangeInvalid: true\n    } : null;\n  }\n  /**\r\n   * Adds a new form and scrolls to it\r\n   */\n\n\n  addNewForm() {\n    this.educationForms.push(this.createEducationForm());\n    setTimeout(() => {\n      const lastForm = this.educationFormInstances.last;\n\n      if (lastForm) {\n        lastForm.nativeElement.scrollIntoView({\n          behavior: 'smooth',\n          block: 'start'\n        });\n      }\n    }, 0);\n  }\n  /**\r\n   * Removes a form by index\r\n   */\n\n\n  removeForm(index) {\n    this.educationForms.splice(index, 1);\n  }\n  /**\r\n   * Saves all valid forms to the backend\r\n   */\n\n\n  saveEducation() {\n    return new Promise(resolve => {\n      const validForms = this.educationForms.filter(form => form.valid);\n\n      if (!validForms.length) {\n        console.log('No valid forms to save');\n        resolve(true);\n        return;\n      }\n\n      const saveObservables = validForms.map(form => {\n        const data = {\n          select_start_date: form.value.startDate,\n          select_end_date: form.value.endDate,\n          university: form.value.university,\n          education_level: form.value.educationLevel,\n          course: form.value.course,\n          specialization: form.value.specialization\n        };\n        return this.educationService.addEducation(data).pipe(catchError(error => {\n          console.error('Error saving form:', error);\n          return [];\n        }));\n      });\n      forkJoin(saveObservables).subscribe({\n        next: () => {\n          console.log('All educations saved successfully');\n          resolve(true);\n        },\n        error: error => {\n          console.error('Error saving educations:', error);\n          this.errorMessage = error.message || 'Failed to save education data';\n          resolve(false);\n        }\n      });\n    });\n  }\n  /**\r\n   * Navigation to previous section\r\n   */\n\n\n  goToPrevious() {\n    this.router.navigate(['/profile-employment-page']);\n  }\n  /**\r\n   * Navigation to next section\r\n   */\n\n\n  skipToNextSection() {\n    this.router.navigate(['/profile-certification-page']);\n  }\n  /**\r\n   * TrackBy function for ngFor to optimize rendering\r\n   */\n\n\n  trackById(index, item) {\n    return item.id || index;\n  }\n\n};\n\n__decorate([Input()], ProfileEducationComponent.prototype, \"rootClassName\", void 0);\n\n__decorate([ViewChildren('educationFormInstance')], ProfileEducationComponent.prototype, \"educationFormInstances\", void 0);\n\nProfileEducationComponent = __decorate([Component({\n  selector: 'profile-education-component',\n  templateUrl: './profile-education-component.component.html',\n  styleUrls: ['./profile-education-component.component.css']\n})], ProfileEducationComponent);\nexport { ProfileEducationComponent };","map":null,"metadata":{},"sourceType":"module"}