{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let JobDescriptionService = /*#__PURE__*/(() => {\n  class JobDescriptionService {\n    constructor(http) {\n      this.http = http; // Base API URL from environment configuration (e.g., 'http://localhost:8000/api/')\n\n      this.apiUrl = environment.apiUrl;\n    }\n    /**\r\n     * Uploads a file to Google Cloud Storage, processes it with AI, and saves metadata and draft job post.\r\n     * @param file The file to upload\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with file URL, unique ID, job details, and MCQs\r\n     */\n\n\n    uploadFile(file, token) {\n      // Validate file input\n      if (!file) {\n        console.error('No file provided for upload');\n        return throwError(() => new Error('No file selected for upload'));\n      } // Validate file size (max 10MB, matching Django view)\n\n\n      if (file.size > 10 * 1024 * 1024) {\n        return throwError(() => new Error('File size exceeds 10MB'));\n      } // Validate file extension\n\n\n      const allowedExtensions = ['.pdf', '.docx', '.txt', '.xml', '.csv'];\n      const ext = file.name.toLowerCase().split('.').pop();\n\n      if (!ext || !allowedExtensions.includes(`.${ext}`)) {\n        return throwError(() => new Error(`Invalid file format. Supported: ${allowedExtensions.join(', ')}`));\n      } // Create FormData for file upload\n\n\n      const formData = new FormData();\n      formData.append('file', file, file.name); // Set Authorization header with Bearer token\n\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`\n      });\n      return this.http.post(`${this.apiUrl}file-upload/`, // Endpoint: /api/file-upload/\n      formData, {\n        headers\n      }).pipe(map(response => response.data), catchError(error => this.handleError(error)));\n    }\n    /**\r\n       * Saves or updates a job post by sending a POST request to the backend.\r\n       * @param jobDetails The job post details to save or update.\r\n       * @param token JWT token for authentication.\r\n       * @returns Observable with the response containing unique_id and message.\r\n       */\n\n\n    saveJobPost(jobDetails, token) {\n      // Set headers with authorization token\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }); // Send POST request to job-post endpoint\n\n      return this.http.post(`${this.apiUrl}/job-post/`, jobDetails, {\n        headers\n      }).pipe( // Map response to extract relevant data\n      map(response => {\n        if (response.status === 'success') {\n          return {\n            unique_id: response.data.unique_id,\n            message: response.data.message\n          };\n        }\n\n        throw new Error('Unexpected response status');\n      }), // Handle errors\n      catchError(this.handleError));\n    }\n    /**\r\n     * Updates the status of a job post\r\n     * @param uniqueId Unique identifier of the job post\r\n     * @param status New status ('draft' or 'final')\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with success message and unique_id\r\n     */\n\n\n    updateJobPostStatus(uniqueId, status, token) {\n      // Set headers for JSON request\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }); // Prepare payload matching JobPostStatusUpdateSerializer\n\n      const payload = {\n        unique_id: uniqueId,\n        status\n      };\n      return this.http.post(`${this.apiUrl}job-post/update-status/`, // Endpoint: /api/job-post/update-status/\n      payload, {\n        headers\n      }).pipe(map(response => response.data), catchError(this.handleError));\n    }\n    /**\r\n     * Soft deletes a job post\r\n     * @param uniqueId Unique identifier of the job post\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with success message and unique_id\r\n     */\n\n\n    deleteJobPost(uniqueId, token) {\n      // Set headers for JSON request\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }); // Prepare payload matching DeleteSerializer\n\n      const payload = {\n        unique_id: uniqueId\n      };\n      return this.http.delete(`${this.apiUrl}job-post/delete/`, // Endpoint: /api/job-post/delete/\n      {\n        headers,\n        body: payload\n      }).pipe(map(response => response.data), catchError(this.handleError));\n    }\n    /**\r\n     * Soft deletes an uploaded file\r\n     * @param uniqueId Unique identifier of the file\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with success message and unique_id\r\n     */\n\n\n    deleteFile(uniqueId, token) {\n      // Set headers for JSON request\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }); // Prepare payload matching DeleteSerializer\n\n      const payload = {\n        unique_id: uniqueId\n      };\n      return this.http.delete(`${this.apiUrl}file-upload/delete/`, // Endpoint: /api/file-upload/delete/\n      {\n        headers,\n        body: payload\n      }).pipe(map(response => response.data), catchError(this.handleError));\n    }\n    /**\r\n     * Lists all job posts for the authenticated user (paginated)\r\n     * @param token JWT token for authentication\r\n     * @param page Page number for pagination (optional)\r\n     * @returns Observable with paginated job posts\r\n     */\n\n\n    listJobPosts(token, page) {\n      // Set headers for JSON request\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`\n      }); // Prepare URL with optional page parameter\n\n      let url = `${this.apiUrl}job-post/`;\n\n      if (page) {\n        url += `?page=${page}`;\n      }\n\n      return this.http.get(url, // Endpoint: /api/job-post/\n      {\n        headers\n      }).pipe(map(response => response.data), catchError(this.handleError));\n    }\n    /**\r\n     * Retrieves a single job post by unique_id\r\n     * @param uniqueId Unique identifier of the job post\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with job post details\r\n     */\n\n\n    getJobPost(uniqueId, token) {\n      // Set headers for JSON request\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`\n      });\n      return this.http.get(`${this.apiUrl}job-post/${uniqueId}/`, // Endpoint: /api/job-post/<unique_id>/\n      {\n        headers\n      }).pipe(map(response => response.data), catchError(this.handleError));\n    }\n    /**\r\n     * Handles HTTP errors and formats error messages\r\n     * @param error HTTP error response\r\n     * @returns Observable with formatted error message\r\n     */\n\n\n    handleError(error) {\n      var _a, _b;\n\n      let errorMessage = 'An unknown error occurred';\n\n      if (error.error instanceof ErrorEvent) {\n        // Client-side error\n        errorMessage = `Client-side error: ${error.error.message}`;\n      } else {\n        // Server-side error\n        if (error.status === 400) {\n          if (((_a = error.error) === null || _a === void 0 ? void 0 : _a.status) === 'error') {\n            // Handle Django validation errors or specific messages\n            errorMessage = error.error.message || 'Invalid request data';\n\n            if (error.error.errors) {\n              errorMessage = Object.keys(error.error.errors).map(key => `${key}: ${error.error.errors[key].join(', ')}`).join('; ');\n            }\n          } else {\n            errorMessage = 'Invalid request data';\n          }\n        } else if (error.status === 401) {\n          errorMessage = 'Unauthorized: Please log in again';\n        } else if (error.status === 403) {\n          errorMessage = 'Forbidden: Invalid unique_id or unauthorized';\n        } else if (error.status === 404) {\n          errorMessage = 'Not found: Resource does not exist';\n        } else if (error.status === 500) {\n          errorMessage = `Server error: ${((_b = error.error) === null || _b === void 0 ? void 0 : _b.message) || 'Internal server error'}`;\n        } else {\n          errorMessage = `Server error: ${error.status} - ${error.message}`;\n        }\n      } // Log error for debugging\n\n\n      console.error(errorMessage, error);\n      return throwError(() => new Error(errorMessage));\n    }\n\n  }\n\n  JobDescriptionService.ɵfac = function JobDescriptionService_Factory(t) {\n    return new (t || JobDescriptionService)(i0.ɵɵinject(i1.HttpClient));\n  };\n\n  JobDescriptionService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: JobDescriptionService,\n    factory: JobDescriptionService.ɵfac,\n    providedIn: 'root'\n  });\n  return JobDescriptionService;\n})();","map":null,"metadata":{},"sourceType":"module"}