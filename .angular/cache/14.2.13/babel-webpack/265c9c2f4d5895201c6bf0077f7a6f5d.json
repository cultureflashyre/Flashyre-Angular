{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, ViewChild } from '@angular/core';\nlet CreateJobPost1stPageComponent = class CreateJobPost1stPageComponent {\n  constructor(title, meta, fileUploadService, jobDescriptionService) {\n    this.title = title;\n    this.meta = meta;\n    this.fileUploadService = fileUploadService;\n    this.jobDescriptionService = jobDescriptionService;\n    this.jobDetails = {\n      role: '',\n      location: '',\n      job_type: '',\n      workplace_type: '',\n      total_experience_min: 0,\n      total_experience_max: 0,\n      relevant_experience_min: 0,\n      relevant_experience_max: 0,\n      budget_type: '',\n      min_budget: 0,\n      max_budget: 0,\n      notice_period: '',\n      skills: '',\n      job_description: '',\n      job_description_url: ''\n    };\n    this.selectedFile = null;\n    this.token = null;\n    this.user_id = 1; // Hardcoded user_id for testing\n\n    this.title.setTitle('Create-Job-Post-1st-page - Flashyre');\n    this.meta.addTags([{\n      property: 'og:title',\n      content: 'Create-Job-Post-1st-page - Flashyre'\n    }, {\n      property: 'og:image',\n      content: 'https://aheioqhobo.cloudimg.io/v7/_playground-bucket-v2.teleporthq.io_/8203932d-6f2d-4493-a7b2-7000ee521aa2/9aea8e9c-27ce-4011-a345-94a92ae2dbf8?org_if_sml=1&force_format=original'\n    }]);\n  }\n\n  ngOnInit() {\n    this.token = localStorage.getItem('access_token'); // Attempt to retrieve token\n  }\n\n  triggerFileInput() {\n    this.fileInput.nativeElement.click();\n  }\n\n  onFileSelected(event) {\n    const input = event.target;\n\n    if (input.files && input.files.length > 0) {\n      const file = input.files[0];\n      const allowedTypes = ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/msword'];\n      const maxSize = 5 * 1024 * 1024; // 5 MB in bytes\n      // Validate file type\n\n      if (!allowedTypes.includes(file.type)) {\n        alert('Invalid file type. Please select a PDF or Word document (.pdf, .docx, .doc).');\n        this.selectedFile = null;\n        input.value = ''; // Clear the input\n\n        return;\n      } // Validate file size\n\n\n      if (file.size > maxSize) {\n        alert('File size exceeds 5 MB. Please select a smaller file.');\n        this.selectedFile = null;\n        input.value = ''; // Clear the input\n\n        return;\n      }\n\n      this.selectedFile = file;\n      this.uploadFile();\n    }\n  }\n\n  uploadFile() {\n    if (!this.selectedFile) {\n      alert('Please select a file.');\n      return;\n    } // Use temporary token for testing\n\n\n    this.fileUploadService.uploadFile(this.selectedFile, 'temporary-token').subscribe({\n      next: response => {\n        this.jobDetails.job_description_url = response.file_url;\n        this.processJobDescription(response.file_url); // Clear file input after successful upload\n\n        this.fileInput.nativeElement.value = '';\n        this.selectedFile = null;\n      },\n      error: error => {\n        console.error('File upload failed:', error);\n        alert('Failed to upload file. Please try again.');\n        this.fileInput.nativeElement.value = '';\n        this.selectedFile = null;\n      }\n    });\n  }\n\n  processJobDescription(fileUrl) {\n    this.jobDescriptionService.processJobDescription(fileUrl, 'temporary-token').subscribe({\n      next: response => {\n        this.populateForm(response);\n        this.jobDescriptionService.storeMCQs(response.mcqs);\n      },\n      error: error => {\n        console.error('AI processing failed:', error);\n        alert('Failed to process job description. Please try again.');\n      }\n    });\n  }\n\n  populateForm(jobData) {\n    var _a, _b, _c;\n\n    this.jobDetails.role = ((_a = jobData.job_titles[0]) === null || _a === void 0 ? void 0 : _a.value) || '';\n    this.jobDetails.location = jobData.location || 'Unknown';\n    this.jobDetails.job_type = this.mapJobType(((_b = jobData.job_titles[0]) === null || _b === void 0 ? void 0 : _b.value) || '');\n    this.jobDetails.workplace_type = jobData.workplace_type || 'Remote';\n    const [minExp, maxExp] = this.parseExperience(((_c = jobData.experience) === null || _c === void 0 ? void 0 : _c.value) || '0-0 years');\n    this.jobDetails.total_experience_min = minExp;\n    this.jobDetails.total_experience_max = maxExp;\n    this.jobDetails.relevant_experience_min = Math.max(0, minExp - 1);\n    this.jobDetails.relevant_experience_max = Math.min(maxExp, minExp + 2);\n    this.jobDetails.budget_type = jobData.budget_type || 'Annually';\n    this.jobDetails.min_budget = jobData.min_budget || 0;\n    this.jobDetails.max_budget = jobData.max_budget || 0;\n    this.jobDetails.notice_period = jobData.notice_period || '30 days';\n    this.jobDetails.skills = [...jobData.skills.primary.map(s => s.skill), ...jobData.skills.secondary.map(s => s.skill)].join(',');\n    this.jobDetails.job_description = jobData.job_description || '';\n  }\n\n  mapJobType(title) {\n    const lowerTitle = title.toLowerCase();\n    if (lowerTitle.includes('intern')) return 'Internship';\n    if (lowerTitle.includes('contract')) return 'Contract';\n    if (lowerTitle.includes('part-time')) return 'Part-time';\n    return 'Permanent';\n  }\n\n  parseExperience(exp) {\n    const match = exp.match(/(\\d+)-(\\d+)/);\n    return match ? [parseInt(match[1]), parseInt(match[2])] : [0, 0];\n  }\n\n  submitJobPost() {\n    this.jobDescriptionService.saveJobPost(this.jobDetails, 'temporary-token').subscribe({\n      next: () => {\n        alert('Job post created successfully!');\n        this.resetForm();\n      },\n      error: error => {\n        console.error('Job post creation failed:', error);\n        alert('Failed to create job post. Please try again.');\n      }\n    });\n  }\n\n  resetForm() {\n    this.jobDetails = {\n      role: '',\n      location: '',\n      job_type: '',\n      workplace_type: '',\n      total_experience_min: 0,\n      total_experience_max: 0,\n      relevant_experience_min: 0,\n      relevant_experience_max: 0,\n      budget_type: '',\n      min_budget: 0,\n      max_budget: 0,\n      notice_period: '',\n      skills: '',\n      job_description: '',\n      job_description_url: ''\n    };\n    this.selectedFile = null;\n\n    if (this.fileInput) {\n      this.fileInput.nativeElement.value = '';\n    }\n  }\n\n};\n\n__decorate([ViewChild('fileInput')], CreateJobPost1stPageComponent.prototype, \"fileInput\", void 0);\n\nCreateJobPost1stPageComponent = __decorate([Component({\n  selector: 'create-job-post1st-page',\n  templateUrl: './create-job-post-1st-page.component.html',\n  styleUrls: ['./create-job-post-1st-page.component.css']\n})], CreateJobPost1stPageComponent);\nexport { CreateJobPost1stPageComponent };","map":null,"metadata":{},"sourceType":"module"}