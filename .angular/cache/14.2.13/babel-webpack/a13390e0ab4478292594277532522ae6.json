{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, HostListener } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { environment } from '../../../environments/environment';\nlet CandidateHome = class CandidateHome {\n  constructor(title, meta, http, router, authService, jobService) {\n    this.title = title;\n    this.meta = meta;\n    this.http = http;\n    this.router = router;\n    this.authService = authService;\n    this.jobService = jobService;\n    this.userProfile = {};\n    this.defaultProfilePicture = \"/assets/placeholders/profile-placeholder.jpg\"; // Job related properties\n\n    this.jobs = [];\n    this.displayedJobs = [];\n    this.appliedJobIds = []; // Pagination properties\n\n    this.currentPage = 0;\n    this.jobsPerPage = 30;\n    this.isLoadingMore = false; // Application state\n\n    this.processingApplications = {};\n    this.applicationSuccess = {};\n    this.isLoading = true; // Intersection Observer\n\n    this.observer = null;\n    this.destroy$ = new Subject();\n    this.apiUrl = environment.apiUrl + 'api/jobs/';\n    this.title.setTitle('Candidate-Home - Flashyre');\n    this.meta.addTags([{\n      property: 'og:title',\n      content: 'Candidate-Home - Flashyre'\n    }, {\n      property: 'og:image',\n      content: 'https://aheioqhobo.cloudimg.io/v7/_playground-bucket-v2.teleporthq.io_/8203932d-6f2d-4493-a7b2-7000ee521aa2/9aea8e9c-27ce-4011-a345-94a92ae2dbf8?org_if_sml=1&force_format=original'\n    }]);\n  }\n\n  ngOnInit() {\n    this.loadUserProfile();\n    this.initializeJobs();\n  }\n\n  ngAfterViewInit() {\n    // Initialize intersection observer after view is ready\n    setTimeout(() => {\n      this.setupInfiniteScroll();\n    }, 100);\n  }\n\n  ngOnDestroy() {\n    this.destroy$.next();\n    this.destroy$.complete();\n\n    if (this.observer) {\n      this.observer.disconnect();\n    }\n  }\n  /**\r\n   * Initialize jobs - check cache first, then fetch if needed\r\n   */\n\n\n  initializeJobs() {\n    this.isLoading = true; // Check if jobs are already cached\n\n    if (this.jobService.areJobsCached()) {\n      console.log('Loading jobs from cache...');\n      this.loadJobsFromCache();\n    } else {\n      console.log('Fetching jobs from API...');\n      this.fetchJobsFromAPI();\n    }\n  }\n  /**\r\n   * Load jobs from cache\r\n   */\n\n\n  loadJobsFromCache() {\n    this.jobService.getJobs().pipe(takeUntil(this.destroy$)).subscribe(jobs => {\n      if (jobs.length > 0) {\n        this.filterAndDisplayJobs(jobs);\n      }\n    });\n  }\n  /**\r\n   * Fetch jobs from API\r\n   */\n\n\n  fetchJobsFromAPI() {\n    this.jobService.fetchJobs().pipe(takeUntil(this.destroy$)).subscribe(jobs => {\n      this.filterAndDisplayJobs(jobs);\n    }, error => {\n      console.error('Error fetching jobs:', error);\n      this.isLoading = false;\n    });\n  }\n  /**\r\n   * Filter jobs and set up initial display\r\n   */\n\n\n  filterAndDisplayJobs(jobs) {\n    this.authService.getAppliedJobs().pipe(takeUntil(this.destroy$)).subscribe(appliedJobs => {\n      this.appliedJobIds = appliedJobs.applied_job_ids || []; // Filter out applied jobs\n\n      this.jobs = jobs.filter(job => !this.appliedJobIds.includes(job.job_id)); // Reset pagination\n\n      this.currentPage = 0;\n      this.displayedJobs = []; // Load first page\n\n      this.loadNextPage();\n      this.isLoading = false;\n    }, error => {\n      console.error('Error fetching applied jobs:', error); // Fallback: show all jobs without filtering\n\n      this.jobs = jobs;\n      this.currentPage = 0;\n      this.displayedJobs = [];\n      this.loadNextPage();\n      this.isLoading = false;\n    });\n  }\n  /**\r\n   * Load the next page of jobs\r\n   */\n\n\n  loadNextPage() {\n    if (this.isLoadingMore || this.displayedJobs.length >= this.jobs.length) {\n      return;\n    }\n\n    this.isLoadingMore = true;\n    const startIndex = this.currentPage * this.jobsPerPage;\n    const endIndex = startIndex + this.jobsPerPage;\n    const nextJobs = this.jobs.slice(startIndex, endIndex);\n\n    if (nextJobs.length > 0) {\n      this.displayedJobs = [...this.displayedJobs, ...nextJobs];\n      this.currentPage++;\n      console.log(`Loaded page ${this.currentPage}, showing ${this.displayedJobs.length} of ${this.jobs.length} jobs`);\n    }\n\n    this.isLoadingMore = false; // Re-setup intersection observer after DOM updates\n\n    setTimeout(() => {\n      this.setupInfiniteScroll();\n    }, 100);\n  }\n  /**\r\n   * Setup infinite scroll using Intersection Observer\r\n   */\n\n\n  setupInfiniteScroll() {\n    // Disconnect existing observer\n    if (this.observer) {\n      this.observer.disconnect();\n    }\n\n    const loadMoreElement = document.getElementById('load-more');\n\n    if (!loadMoreElement || this.displayedJobs.length >= this.jobs.length) {\n      return;\n    }\n\n    const options = {\n      root: null,\n      rootMargin: '100px',\n      threshold: 0.1\n    };\n    this.observer = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting && !this.isLoadingMore) {\n        this.loadNextPage();\n      }\n    }, options);\n    this.observer.observe(loadMoreElement);\n  }\n  /**\r\n   * Load more jobs (called by intersection observer)\r\n   */\n\n\n  loadMoreJobs() {\n    this.loadNextPage();\n  }\n  /**\r\n   * Load user profile from localStorage\r\n   */\n\n\n  loadUserProfile() {\n    const profileData = localStorage.getItem('userProfile');\n\n    if (profileData) {\n      this.userProfile = JSON.parse(profileData);\n    } else {\n      console.log(\"User Profile NOT fetched\");\n    }\n  }\n  /**\r\n   * Navigate to assessment page\r\n   */\n\n\n  navigateToAssessment(jobId) {\n    this.router.navigate(['/flashyre-rules', jobId]);\n  }\n  /**\r\n   * Apply for a job\r\n   */\n\n\n  applyForJob(jobId, index) {\n    this.processingApplications[jobId] = true;\n    this.authService.applyForJob(jobId).pipe(takeUntil(this.destroy$)).subscribe(response => {\n      console.log('Application successful:', response);\n      this.applicationSuccess[jobId] = true;\n      this.appliedJobIds.push(jobId); // Remove job from cache and display after 2 seconds\n\n      setTimeout(() => {\n        this.jobService.removeJobFromCache(jobId);\n        this.jobs = this.jobs.filter(job => job.job_id !== jobId);\n        this.displayedJobs = this.displayedJobs.filter(job => job.job_id !== jobId);\n      }, 2000);\n    }, error => {\n      var _a;\n\n      console.error('Application failed:', error);\n      this.processingApplications[jobId] = false;\n      alert(((_a = error.error) === null || _a === void 0 ? void 0 : _a.error) || 'Failed to apply for this job');\n    });\n  }\n  /**\r\n   * Refresh jobs (force fetch from API)\r\n   */\n\n\n  refreshJobs() {\n    this.jobService.clearCache_refresh();\n    this.initializeJobs();\n  }\n  /**\r\n   * Get loading state for more jobs\r\n   */\n\n\n  get isLoadingMoreJobs() {\n    return this.isLoadingMore;\n  }\n  /**\r\n   * Check if there are more jobs to load\r\n   */\n\n\n  get hasMoreJobs() {\n    return this.displayedJobs.length < this.jobs.length;\n  }\n\n  trackByJobId(index, job) {\n    return job.job_id;\n  }\n  /**\r\n   * Check if user has scrolled to bottom manually (fallback for intersection observer)\r\n   */\n\n\n  onWindowScroll(event) {\n    // Only use this as fallback if intersection observer isn't working\n    if (!this.observer) {\n      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n      const scrollHeight = document.documentElement.scrollHeight;\n      const clientHeight = window.innerHeight;\n\n      if (scrollTop + clientHeight >= scrollHeight - 100 && this.hasMoreJobs && !this.isLoadingMoreJobs) {\n        this.loadNextPage();\n      }\n    }\n  }\n  /**\r\n   * Retry fetching jobs in case of network error\r\n   */\n\n\n  retryFetchJobs() {\n    this.isLoading = true;\n    this.fetchJobsFromAPI();\n  }\n  /**\r\n   * Get job loading progress percentage\r\n   */\n\n\n  getLoadingProgress() {\n    if (this.jobs.length === 0) return 0;\n    return Math.round(this.displayedJobs.length / this.jobs.length * 100);\n  }\n  /**\r\n   * Scroll to top of job list\r\n   */\n\n\n  scrollToTop() {\n    const jobContainer = document.getElementById('job-container');\n\n    if (jobContainer) {\n      jobContainer.scrollIntoView({\n        behavior: 'smooth'\n      });\n    }\n  }\n  /**\r\n   * Debug method to check cache status\r\n   */\n\n\n  checkCacheStatus() {\n    console.log('Cache Status:', {\n      isCached: this.jobService.areJobsCached(),\n      totalJobs: this.jobs.length,\n      displayedJobs: this.displayedJobs.length,\n      currentPage: this.currentPage,\n      hasMore: this.hasMoreJobs\n    });\n  }\n\n};\n\n__decorate([HostListener('window:scroll', ['$event'])], CandidateHome.prototype, \"onWindowScroll\", null);\n\nCandidateHome = __decorate([Component({\n  selector: 'candidate-home',\n  templateUrl: 'candidate-home.component.html',\n  styleUrls: ['candidate-home.component.css']\n})], CandidateHome);\nexport { CandidateHome };","map":null,"metadata":{},"sourceType":"module"}