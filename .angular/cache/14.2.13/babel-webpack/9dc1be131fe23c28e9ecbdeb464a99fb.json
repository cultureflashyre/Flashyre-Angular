{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let JobDescriptionService = /*#__PURE__*/(() => {\n  class JobDescriptionService {\n    constructor(http) {\n      this.http = http; // Base API URL from environment configuration (e.g., 'http://localhost:8000/api/')\n\n      this.apiUrl = environment.apiUrl;\n    }\n    /**\r\n     * Uploads a file to Google Cloud Storage and saves metadata\r\n     * @param file The file to upload\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with file URL and unique ID\r\n     */\n\n\n    uploadFile(file, token) {\n      // Validate file input\n      if (!file) {\n        console.error('No file provided for upload');\n        return throwError(() => new Error('No file selected for upload'));\n      } // Validate file size (max 10MB, matching Django view)\n\n\n      if (file.size > 10 * 1024 * 1024) {\n        return throwError(() => new Error('File size exceeds 10MB'));\n      } // Validate file extension\n\n\n      const allowedExtensions = ['.pdf', '.docx', '.txt', '.xml', '.csv'];\n      const ext = file.name.toLowerCase().split('.').pop();\n\n      if (!ext || !allowedExtensions.includes(`.${ext}`)) {\n        return throwError(() => new Error(`Invalid file format. Supported: ${allowedExtensions.join(', ')}`));\n      } // Create FormData for file upload\n\n\n      const formData = new FormData();\n      formData.append('file', file, file.name); // Set Authorization header with Bearer token\n\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`\n      });\n      return this.http.post(`${this.apiUrl}file-upload/`, // Endpoint: /api/file-upload/\n      formData, {\n        headers\n      }).pipe(map(response => {\n        if (response.status !== 'success') {\n          throw new Error(response.message || 'File upload failed');\n        }\n\n        return response.data;\n      }), catchError(error => this.handleError(error)));\n    }\n    /**\r\n     * Processes a job description file using AI\r\n     * @param fileUrl URL of the uploaded file\r\n     * @param uniqueId Unique identifier for the file\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with AI-processed job details and MCQs\r\n     */\n\n\n    processJobDescription(fileUrl, uniqueId, token) {\n      // Validate input\n      if (!fileUrl || !uniqueId) {\n        console.error('Missing file_url or unique_id', {\n          fileUrl,\n          uniqueId\n        });\n        return throwError(() => new Error('file_url and unique_id are required'));\n      } // Set headers for JSON request\n\n\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }); // Prepare payload\n\n      const payload = {\n        file_url: fileUrl,\n        unique_id: uniqueId\n      };\n      return this.http.post(`${this.apiUrl}ai-process/`, // Endpoint: /api/ai-process/\n      payload, {\n        headers\n      }).pipe(map(response => {\n        if (response.status !== 'success') {\n          throw new Error(response.message || 'AI processing failed');\n        }\n\n        return response.data;\n      }), catchError(error => this.handleError(error)));\n    }\n    /**\r\n     * Creates or updates a job post\r\n     * @param jobDetails Job details to save\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with unique_id and success message\r\n     */\n\n\n    saveJobPost(jobDetails, token) {\n      // Set headers for JSON request\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      });\n      return this.http.post(`${this.apiUrl}job-post/`, // Endpoint: /api/job-post/\n      jobDetails, {\n        headers\n      }).pipe(map(response => {\n        if (response.status !== 'success') {\n          throw new Error(response.message || 'Job post creation/update failed');\n        }\n\n        return response.data;\n      }), catchError(this.handleError));\n    }\n    /**\r\n     * Updates the status of a job post\r\n     * @param uniqueId Unique identifier of the job post\r\n     * @param status New status ('draft' or 'final')\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with success message and unique_id\r\n     */\n\n\n    updateJobPostStatus(uniqueId, status, token) {\n      // Validate input\n      if (!uniqueId || !['draft', 'final'].includes(status)) {\n        console.error('Invalid unique_id or status', {\n          uniqueId,\n          status\n        });\n        return throwError(() => new Error('Invalid unique_id or status'));\n      } // Set headers for JSON request\n\n\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }); // Prepare payload matching JobPostStatusUpdateSerializer\n\n      const payload = {\n        unique_id: uniqueId,\n        status\n      };\n      return this.http.post(`${this.apiUrl}job-post/update-status/`, // Endpoint: /api/job-post/update-status/\n      payload, {\n        headers\n      }).pipe(map(response => {\n        if (response.status !== 'success') {\n          throw new Error(response.message || 'Status update failed');\n        }\n\n        return response.data;\n      }), catchError(this.handleError));\n    }\n    /**\r\n     * Soft deletes a job post\r\n     * @param uniqueId Unique identifier of the job post\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with success message and unique_id\r\n     */\n\n\n    deleteJobPost(uniqueId, token) {\n      // Validate input\n      if (!uniqueId) {\n        console.error('Missing unique_id', {\n          uniqueId\n        });\n        return throwError(() => new Error('unique_id is required'));\n      } // Set headers for JSON request\n\n\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }); // Prepare payload matching DeleteSerializer\n\n      const payload = {\n        unique_id: uniqueId\n      };\n      return this.http.delete(`${this.apiUrl}job-post/delete/`, // Endpoint: /api/job-post/delete/\n      {\n        headers,\n        body: payload\n      }).pipe(map(response => {\n        if (response.status !== 'success') {\n          throw new Error(response.message || 'Job post deletion failed');\n        }\n\n        return response.data;\n      }), catchError(this.handleError));\n    }\n    /**\r\n     * Soft deletes an uploaded file\r\n     * @param uniqueId Unique identifier of the file\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with success message and unique_id\r\n     */\n\n\n    deleteFile(uniqueId, token) {\n      // Validate input\n      if (!uniqueId) {\n        console.error('Missing unique_id', {\n          uniqueId\n        });\n        return throwError(() => new Error('unique_id is required'));\n      } // Set headers for JSON request\n\n\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      }); // Prepare payload matching DeleteSerializer\n\n      const payload = {\n        unique_id: uniqueId\n      };\n      return this.http.delete(`${this.apiUrl}file-upload/delete/`, // Endpoint: /api/file-upload/delete/\n      {\n        headers,\n        body: payload\n      }).pipe(map(response => {\n        if (response.status !== 'success') {\n          throw new Error(response.message || 'File deletion failed');\n        }\n\n        return response.data;\n      }), catchError(this.handleError));\n    }\n    /**\r\n     * Lists all job posts for the authenticated user (paginated)\r\n     * @param token JWT token for authentication\r\n     * @param page Page number for pagination (optional)\r\n     * @returns Observable with paginated job posts\r\n     */\n\n\n    listJobPosts(token, page) {\n      // Set headers for JSON request\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`\n      }); // Prepare URL with optional page parameter\n\n      let url = `${this.apiUrl}job-post/`;\n\n      if (page) {\n        url += `?page=${page}`;\n      }\n\n      return this.http.get(url, // Endpoint: /api/job-post/\n      {\n        headers\n      }).pipe(map(response => {\n        if (response.status !== 'success') {\n          throw new Error(response.message || 'Job post listing failed');\n        }\n\n        return response.data;\n      }), catchError(this.handleError));\n    }\n    /**\r\n     * Retrieves a single job post by unique_id\r\n     * @param uniqueId Unique identifier of the job post\r\n     * @param token JWT token for authentication\r\n     * @returns Observable with job post details\r\n     */\n\n\n    getJobPost(uniqueId, token) {\n      // Validate input\n      if (!uniqueId) {\n        console.error('Missing unique_id', {\n          uniqueId\n        });\n        return throwError(() => new Error('unique_id is required'));\n      } // Set headers for JSON request\n\n\n      const headers = new HttpHeaders({\n        Authorization: `Bearer ${token}`\n      });\n      return this.http.get(`${this.apiUrl}job-post/${uniqueId}/`, // Endpoint: /api/job-post/<unique_id>/\n      {\n        headers\n      }).pipe(map(response => {\n        if (response.status !== 'success') {\n          throw new Error(response.message || 'Job post retrieval failed');\n        }\n\n        return response.data;\n      }), catchError(this.handleError));\n    }\n    /**\r\n     * Handles HTTP errors and formats error messages\r\n     * @param error HTTP error response\r\n     * @returns Observable with formatted error message\r\n     */\n\n\n    handleError(error) {\n      var _a, _b, _c, _d;\n\n      let errorMessage = 'An unknown error occurred';\n\n      if (error.error instanceof ErrorEvent) {\n        // Client-side error\n        errorMessage = `Client-side error: ${error.error.message}`;\n      } else {\n        // Server-side error\n        if (error.status === 400) {\n          if (((_a = error.error) === null || _a === void 0 ? void 0 : _a.status) === 'error') {\n            // Handle Django validation errors or specific messages\n            errorMessage = error.error.message || 'Invalid request data';\n\n            if (error.error.errors) {\n              errorMessage = Object.keys(error.error.errors).map(key => `${key}: ${error.error.errors[key].join(', ')}`).join('; ');\n            }\n          } else {\n            errorMessage = 'Invalid request data';\n          }\n        } else if (error.status === 401) {\n          errorMessage = 'Unauthorized: Please log in again';\n        } else if (error.status === 403) {\n          errorMessage = 'Forbidden: Invalid unique_id or unauthorized';\n        } else if (error.status === 404) {\n          errorMessage = 'Not found: Resource does not exist';\n        } else if (error.status === 500) {\n          // Handle PermissionError specifically\n          errorMessage = ((_c = (_b = error.error) === null || _b === void 0 ? void 0 : _b.message) === null || _c === void 0 ? void 0 : _c.includes('PermissionError')) ? 'Server error: Unable to access the uploaded file due to permission issues. Please try uploading again or contact support.' : `Server error: ${((_d = error.error) === null || _d === void 0 ? void 0 : _d.message) || 'Internal server error'}`;\n        } else {\n          errorMessage = `Server error: ${error.status} - ${error.message}`;\n        }\n      } // Log error for debugging with additional context\n\n\n      console.error(errorMessage, {\n        status: error.status,\n        url: error.url,\n        response: error.error\n      });\n      return throwError(() => new Error(errorMessage));\n    }\n\n  }\n\n  JobDescriptionService.ɵfac = function JobDescriptionService_Factory(t) {\n    return new (t || JobDescriptionService)(i0.ɵɵinject(i1.HttpClient));\n  };\n\n  JobDescriptionService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: JobDescriptionService,\n    factory: JobDescriptionService.ɵfac,\n    providedIn: 'root'\n  });\n  return JobDescriptionService;\n})();","map":null,"metadata":{},"sourceType":"module"}