{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { forkJoin } from 'rxjs';\nimport { environment } from '../../../environments/environment';\nlet CandidateHome = class CandidateHome {\n  constructor(title, meta, http, router, authService, jobService, // Inject the new service\n  sentinelObserver) {\n    this.title = title;\n    this.meta = meta;\n    this.http = http;\n    this.router = router;\n    this.authService = authService;\n    this.jobService = jobService;\n    this.sentinelObserver = sentinelObserver;\n    this.userProfile = {};\n    this.defaultProfilePicture = \"/assets/placeholders/profile-placeholder.jpg\";\n    this.jobs = [];\n    this.appliedJobIds = [];\n    this.processingApplications = {};\n    this.applicationSuccess = {};\n    this.isLoading = false; // Changed to false initially\n\n    this.page = 1; // Pagination: current page\n\n    this.pageSize = 30; // Pagination: jobs per page\n\n    this.hasMoreJobs = true; // Flag to check if more jobs are available\n\n    this.images = ['src/assets/temp-jobs-icon/1.png', 'src/assets/temp-jobs-icon/2.png', 'src/assets/temp-jobs-icon/3.png', 'src/assets/temp-jobs-icon/4.png', 'src/assets/temp-jobs-icon/5.png', 'src/assets/temp-jobs-icon/6.png', 'src/assets/temp-jobs-icon/7.png', 'src/assets/temp-jobs-icon/8.png'];\n    this.jobsWithImages = this.jobs.map(job => Object.assign(Object.assign({}, job), {\n      imageSrc: this.getRandomImage()\n    }));\n    this.apiUrl = environment.apiUrl + 'api/jobs/';\n    this.title.setTitle('Candidate-Home - Flashyre');\n    this.meta.addTags([{\n      property: 'og:title',\n      content: 'Candidate-Home - Flashyre'\n    }, {\n      property: 'og:image',\n      content: 'https://aheioqhobo.cloudimg.io/v7/_playground-bucket-v2.teleporthq.io_/8203932d-6f2d-4493-a7b2-7000ee521aa2/9aea8e9c-27ce-scrollbarTop: number4011-a345-94a92ae2dbf8?org_if_sml=1&force_format=original'\n    }]);\n  }\n\n  getRandomImage() {\n    const randomIndex = Math.floor(Math.random() * this.images.length);\n    return this.images[randomIndex];\n  }\n\n  get hasMoreJobs() {\n    return this.jobService.hasMoreJobs;\n  }\n\n  ngOnInit() {\n    // Use cached jobs if available\n    this.jobs = this.jobService.getCachedJobs();\n\n    if (this.jobs.length === 0) {\n      this.loadMoreJobs(); // Load first page if cache is empty\n    }\n\n    this.loadUserProfile();\n    this.setupIntersectionObserver();\n  }\n\n  ngAfterViewInit() {\n    this.setupIntersectionObserver();\n  }\n\n  ngOnDestroy() {\n    if (this.sentinelObserver) {\n      this.sentinelObserver.disconnect();\n    }\n  }\n\n  loadUserProfile() {\n    const profileData = localStorage.getItem('userProfile');\n\n    if (profileData) {\n      this.userProfile = JSON.parse(profileData);\n    } else {\n      console.log(\"User Profile NOT fetched\");\n    }\n  }\n\n  loadMoreJobs() {\n    if (!this.jobService.hasMoreJobs || this.isLoading) {\n      return;\n    }\n\n    this.isLoading = true;\n    forkJoin({\n      newJobs: this.jobService.loadMoreJobs(),\n      appliedJobs: this.authService.getAppliedJobs()\n    }).subscribe(results => {\n      this.appliedJobIds = results.appliedJobs.applied_job_ids || []; // Filter out applied jobs from the new jobs\n\n      const filteredNewJobs = results.newJobs.filter(job => !this.appliedJobIds.includes(job.job_id));\n      this.jobs = this.jobs.concat(filteredNewJobs);\n      this.isLoading = false;\n    }, error => {\n      console.error('Error loading jobs:', error);\n      this.isLoading = false;\n    });\n  }\n\n  onScroll(event) {\n    const element = event.target;\n\n    if (element.scrollHeight - element.scrollTop <= element.clientHeight + 50 && !this.isLoading) {\n      this.loadMoreJobs(); // Load more jobs when near the bottom\n    }\n  }\n\n  navigateToAssessment(jobId) {\n    this.router.navigate(['/flashyre-rules', jobId]);\n  }\n\n  applyForJob(jobId, index) {\n    this.processingApplications[jobId] = true;\n    this.authService.applyForJob(jobId).subscribe(response => {\n      console.log('Application successful:', response);\n      this.applicationSuccess[jobId] = true;\n      this.appliedJobIds.push(jobId); // Remove the job from the list and cache\n\n      this.jobs = this.jobs.filter(job => job.job_id !== jobId);\n      this.jobService.removeJobFromCache(jobId); // No need for setTimeout since filtering is immediate\n    }, error => {\n      var _a;\n\n      console.error('Application failed:', error);\n      this.processingApplications[jobId] = false;\n      alert(((_a = error.error) === null || _a === void 0 ? void 0 : _a.error) || 'Failed to apply for this job');\n    });\n  }\n\n  setupIntersectionObserver() {\n    this.sentinelObserver = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting && !this.isLoading) {\n        this.loadMoreJobs();\n      }\n    }, {\n      threshold: 1.0\n    });\n    setTimeout(() => {\n      const sentinel = document.querySelector('#sentinel');\n\n      if (sentinel && this.sentinelObserver) {\n        this.sentinelObserver.observe(sentinel);\n      }\n    }, 0);\n  }\n\n};\nCandidateHome = __decorate([Component({\n  selector: 'candidate-home',\n  templateUrl: 'candidate-home.component.html',\n  styleUrls: ['candidate-home.component.css']\n})], CandidateHome);\nexport { CandidateHome };","map":null,"metadata":{},"sourceType":"module"}