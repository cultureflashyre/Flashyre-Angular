  <!-- src/app/pages/admin-create-job-step4/admin-create-job-step4.component.html -->
  <div *ngIf="showSuccessPopup" class="success-popup-overlay">
    <div class="success-popup-box">
      <svg class="success-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
        <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
        <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
      </svg>
      <p class="success-message">Successfully Created!</p>
    </div>
  </div>

  <navbar-for-admin-view
    rootClassName="navbar-for-candidate-viewroot-class-name"
  >
    <ng-template>
      <div class="candidate-home-fragment10">
        <a [routerLink]="['/candidate-dashboard-main']" class="candidate-home-text100">Dashboard</a>
      </div>
    </ng-template>
    <ng-template>
      <div class="candidate-home-fragment11">
        <a [routerLink]="['/candidate-assessment']" class="candidate-home-text101">Upskill</a>
      </div>
    </ng-template>
    <ng-template>
      <div class="candidate-home-fragment12">
        <a [routerLink]="['/candidate-assessment']" class="candidate-home-text102">Assessment</a>
      </div>
    </ng-template>
    <ng-template>
      <div class="candidate-home-fragment13">
        <span [routerLink]="['/candidate-dashboard-main']" class="candidate-home-text103">Jobs for you</span>
      </div>
    </ng-template>
    <ng-template #text1>
      <div class="candidate-home-fragment14">
        <span [routerLink]="['/profile-overview-page']" class="candidate-home-text104">Profile</span>
      </div>
    </ng-template>
    <ng-template #text2>
      <div class="candidate-home-fragment15">
        <span class="candidate-home-text105">Preference</span>
      </div>
    </ng-template>
    <ng-template #text3>
      <div class="candidate-home-fragment16">
        <span class="candidate-home-text106">Settings</span>
      </div>
    </ng-template>
    <ng-template #text4>
      <div class="candidate-home-fragment17">
        <span class="candidate-home-text107">
          {{ userProfile.first_name }} {{ userProfile.last_name }}
        </span>
      </div>
    </ng-template>
    <ng-template #text5>
      <div class="candidate-home-fragment18">
        <span class="candidate-home-text108">âœ… 90% Profile Completion</span>
      </div>
    </ng-template>
    <ng-template #text6>
      <div class="candidate-home-fragment19">
        <span class="candidate-home-text109">View & edit profile</span>
      </div>
    </ng-template>
    <ng-template #text7>
      <div class="candidate-home-fragment20">
        <a [routerLink]="['/candidate-dashboard-main']" class="candidate-home-text110">Dashboard</a>
      </div>
    </ng-template>
    <ng-template #text8>
      <div class="candidate-home-fragment21">
        <span class="candidate-home-text111">Upskill</span>
      </div>
    </ng-template>
    <ng-template #text9>
      <div class="candidate-home-fragment22">
        <a [routerLink]="['/candidate-assessment']" class="candidate-home-text112">Assessment</a>
      </div>
    </ng-template>
    <ng-template #text10>
      <div class="candidate-home-fragment23">
        <span class="candidate-home-text113">Jobs for you</span>
      </div>
    </ng-template>
    <ng-template #text11>
      <div class="candidate-home-fragment24">
        <span class="candidate-home-text114">Preference</span>
      </div>
    </ng-template>
    <ng-template #text12>
      <div class="candidate-home-fragment25">
        <span class="candidate-home-text115">Settings</span>
      </div>
    </ng-template>
    <ng-template #text13>
      <div class="candidate-home-fragment26">
        <span class="candidate-home-text116">Logout</span>
      </div>
    </ng-template>
    <ng-template #text31>
      <div class="candidate-home-fragment27">
        <span class="candidate-home-text117">Logout</span>
      </div>
    </ng-template>
  </navbar-for-admin-view>
  <div class="admin-create-job-step4-container1">
    <div
      id="create-job-post-3rd-page-main-container"
      class="admin-create-job-step4-create-job-post3rd-page-main-container"
    >
      <div
        id="interview-container"
        class="admin-create-job-step4-interview-container"
      >
        <div
          id="progress-bar-3-container"
          class="admin-create-job-step4-progress-bar3-container1"
        >
          <div
            id="progressBar-3-container"
            class="admin-create-job-step4-progress-bar3-container2"
          >
            <div class="admin-create-job-step4-container2">
              <div class="admin-create-job-step4-container3">

                  <!-- START: PROGRESS BAR CODE -->
                  <div class='progress-bar'>
                    <!-- Added 'active' class to the first step -->
                    <div class='step active'>
                      <div class='step-circle'>&#10003;</div>
                      <span>Create Job Post</span>
                    </div>
                    <div class='step active'>
                      <div class='step-circle'>&#10003;</div>
                      <span>Assessment for Job</span>
                    </div>
                    <div class='step'>
                      <div class='step-circle'>&#10003;</div>
                      <span>Interview process</span>
                    </div>
                  </div>
              </div>
            </div>
          </div>
        </div>
        <div
          id="interview-process-container"
          class="admin-create-job-step4-interview-process-container"
        >
          <span
            id="interview-process-text"
            class="admin-create-job-step4-interview-process-text"
          >
            Interview Process
          </span>
          <!-- Form binds to the main FormGroup in the component -->
          <form [formGroup]="interviewForm" (ngSubmit)="onSubmit()">
            <!-- Container binds to the 'stages' FormArray -->
            <div formArrayName="stages" class="admin-create-job-step4-different-stages-container">
              <!-- This div will be repeated for each stage in the FormArray -->
              <div *ngFor="let stageControl of stages.controls; let i = index" [formGroupName]="i" class="admin-create-job-step4-different-stage-container">
                <!-- 1. Stage Name (Conditional Dropdown/Input) -->
                <div class="form-field-wrapper stage-field">
                  <label [for]="'stage-name-' + i">Interview Stage <span class="required-asterisk">*</span></label>
                  <!-- Show dropdown if 'Customize' is NOT selected -->
                  <select *ngIf="stageControl.get('stage_name')?.value !== 'Customize'" formControlName="stage_name" [id]="'stage-name-' + i">
                    <option value="Screening">Screening</option>
                    <option value="Technical interview - 1">Technical interview - 1</option>
                    <option value="Technical interview - 2">Technical interview - 2</option>
                    <option value="HR interview">HR interview</option>
                    <option value="Customize">Customize</option>
                  </select>
                  <!-- Show text input ONLY if 'Customize' is selected -->
                  <input *ngIf="stageControl.get('stage_name')?.value === 'Customize'" type="text" formControlName="custom_stage_name" placeholder="Enter Custom Stage Name" [id]="'custom-stage-name-' + i">
                  <!-- Validation Message -->
                  <div *ngIf="stageControl.get('custom_stage_name')?.touched && stageControl.get('custom_stage_name')?.errors?.required" class="field-error-message">
                    Custom name is required.
                  </div>
                </div>
                <!-- 2. Date Picker -->
                <div class="form-field-wrapper date-field">
                  <label [for]="'date-input-' + i">Enter Date <span class="required-asterisk">*</span></label>
                  <div class="compact-date-input-wrapper">
                    <input 
                      type="date" 
                      formControlName="stage_date"
                      [min]="minDateString"
                      [id]="'date-input-' + i"
                      class="compact-date-input"
                      (input)="validateDateInput($event, stageControl)"
                      >
                  </div>
                  <!-- Error for invalid format (High Priority) -->
                  <div *ngIf="stageControl.get('stage_date')?.hasError('invalidDate') && stageControl.get('stage_date')?.touched" class="field-error-message">
                    A valid date is required.
                  </div>
                  <!-- Error for empty field (Low Priority) -->
                  <div *ngIf="stageControl.get('stage_date')?.hasError('required') && !stageControl.get('stage_date')?.hasError('invalidDate') && stageControl.get('stage_date')?.touched" class="field-error-message">
                    Date is Required
                  </div>
                </div>
                <!-- 3. Mode Dropdown -->
                <div class="form-field-wrapper mode-field">
                  <label [for]="'mode-select-' + i">Interview Mode <span class="required-asterisk">*</span></label>
                  <select formControlName="mode" [id]="'mode-select-' + i">
                    <option value="Online">Online</option>
                    <option value="Offline">Offline</option>
                  </select>
                </div>
                <!-- 4. Assigned To Input -->
                <div class="form-field-wrapper assigned-to-field">
                  <label [for]="'assigned-to-' + i">Assigned To <span class="required-asterisk">*</span></label>
                  <input type="email" formControlName="assigned_to" placeholder="interviewer@company.com" [id]="'assigned-to-' + i">
                  <!-- Validation Messages -->
                  <div *ngIf="stageControl.get('assigned_to')?.touched && stageControl.get('assigned_to')?.errors?.required" class="field-error-message">
                    Email is required.
                  </div>
                  <div *ngIf="stageControl.get('assigned_to')?.touched && stageControl.get('assigned_to')?.errors?.email" class="field-error-message">
                    Please enter a valid email.
                  </div>
                </div>
                <!-- 5. Remove Button -->
                <div class="remove-icon-wrapper">
                  <svg 
                    (click)="removeStage(i)"
                    id="remove-icon"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    class="admin-create-job-step4-remove-icon"
                    title="Remove Stage">
                    <path d="M19 13H5v-2h14z" fill="currentColor"></path>
                  </svg>
                </div>
              </div>
            </div>
            <!-- 6. Add Stage Button -->
            <div id="add-section-container" class="admin-create-job-step4-add-section-container">
              <button type="button" (click)="addStage()" class="admin-create-job-step4-add-section-text button">
                + Add Stage
              </button>
            </div>
          </form>
                </div>
      </div>
      <!-- Updated Footer with Dropdown -->
      <div class="admin-create-job-step4-footer-container">
        <!-- Cancel and Previous buttons remain the same -->
        <button
          type="button"
          id="cancel-button"
          name="cancel-button"
          class="admin-create-job-step4-cancel-button button"
          (click)="onCancel()"
          [disabled]="isSubmitting"
        >
          <span id="cancel-text" class="admin-create-job-step4-cancel-text">
            Cancel
          </span>
        </button>
        <button
          type="button"
          id="previous-button"
          name="previous-button"
          class="admin-create-job-step4-previous-button button"
          (click)="onPrevious()"
          [disabled]="isSubmitting"
        >
          <span id="previous-text" class="admin-create-job-step4-previous-text">
            Previous
          </span>
        </button>

        <!-- Dropdown container -->
        <div class="admin-create-job-step4-dropdown-container">
          <button
            type="button"
            class="admin-create-job-step4-save-button button"
            [disabled]="isSubmitting || interviewForm.invalid"
            (click)="toggleDropdown()"
          >
            <span class="admin-create-job-step4-save-text">
              {{ isSubmitting ? 'Saving...' : 'Save' }}
            </span>
            <!-- Simple dropdown arrow icon -->
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
            </svg>
          </button>

          <!-- Dropdown menu -->
          <div class="admin-create-job-step4-dropdown-menu" *ngIf="showDropdown">
            <button
              type="button"
              class="admin-create-job-step4-dropdown-item"
              (click)="onSaveJobAndAssessment()"
              [disabled]="isSubmitting || interviewForm.invalid"
            >
              Save Job and Assessment
            </button>
            <button
              type="button"
              class="admin-create-job-step4-dropdown-item"
              (click)="onViewScore()"
              [disabled]="isSubmitting"
            >
              View Score
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>