<div class="recruiter-view-job-applications1-container">

  <app-alert-message
    *ngIf="showAlert"
    [message]="alertMessage"
    [buttons]="alertButtons"
    (buttonClicked)="onAlertButtonClicked($event)"
    (close)="showAlert = false">
  </app-alert-message>

  <div class="popup-overlay" *ngIf="showAddStagePopup">
    <div class="popup-content">
      <h3>Add New Interview Stage</h3>
      
      
      <!-- This form binds to the 'newStageForm' FormGroup in your component -->
      <form [formGroup]="newStageForm" (ngSubmit)="onSaveNewStage()">
        <div class="form-fields-container">
          <!-- 1. Stage Name -->
          <div class="form-field-wrapper stage-field">
            <label for="stage-name-popup">Interview Stage <span class="required-asterisk">*</span></label>
            <select *ngIf="newStageForm.get('stage_name')?.value !== 'Customize'" formControlName="stage_name" id="stage-name-popup">
              <option value="Screening">Screening</option>
              <option value="Technical interview - 1">Technical interview - 1</option>
              <option value="Technical interview - 2">Technical interview - 2</option>
              <option value="HR interview">HR interview</option>
              <option value="Customize">Customize</option>
            </select>
            <input *ngIf="newStageForm.get('stage_name')?.value === 'Customize'" type="text" formControlName="custom_stage_name" placeholder="Enter Custom Stage Name" id="custom-stage-name-popup">
            <div *ngIf="newStageForm.get('custom_stage_name')?.touched && newStageForm.get('custom_stage_name')?.errors?.required" class="field-error-message">
              Custom name is required.
            </div>
          </div>
          <!-- 2. Date Picker -->
          <div class="form-field-wrapper date-field">
            <label for="date-input-popup">Enter Date <span class="required-asterisk">*</span></label>
            <input type="date" formControlName="stage_date" [min]="minDateString" id="date-input-popup">
            <div *ngIf="newStageForm.get('stage_date')?.touched && newStageForm.get('stage_date')?.errors?.required" class="field-error-message">
              Date is required.
            </div>
          </div>
          <!-- 3. Mode Dropdown -->
          <div class="form-field-wrapper mode-field">
            <label for="mode-select-popup">Interview Mode <span class="required-asterisk">*</span></label>
            <select formControlName="mode" id="mode-select-popup">
              <option value="Online">Online</option>
              <option value="Offline">Offline</option>
            </select>
          </div>
          <!-- 4. Assigned To Input -->
          <div class="form-field-wrapper assigned-to-field">
            <label for="assigned-to-popup">Assigned To <span class="required-asterisk">*</span></label>
            <input type="email" formControlName="assigned_to" placeholder="interviewer@company.com" id="assigned-to-popup">
            <div *ngIf="newStageForm.get('assigned_to')?.touched && newStageForm.get('assigned_to')?.errors?.required" class="field-error-message">
              Email is required.
            </div>
            <div *ngIf="newStageForm.get('assigned_to')?.touched && newStageForm.get('assigned_to')?.errors?.email" class="field-error-message">
              Please enter a valid email.
            </div>
          </div>
        </div>
        
        <!-- Popup Buttons -->
        <div class="popup-actions">
          <button type="button" class="popup-button cancel" (click)="closeAddStagePopup()">Cancel</button>
          <button type="submit" class="popup-button save" [disabled]="newStageForm.invalid || isSubmitting">
            <span *ngIf="!isSubmitting">Save</span>
            <span *ngIf="isSubmitting">Saving...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
  <div
    id="recruiter-view-job-applicatins-1-main-container"
    class="recruiter-view-job-applications1-recruiter-view-job-applicatins1-main-container"
  >
    <navbar-for-recruiter-view
      rootClassName="navbar-for-recruiter-viewroot-class-name7"
    >
      <ng-template #text>
        <div class="recruiter-view-job-applications1-fragment10">
          <span class="recruiter-view-job-applications1-text10">2</span>
        </div>
      </ng-template>
      <ng-template #link1>
        <div class="recruiter-view-job-applications1-fragment11">
          <span class="recruiter-view-job-applications1-text11">Home</span>
        </div>
      </ng-template>
      <ng-template #link4>
        <div class="recruiter-view-job-applications1-fragment12">
          <span class="recruiter-view-job-applications1-text12">
            Job Posted
          </span>
        </div>
      </ng-template>
      <ng-template #text1>
        <div class="recruiter-view-job-applications1-fragment13">
          <span class="recruiter-view-job-applications1-text13">Profile</span>
        </div>
      </ng-template>
      <ng-template #text2>
        <div class="recruiter-view-job-applications1-fragment14">
          <span class="recruiter-view-job-applications1-text14">
            Preference
          </span>
        </div>
      </ng-template>
      <ng-template #text3>
        <div class="recruiter-view-job-applications1-fragment15">
          <span class="recruiter-view-job-applications1-text15">Settings</span>
        </div>
      </ng-template>
      <ng-template #text7>
        <div class="recruiter-view-job-applications1-fragment16">
          <span class="recruiter-view-job-applications1-text16">Home</span>
        </div>
      </ng-template>
      <ng-template #text9>
        <div class="recruiter-view-job-applications1-fragment17">
          <span class="recruiter-view-job-applications1-text17">
            Notifications
          </span>
        </div>
      </ng-template>
      <ng-template #text10>
        <div class="recruiter-view-job-applications1-fragment18">
          <span class="recruiter-view-job-applications1-text18">
            Jobs Posted
          </span>
        </div>
      </ng-template>
      <ng-template #text11>
        <div class="recruiter-view-job-applications1-fragment19">
          <span class="recruiter-view-job-applications1-text19">
            Preference
          </span>
        </div>
      </ng-template>
      <ng-template #text12>
        <div class="recruiter-view-job-applications1-fragment20">
          <span class="recruiter-view-job-applications1-text20">Settings</span>
        </div>
      </ng-template>
      <ng-template #text13>
        <div class="recruiter-view-job-applications1-fragment21">
          <span class="recruiter-view-job-applications1-text21">Logout</span>
        </div>
      </ng-template>
      <ng-template #text14>
        <div class="recruiter-view-job-applications1-fragment22">
          <span class="recruiter-view-job-applications1-text22">2</span>
        </div>
      </ng-template>
      <ng-template #text15>
        <div class="recruiter-view-job-applications1-fragment23">
          <span class="recruiter-view-job-applications1-text23">
            Leslie Alexander
          </span>
        </div>
      </ng-template>
      <ng-template #text16>
        <div class="recruiter-view-job-applications1-fragment24">
          <span class="recruiter-view-job-applications1-text24">Google</span>
        </div>
      </ng-template>
      <ng-template #text31>
        <div class="recruiter-view-job-applications1-fragment25">
          <span class="recruiter-view-job-applications1-text25">Logout</span>
        </div>
      </ng-template>
      <ng-template #text32>
        <div class="recruiter-view-job-applications1-fragment26">
          <span class="recruiter-view-job-applications1-text26">
            <span>Software Development</span>
            <br />
            <span>Mountain View, CA</span>
          </span>
        </div>
      </ng-template>
      <ng-template #text1411>
        <div class="recruiter-view-job-applications1-fragment27">
          <span class="recruiter-view-job-applications1-text30">2</span>
        </div>
      </ng-template>
    </navbar-for-recruiter-view>
    <div
      id="recruiter-view-job-application-first-container"
      class="recruiter-view-job-applications1-recruiter-view-job-application-first-container"
    >
      <div
        id="job-details-main-container"
        class="recruiter-view-job-applications1-job-details-main-container1"
      >
        <div
          id="arrow-icon-container"
          class="recruiter-view-job-applications1-arrow-icon-container"
        >
          <svg
            id="arrow-icon"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            class="recruiter-view-job-applications1-arrow-icon"
            (click)="navigateToRecruiterHome()"
            [routerLink]="['/job-post-list']"
          >
            <g
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 12H3.5" stroke-dasharray="20" stroke-dashoffset="20">
                <animate
                  dur="0.3s"
                  fill="freeze"
                  values="20;0"
                  attributeName="stroke-dashoffset"
                ></animate>
              </path>
              <path
                d="M3 12L10 19M3 12L10 5"
                stroke-dasharray="12"
                stroke-dashoffset="12"
              >
                <animate
                  dur="0.2s"
                  fill="freeze"
                  begin="0.3s"
                  values="12;0"
                  attributeName="stroke-dashoffset"
                ></animate>
              </path>
            </g>
          </svg>
        </div>
        <span
          id="job-detail-text"
          class="recruiter-view-job-applications1-job-detail-text"
        >
          Job Detail
        </span>
      </div>
      <div
        id="job-details-main-container"
        class="recruiter-view-job-applications1-job-details-main-container2"
      >
        <recruiter-flow-large-card
          rootClassName="recruiter-flow-large-cardroot-class-name3"
          [imageSrc]="job?.logo"
          [companyInitials]="job?.initials"
          image Alt="Company Logo"
          [imageSrc5]="candidates[0]?.profile_picture_url || 'https://s3-alpha-sig.figma.com/img/8254/7737/b3eefffb9d9234e6fe8609789fdf7c00?Expires=1737331200&Key-Pair-Id=APKAQ4GOSFWCVNEHN3O4&Signature=jNmjxko0T1JxAaxAQ4~VMsPHjMdFsJAVP8h0taNQhb2~mkXOp--KmftiZtXcqkM5VQ0nm8oHRDmx97aeqi3V8mkGcEPpBI2npi4mGaMxm6pkG~adNCWWQ1SNWJ9xWUQjjX94BcDwcl-LxTEe9vKRK3SabpcqhF9nYqdK7j-QRoJBffY6uoEr1WQJyAEzmDB~GkRdHeQf7pLUGDJZQ0oq1tqw1Lds~lssM7~4Sx3uUJtNRs3W7PeczCfu7eya~Gy0751GrR7UmgIUqPG6DZz3bEPj5Wd9azxcqHVFAEfHtuDT1Gl2X1UjShDZKvIFyqUvRBYcr8tpxdi69cPMRhRLg__'"
          [imageSrc6]="candidates[1]?.profile_picture_url || 'https://s3-alpha-sig.figma.com/img/b74a/bea4/ebc9cfc1a53c3f5e2e37843d60bf6944?Expires=1737331200&Key-Pair-Id=APKAQ4GOSFWCVNEHN3O4&Signature=mzV95~Di8P6dzRNgufJKyH68f3UqvlGYcYMjXkzOgwT0pBb5Qw6In072uR9jkN6BFmw4HrkP70x9BHfkVwkZbMVRvPL0e2pHMRXGFTFsMq6sQWythHaBlVtJ5blJ9DP6B-HyJP92sgZ3sxxqAVrISABTQtBM-uOBpA~2S0PUg8vNy-3QqVNsez9U24Zf5NwIh98cE0RiTjQN2DIpluEvto4KkxU6DIq4y2nHpSUDc8SgIWt2bigDd5XALKxvLTTDzOEpwcAEx6Ul8Ld1CxHUnx90pKn2Yi~TytFDg7jvqtHA9OcTU1M3SA1ImRyh42bGA5MJ4HwCvUteyteOVv181w__'"
          imageAlt5="Candidate Profile Picture"
          imageAlt6="Candidate Profile Picture"
        >
          <ng-template #text>
            <div class="recruiter-view-job-applications1-fragment28">
              <span class="recruiter-view-job-applications1-text31"
              [title]="job?.company_name">
                {{ job?.company_name }}
              </span>
            </div>
          </ng-template>
          <ng-template #text1>
            <div class="recruiter-view-job-applications1-fragment29">
              <span class="recruiter-view-job-applications1-text32">
                {{ job?.title }}
              </span>
            </div>
          </ng-template>
          <ng-template #text2>
            <div class="recruiter-view-job-applications1-fragment30">
              <span class="recruiter-view-job-applications1-text33">
                {{ job?.location }} · {{ job?.posted_ago }}
              </span>
            </div>
          </ng-template>
          <ng-template #text21>
            <div class="recruiter-view-job-applications1-fragment31">
              <span class="recruiter-view-job-applications1-text34">
                {{ job?.num_applied_display }}
              </span>
            </div>
          </ng-template>
        </recruiter-flow-large-card>
        <div
          id="candidates-applied-job-title-screening-main-container"
          class="recruiter-view-job-applications1-candidates-applied-job-title-screening-main-container"
        >
          <div
            id="applied-sourced-selected-main-container"
            class="recruiter-view-job-applications1-applied-sourced-selected-main-container"
          >
            <div id="languages-main-container" class="recruiter-view-job-applications1-languages-main-container">

              <!-- Left Arrow -->
  <div 
    id="left-arrow-container" 
    class="arrow-container left-arrow-shadow" 
    [class.disabled]="currentScrollIndex === 0"
    (click)="navigateCarousel('prev')">
    <svg viewBox="0 0 24 24" class="nav-arrow-icon"><path d="m10.828 12l4.95 4.95l-1.414 1.415L8 12l6.364-6.364l1.414 1.414z" fill="currentColor"></path></svg>
  </div>
  
  <!-- Fixed "Applied" Tab -->
  <div 
    class="recruiter-view-job-applications1-language-tab fixed-tab"
    [class.active-section]="activeStage.id === 'applied'"
    (click)="changeTab({ id: 'applied', stage_name: 'Applied' })">
    <span class="skill-tab-name">Applied ({{ appliedCount }})</span>
  </div>

  <div 
    id="add-stage-button" 
    class="add-new-skill-for-ai-mcq-container add-skill-button fixed-tab" 
    title="Add a new interview stage" 
    (click)="addStage()">
    <svg viewBox="0 0 24 24" class="nav-arrow-icon plus-icon"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"></path></svg>
    <span class="add-skill-text">Add Stage</span>
  </div>
  
  <!-- Scrollable Stages Viewport -->
  <div #stageViewport class="recruiter-view-job-applications1-container18">
    <div #stageTrack class="skill-scroll-track">
      <div *ngFor="let stage of interviewStages" 
          class="recruiter-view-job-applications1-language-tab" 
          [class.active-section]="stage.id === activeStage.id" 
          (click)="changeTab(stage)">

        <span class="skill-tab-name">{{ stage.stage_name }} ({{ stage.count }})</span>
        
        <!-- Remove Icon -->
        <span class="remove-stage-icon" title="Remove Stage" (click)="removeStage(stage, $event)">×</span>
      </div>
    </div>
  </div>

  <!-- Right Arrow -->
  <div 
    id="right-arrow-container" 
    class="arrow-container right-arrow-shadow" 
    [class.disabled]="currentScrollIndex >= maxScrollIndex"
    (click)="navigateCarousel('next')">
    <svg viewBox="0 0 24 24" class="nav-arrow-icon"><path d="m13.172 12l-4.95-4.95l1.414-1.413L16 12l-6.364 6.364l-1.414-1.415z" fill="currentColor"></path></svg>
  </div>

  
</div>
          </div>
          <!-- <div
            id="job-title-location-experience-main-container"
            class="recruiter-view-job-applications1-job-title-location-experience-main-container"
          >
            <div
              id="job-title-container"
              class="recruiter-view-job-applications1-job-title-container"
            >
              <div
                id="search-icon-container"
                class="recruiter-view-job-applications1-search-icon-container"
              >
                <svg
                  id="search-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  class="recruiter-view-job-applications1-search-icon"
                >
                  <g fill="none" fill-rule="evenodd">
                    <path
                      d="M24 0v24H0V0zM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"
                    ></path>
                    <path
                      d="M5 10a5 5 0 1 1 10 0a5 5 0 0 1-10 0m5-7a7 7 0 1 0 4.192 12.606l5.1 5.101a1 1 0 0 0 1.415-1.414l-5.1-5.1A7 7 0 0 0 10 3"
                      fill="currentColor"
                    ></path>
                  </g>
                </svg>
              </div>
              <input 
                type="text" 
                [(ngModel)]="searchJobTitle" 
                placeholder="Job title, Keyword..." 
                class="recruiter-view-job-applications1-job-title-keyword-text"
              />
            </div>
            <div
              id="location-container"
              class="recruiter-view-job-applications1-location-container"
            >
              <div
                id="location-icon-container"
                class="recruiter-view-job-applications1-location-icon-container"
              >
                <svg
                  id="location-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  class="recruiter-view-job-applications1-location-icon"
                >
                  <g
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M12.56 20.82a.96.96 0 0 1-1.12 0C6.611 17.378 1.486 10.298 6.667 5.182A7.6 7.6 0 0 1 12 3c2 0 3.919.785 5.333 2.181c5.181 5.116.056 12.196-4.773 15.64"
                    ></path>
                    <path d="M12 12a2 2 0 1 0 0-4a2 2 0 0 0 0 4"></path>
                  </g>
                </svg>
              </div>
              <input 
                type="text" 
                [(ngModel)]="searchLocation" 
                placeholder="Location" 
                class="recruiter-view-job-applications1-location-text"
                disabled
              />
            </div>
            <div
              id="experience-container"
              class="recruiter-view-job-applications1-experience-container"
            >
              <div
                id="briefcase-icon-container"
                class="recruiter-view-job-applications1-briefcase-icon-container"
              >
                <svg
                  viewBox="0 0 256 256"
                  class="recruiter-view-job-applications1-briefcase-icon"
                >
                  <path
                    d="M216.008 66H174V56a22.025 22.025 0 0 0-22-22h-48a22.025 22.025 0 0 0-22 22v10H40.008a14.016 14.016 0 0 0-14 14v128a14.016 14.016 0 0 0 14 14h176a14.016 14.016 0 0 0 14-14V80a14.016 14.016 0 0 0-14-14zM94 56a10.011 10.011 0 0 1 10-10h48a10.011 10.011 0 0 1 10 10v10H94zm124.008 152a2.003 2.003 0 0 1-2 2h-176a2.003 2.003 0 0 1-2-2V80a2.003 2.003 0 0 1 2-2h176a2.003 2.003 0 0 1 2 2z"
                    fill="currentColor"
                  ></path>
                </svg>
              </div>
              <input 
                type="text" 
                [(ngModel)]="searchExperience" 
                placeholder="Experience" 
                class="recruiter-view-job-applications1-experience-text"
                disabled
              />
            </div>
            <div
              id="filter-icon-container"
              class="recruiter-view-job-applications1-filter-icon-container"
            >
              <svg
                id="filter-icon"
                width="32"
                height="32"
                viewBox="0 0 32 32"
                class="recruiter-view-job-applications1-filter-icon"
              >
                <path
                  d="M30 8h-4.1c-.5-2.3-2.5-4-4.9-4s-4.4 1.7-4.9 4H2v2h14.1c.5 2.3 2.5 4 4.9 4s4.4-1.7 4.9-4H30zm-9 4c-1.7 0-3-1.3-3-3s1.3-3 3-3s3 1.3 3 3s-1.3 3-3 3M2 24h4.1c.5 2.3 2.5 4 4.9 4s4.4-1.7 4.9-4H30v-2H15.9c-.5-2.3-2.5-4-4.9-4s-4.4 1.7-4.9 4H2zm9-4c1.7 0 3 1.3 3 3s-1.3 3-3 3s-3-1.3-3-3s1.3-3 3-3"
                  fill="currentColor"
                ></path>
              </svg>
            </div>
            <button
              id="search-button"
              type="button"
              class="recruiter-view-job-applications1-search-button button"
              (click)="onSearchClick()"
            >
              Search
            </button>
          </div> -->
          <div
            id="screening-assessment-interview-main-container"
            class="recruiter-view-job-applications1-screening-assessment-interview-main-container"
          >
          <div class="jd-dropdown-container">
    <!-- Main button that now also acts as a dropdown toggle -->
    <button
      id="view-jd-dropdown-button"
      type="button"
      class="recruiter-view-job-applications1-view-jd-button button"
      (click)="toggleJdDropdown($event)"
      
    >
      View / Download
      <!-- Simple dropdown arrow -->
      <span style="margin-left: 8px;">▼</span>
    </button>
    
    <!-- The dropdown menu itself, shown conditionally -->
    <div class="jd-dropdown-menu" *ngIf="showJdDropdown">
      <button 
        (click)="openJD(job.job_description_url)"
        [disabled]="!job?.job_description_url"
        [title]="job?.job_description_url ? 'View Job Description' : 'No Job Description File available'">
        View JD
      </button>
      <button 
        (click)="downloadAssessment()" 
        [disabled]="isDownloading || !job?.has_assessment"
        [title]="job?.has_assessment ? 'Download assessment questions as PDF' : 'No assessment has been created for this job'"
      >
        {{ isDownloading ? 'Downloading...' : 'Download Assessment' }}
      </button>
    </div>
  </div>
  <!-- --- MODIFICATION END --- -->

  <button
    *ngIf="nextStage"
    id="dynamic-invite-button"
    type="button"
    class="recruiter-view-job-applications1-screening-call-invite-button button"
    (click)="sendInvite()">
    Invite to {{ nextStage.stage_name }}
  </button>
</div>

          <div
            id="candidate-details-main-container"
            class="recruiter-view-job-applications1-candidate-details-main-container"
            *ngIf="candidates.length > 0; else noCandidates"
          >
            <div
              id="name-designation-matching-score-status-container"
              class="recruiter-view-job-applications1-name-designation-matching-score-status-container"
            >
              <div
                id="checkbox-container"
                class="recruiter-view-job-applications1-checkbox-container"
              >
                <input
                  type="checkbox"
                  id="checkbox-icon"
                  class="recruiter-view-job-applications1-checkbox-icon"
                  [checked]="masterChecked" 
                  (change)="toggleAll($event.target.checked)"
                />
              </div>
              <div
                id="name-container"
                class="recruiter-view-job-applications1-name-container"
                (click)="sortData('name')" style="cursor: pointer;"
              >
                <span
                  id="name-text"
                  class="recruiter-view-job-applications1-name-text"
                >
                  Name
                  <span *ngIf="sortColumn === 'name'">{{ sortDirection === 'asc' ? ' ▲' : ' ▼' }}</span>
                </span>
              </div>
              <div
                id="designation-container"
                class="recruiter-view-job-applications1-designation-container"
              >
                <span
                  id="designation-text"
                  class="recruiter-view-job-applications1-designation-text"
                >
                  Designation
                </span>
              </div>
              <div
                id="job-matching-score-container"
                class="recruiter-view-job-applications1-job-matching-score-container"
                (click)="sortData('score')" style="cursor: pointer;"
              >
                <span
                  id="job-matching-score-text"
                  class="recruiter-view-job-applications1-job-matching-score-text"
                >
                  Job matching<br>Score
                  <span *ngIf="sortColumn === 'score'">{{ sortDirection === 'asc' ? ' ▲' : ' ▼' }}</span>
                </span>
              </div>
               <!-- 1. ADD a new header for the Assessment Score column. -->
    <div
      id="assessment-score-container"
      class="recruiter-view-job-applications1-assessment-score-container"
      (click)="sortData('assessment_score')" style="cursor: pointer;"
    >
      <span
        id="assessment-score-text"
        class="recruiter-view-job-applications1-assessment-score-text"
      >
        Assessment<br>Score
        <span *ngIf="sortColumn === 'assessment_score'">{{ sortDirection === 'asc' ? ' ▲' : ' ▼' }}</span>
      </span>
    </div>
              <div
                id="status-container"
                class="recruiter-view-job-applications1-status-container"
                (click)="sortData('status')" style="cursor: pointer;"
              >
                <span class="recruiter-view-job-applications1-text36">
                  Status
                  <span *ngIf="sortColumn === 'status'">{{ sortDirection === 'asc' ? ' ▲' : ' ▼' }}</span>
                </span>
              </div>
            </div>
            <div
              id="candidate-details-container"
              class="recruiter-view-job-applications1-candidate-details-container"
            >
              <div
                *ngFor="let candidate of candidates"
                id="candidate-details-container-1"
                class="recruiter-view-job-applications1-candidate-details-container1"
              >
                <div
                  id="check-box-container"
                  class="recruiter-view-job-applications1-check-box-container"
                >
                  <input
                    type="checkbox"
                    id="check-box"
                    [checked]="candidate.isSelected"
                    (change)="onCheckboxChange(candidate, $event.target.checked)"
                    class="recruiter-view-job-applications1-check-box"
                  />
                </div>
                <div
                  id="candidate-name-container"
                  class="recruiter-view-job-applications1-candidate-name-container"
                >
                  <div
                    id="candidate-profile-icon-container"
                    class="recruiter-view-job-applications1-candidate-profile-icon-container"
                  >
                    <img
                      *ngIf="candidate.profile_picture_url"
                      id="candidate-profile-icon"
                      [src]="candidate.profile_picture_url"
                      width="24"
                      height="24"
                      class="recruiter-view-job-applications1-candidate-profile-icon"
                      alt="Candidate Profile Picture"
                    />
                    <svg
                      *ngIf="!candidate.profile_picture_url"
                      id="candidate-profile-icon"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      class="recruiter-view-job-applications1-candidate-profile-icon"
                    >
                      <path
                        d="M18.685 19.097A9.72 9.72 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.72 9.72 0 0 0 3.065 7.097A9.72 9.72 0 0 0 12 21.75a9.72 9.72 0 0 0 6.685-2.653m-12.54-1.285A7.49 7.49 0 0 1 12 15a7.49 7.49 0 0 1 5.855 2.812A8.22 8.22 0 0 1 12 20.25a8.22 8.22 0 0 1-5.855-2.438M15.75 9a3.75 3.75 0 1 1-7.5 0a3.75 3.75 0 0 1 7.5 0"
                        fill="currentColor"
                        clip-rule="evenodd"
                        fill-rule="evenodd"
                      ></path>
                    </svg>
                  </div>
                  <span
                    id="candidate-name-text"
                    class="recruiter-view-job-applications1-candidate-name-text candidate-name"
                    [title]="candidate.user.full_name"
                  >
                    {{ candidate.user.full_name }}
                  </span>
                </div>
                <div
                  id="candidate-designation-company-name-container"
                  class="recruiter-view-job-applications1-candidate-designation-company-name-container"
                >
                  <span
                    id="candidate-designation-company-name-text"
                    class="recruiter-view-job-applications1-candidate-designation-company-text candidate-designation"
                    [title]="candidate.designation"
                  >
                    {{ candidate.designation }}
                  </span>
                  <div id="view-cv-container" class="recruiter-view-job-applications1-view-cv-container" (click)="openCV(candidate.resume_url)">
    <svg id="eye-icon" width="24" height="24" viewBox="0 0 24 24" class="recruiter-view-job-applications1-eye-icon">
      <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" fill="currentColor"/>
    </svg>
    <span id="view-cv-text" class="recruiter-view-job-applications1-view-cv-text">View CV</span>
  </div>
                </div>
                <div
        id="matching-score-container"
        class="recruiter-view-job-applications1-matching-score-container"
      >
        <span
          id="matching-score-percentage-text"
          class="recruiter-view-job-applications1-matching-score-percentage-text"
        >
          <!-- Display the real score from the database, defaulting to 0 if null/undefined, and add a '%' sign. -->
          {{ (candidate.matching_score || 0) | number:'1.0-2' }}%
        </span>
      </div>
      <div
        id="assessment-score-cell-container"
        class="recruiter-view-job-applications1-assessment-score-container"
      >
        <span
          id="assessment-score-percentage-text"
          class="recruiter-view-job-applications1-matching-score-percentage-text"
        >
          {{ candidate.assessment_score != null ? (candidate.assessment_score | number:'1.0-2') + '%' : 'N/A' }}
        </span>
      </div>
                <div
                  id="candidate-work-status-container"
                  class="recruiter-view-job-applications1-candidate-work-status-container"
                >
                  <span
                    id="candidate-work-status-text"
                    class="recruiter-view-job-applications1-candidate-work-status-text"
                  >
                    {{ candidate.status.replace('_', ' ') | titlecase }}
                  </span>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noCandidates>
  <div class="no-candidates-message">
    No candidates in {{ activeStage.stage_name }}.
  </div>
</ng-template>
          <span
            *ngIf="moreCandidatesCount > 0"
            id="more-candidates-text"
            class="recruiter-view-job-applications1-more-candidates-text"
            (click)="loadMoreCandidates()"
          >
            View {{ moreCandidatesCount }} more candidates
          </span>
        </div>
        <span
          id="job-description-text"
          class="recruiter-view-job-applications1-job-description-text"
        >
          <span class="recruiter-view-job-applications1-text37">
            About the job:
          </span>
          <br class="recruiter-view-job-applications1-text38" />
          <div [innerHTML]="safeJobDescription"></div>
          <br />
          <br />
          <!--
          <span class="recruiter-view-job-applications1-text37">Minimum qualifications:</span>
          -->
          
          <br />
          <span>
            {{ job?.requirements }}
          </span>
          <br />
        </span>
      </div>
    </div>
  </div>
</div>