<div class="container">
  <div class="card">
    <h2 class="card-title">Reset Your Password</h2>

    <!-- Debug Info (Temporary)
    <div class="debug-info">Debug: Email = {{ email || 'null' }}</div> -->

    <!-- Error Message -->
    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

    <!-- Success Message (Before OTP Verification) -->
    <div *ngIf="message && !isOTPVerified" class="alert alert-success">{{ message }}</div>

    <!-- Form -->
    <form (ngSubmit)="handleSubmit()" aria-labelledby="reset-password-title">
      <!-- Email Field -->
      <div class="form-group">
        <label for="email" class="form-label">Email Address</label>
        <input
          type="email"
          class="form-control"
          id="email"
          [ngModel]="email || 'Awaiting email...'"
          name="email"
          readonly
          aria-describedby="emailHelp"
          [disabled]="!email"
        />
        <span class="form-hint">
          {{ email ? 'OTP sent to this email.' : 'Please request an OTP from the Forgot Password page.' }}
        </span>
      </div>

      <!-- OTP Field (Shown before OTP verification) -->
      <div class="form-group" *ngIf="!isOTPVerified && email">
        <label for="otp" class="form-label">Enter OTP</label>
        <input
          type="text"
          class="form-control"
          id="otp"
          [(ngModel)]="otp"
          name="otp"
          placeholder="6-digit OTP"
          required
          aria-required="true"
          [disabled]="loading"
          maxlength="6"
          pattern="[0-9]{6}"
        />
      </div>

      <!-- Password Fields (Shown after OTP verification) -->
      <div class="form-group" *ngIf="isOTPVerified && email">
        <label for="password" class="form-label">New Password</label>
        <input
          type="password"
          class="form-control"
          id="password"
          [(ngModel)]="password"
          name="password"
          placeholder="Enter new password"
          required
          aria-required="true"
          [disabled]="loading"
        />
      </div>
      <div class="form-group" *ngIf="isOTPVerified && email">
        <label for="confirmPassword" class="form-label">Confirm Password</label>
        <input
          type="password"
          class="form-control"
          id="confirmPassword"
          [(ngModel)]="confirmPassword"
          name="confirmPassword"
          placeholder="Confirm new password"
          required
          aria-required="true"
          [disabled]="loading"
        />
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="loading || !email || (isOTPVerified && (!password || !confirmPassword))"
        [attr.aria-label]="getButtonAriaLabel()"
      >
        <span *ngIf="loading" class="spinner"></span>
        <span *ngIf="!loading">{{ getButtonText() }}</span>
      </button>
    </form>

    <!-- Navigation Link -->
    <div class="nav-link">
      <a href="/login-forgot-password">Back to Forgot Password</a>
    </div>

    <!-- Success Message (After Password Reset) -->
    <div *ngIf="isOTPVerified && message" class="alert alert-success">{{ message }}</div>
  </div>
</div>