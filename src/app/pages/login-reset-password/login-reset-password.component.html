<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <h2 class="text-center" id="reset-password-title">Reset Password</h2>

      <!-- Error Message -->
      <div *ngIf="error" class="alert alert-danger mt-3" role="alert">{{ error }}</div>

      <!-- Success Message (Before OTP Verification) -->
      <div *ngIf="message && !isOTPVerified" class="alert alert-success mt-3" role="alert">{{ message }}</div>

      <!-- Form Always Rendered -->
      <form (ngSubmit)="handleSubmit()" aria-labelledby="reset-password-title">
        <!-- Email Display (Read-only) -->
        <div class="mb-3">
          <label for="email" class="form-label">Email Address</label>
          <input
            type="email"
            class="form-control"
            id="email"
            [ngModel]="email || 'Waiting for email...'"
            name="email"
            readonly
            aria-describedby="emailHelp"
            [disabled]="!email"
          />
          <div id="emailHelp" class="form-text">
            {{ email ? 'This is the email where the OTP was sent.' : 'Please request an OTP from the Forgot Password page.' }}
          </div>
        </div>

        <!-- OTP Input (Shown if OTP not verified and email exists) -->
        <div class="mb-3" *ngIf="!isOTPVerified && email">
          <label for="otp" class="form-label">OTP</label>
          <input
            type="text"
            class="form-control"
            id="otp"
            [(ngModel)]="otp"
            name="otp"
            placeholder="Enter 6-digit OTP"
            required
            aria-required="true"
            [disabled]="loading || !email"
            maxlength="6"
            pattern="[0-9]{6}"
          />
        </div>

        <!-- Password Inputs (Shown after OTP verification) -->
        <div *ngIf="isOTPVerified && email" class="mb-3">
          <label for="password" class="form-label">New Password</label>
          <input
            type="password"
            class="form-control"
            id="password"
            [(ngModel)]="password"
            name="password"
            placeholder="Enter new password"
            required
            aria-required="true"
            [disabled]="loading"
          />
        </div>
        <div *ngIf="isOTPVerified && email" class="mb-3">
          <label for="confirmPassword" class="form-label">Confirm Password</label>
          <input
            type="password"
            class="form-control"
            id="confirmPassword"
            [(ngModel)]="confirmPassword"
            name="confirmPassword"
            placeholder="Confirm new password"
            required
            aria-required="true"
            [disabled]="loading"
          />
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="btn btn-primary w-100"
          [disabled]="loading || !email || (isOTPVerified && (!password || !confirmPassword))"
          [attr.aria-label]="getButtonAriaLabel()"
        >
          <span *ngIf="loading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          <span *ngIf="!loading">{{ getButtonText() }}</span>
        </button>
      </form>

      <!-- Back to Forgot Password Link -->
      <div class="mt-3 text-center">
        <a href="/login-forgot-password" class="text-primary">Back to Forgot Password</a>
      </div>

      <!-- Success Message (After Password Reset) -->
      <div *ngIf="isOTPVerified && message" class="alert alert-success mt-3" role="alert">{{ message }}</div>
    </div>
  </div>
</div>