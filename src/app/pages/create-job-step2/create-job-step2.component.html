<ngx-spinner
  name="ai-spinner"
  bdColor="rgba(0, 0, 0, 0.8)"
  size="medium"
  color="#fff"
  type="ball-scale-multiple"
  [fullScreen]="true"
  >
  <p style="color: white; font-size: 18px;">Generating AI Questions...</p>
</ngx-spinner>
<navbar-for-admin-view
  rootClassName="navbar-for-candidate-viewroot-class-name"
  >
  <ng-template>
    <div class="candidate-home-fragment10">
      <a [routerLink]="['/candidate-dashboard-main']" class="candidate-home-text100">Dashboard</a>
    </div>
  </ng-template>
  <ng-template>
    <div class="candidate-home-fragment11">
      <a [routerLink]="['/candidate-assessment']" class="candidate-home-text101">Upskill</a>
    </div>
  </ng-template>
  <ng-template>
    <div class="candidate-home-fragment12">
      <a [routerLink]="['/candidate-assessment']" class="candidate-home-text102">Assessment</a>
    </div>
  </ng-template>
  <ng-template>
    <div class="candidate-home-fragment13">
      <span [routerLink]="['/candidate-dashboard-main']" class="candidate-home-text103">Jobs for you</span>
    </div>
  </ng-template>
  <ng-template #text1>
    <div class="candidate-home-fragment14">
      <span [routerLink]="['/profile-overview-page']" class="candidate-home-text104">Profile</span>
    </div>
  </ng-template>
  <ng-template #text2>
    <div class="candidate-home-fragment15">
      <span class="candidate-home-text105">Preference</span>
    </div>
  </ng-template>
  <ng-template #text3>
    <div class="candidate-home-fragment16">
      <span class="candidate-home-text106">Settings</span>
    </div>
  </ng-template>
  <ng-template #text4>
    <div class="candidate-home-fragment17">
      <span class="candidate-home-text107">
        {{ userProfile.first_name }} {{ userProfile.last_name }}
      </span>
    </div>
  </ng-template>
  <ng-template #text5>
    <div class="candidate-home-fragment18">
      <span class="candidate-home-text108">✅ 90% Profile Completion</span>
    </div>
  </ng-template>
  <ng-template #text6>
    <div class="candidate-home-fragment19">
      <span class="candidate-home-text109">View & edit profile</span>
    </div>
  </ng-template>
  <ng-template #text7>
    <div class="candidate-home-fragment20">
      <a [routerLink]="['/candidate-dashboard-main']" class="candidate-home-text110">Dashboard</a>
    </div>
  </ng-template>
  <ng-template #text8>
    <div class="candidate-home-fragment21">
      <span class="candidate-home-text111">Upskill</span>
    </div>
  </ng-template>
  <ng-template #text9>
    <div class="candidate-home-fragment22">
      <a [routerLink]="['/candidate-assessment']" class="candidate-home-text112">Assessment</a>
    </div>
  </ng-template>
  <ng-template #text10>
    <div class="candidate-home-fragment23">
      <span class="candidate-home-text113">Jobs for you</span>
    </div>
  </ng-template>
  <ng-template #text11>
    <div class="candidate-home-fragment24">
      <span class="candidate-home-text114">Preference</span>
    </div>
  </ng-template>
  <ng-template #text12>
    <div class="candidate-home-fragment25">
      <span class="candidate-home-text115">Settings</span>
    </div>
  </ng-template>
  <ng-template #text13>
    <div class="candidate-home-fragment26">
      <span class="candidate-home-text116">Logout</span>
    </div>
  </ng-template>
  <ng-template #text31>
    <div class="candidate-home-fragment27">
      <span class="candidate-home-text117">Logout</span>
    </div>
  </ng-template>
</navbar-for-admin-view>


<div class="admin-create-job-step2-container1">
  <div class="admin-create-job-step2-container2">

    @if (showAlert) {
      <app-alert-message
        [message]="alertMessage"
        [buttons]="alertButtons"
        (buttonClicked)="onAlertButtonClicked($event)"
        (close)="showAlert = false">
      </app-alert-message>
    }

    @if (showPopup) {
      <div class="alert" [ngClass]="{'success': popupType === 'success', 'error': popupType === 'error'}">
        @if (popupType === 'success') {
          <span class="tick">✔</span>
        }
        {{ popupMessage }}
        <span class="closebtn" (click)="closePopup()"> × </span>
      </div>
    }

    <div class="admin-create-job-step2-container3">
      <div class="admin-create-job-step2-container4">

        <progress-bar2-code
          rootClassName="progress-bar2-coderoot-class-name"
        ></progress-bar2-code>

        <div class="admin-create-job-step2-container5">
          <svg
            width="32"
            height="32"
            viewBox="0 0 32 32"
            class="admin-create-job-step2-icon1"
            (click)="onPrevious()"
            style="cursor: pointer;"
            >
            <path
              d="m14 26l1.41-1.41L7.83 17H28v-2H7.83l7.58-7.59L14 6L4 16z"
              fill="currentColor"
            ></path>
          </svg>
          <span class="admin-create-job-step2-text31">Assessment for Job</span>
        </div>

        <div class="admin-create-job-step2-questions-section">
          <span class="admin-create-job-step2-questions-title">
            How do you want to Add your Questions to Assessment?
          </span>
          <div class="admin-create-job-step2-buttons-container">

            <button
              id="generate-questions-button"
              class="admin-create-job-step2-generate-button"
              (click)="onGenerateAi()"
              [disabled]="isGenerating"
              [class.disabled]="isGenerating || hasGenerated"
              [title]="isGenerating ? 'Generating...' : hasGenerated ? 'Questions Generated' : 'Generate questions using AI'"
              >
              <span id="generate-questions-text" class="admin-create-job-step2-generate-text">
                @if (!isGenerating && !hasGenerated) {
                  <span>
                    <span class="admin-create-job-step2-generate-label">Generate with AI</span>
                    <span class="admin-create-job-step2-sparkle"> ✨</span>
                  </span>
                }
                @if (isGenerating) {
                  <span>Generating...</span>
                }
                @if (!isGenerating && hasGenerated) {
                  <span>
                    <span class="admin-create-job-step2-generate-label">Regenerate</span>
                    <span class="admin-create-job-step2-sparkle"> ✨</span>
                  </span>
                }
              </span>
            </button>

            <button
              id="upload-questions-button"
              class="admin-create-job-step2-upload-button"
              (click)="handleUploadClick()"
              [disabled]="isGenerating"
              [class.disabled]="isGenerating"
              title="Upload your own questions"
              >
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                class="admin-create-job-step2-upload-icon"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                >
                <!-- SVG paths remain unchanged -->
              </svg>
              <span id="upload-text" class="admin-create-job-step2-upload-text">
                <span>Upload</span>
              </span>
            </button>

            <!-- Uploaded file name display (No changes needed here) -->
            @if (uploadedFileName) {
              <div class="uploaded-file-name">
                Uploaded file: {{ uploadedFileName }}
              </div>
            }

            <!-- Popup Floating Message Card -->
            @if (showUploadPopup) {
              <div class="upload-popup-backdrop">
                <div class="upload-popup-card">
                  <h3>Upload Questions Template</h3>
                  <div class="step">
                    <strong>Step 1:</strong> Download the Excel template and fill it in the given format.<br />
                    <small>
                      Note: multiple choice questions, options, the actual correct answer, difficulty level (optional), marks (optional).
                    </small><br />
                    <button class="download-template-button" (click)="downloadTemplate()">
                      Download Template&nbsp;
                      <span class="download-icon">⬇️</span>
                    </button>
                  </div>
                  <div class="step" style="margin-top: 20px;">
                    <strong>Step 2:</strong> Upload the filled Excel template to extract questions and then give it some time.<br />
                    <input type="file" accept=".xlsx,.xls" (change)="onFileSelected($event)" />
                  </div>
                  <div class="popup-actions" style="margin-top: 20px;">
                    <button (click)="closeUploadPopup()">Close</button>
                  </div>
                </div>
              </div>
            }


          </div>
        </div>
      </div>

      <create-job-post-footer2
        rootClassName="create-job-post-footer2root-class-name1"
        [isNextDisabled]="!hasGenerated || isGenerating"
        (cancelClick)="onCancel()"
        (previousClick)="onPrevious()"
        (skipClick)="onSkip()"
        (nextClick)="onNext()"
        (saveDraftClick)="onSaveDraft()">
      </create-job-post-footer2>
    </div>
  </div>
</div>
