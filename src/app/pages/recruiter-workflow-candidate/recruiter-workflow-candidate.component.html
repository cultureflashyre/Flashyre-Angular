<app-alert-message 
  *ngIf="isAlertVisible"
  [message]="alertMessage"
  [buttons]="alertButtons"
  (buttonClicked)="handleAlertAction($event)"
  (close)="closeAlert()">
</app-alert-message>

<div class="recruiter-workflow-candidate-container10">
  <div class="recruiter-workflow-candidate-container11">
    
    <!-- SINGLE NAVBAR INSTANCE -->
    <recruiter-workflow-navbar
      rootClassName="recruiter-workflow-navbarroot-class-name2"
    >
      <ng-template #link1>
        <div class="recruiter-workflow-candidate-fragment10">
          <span class="recruiter-workflow-candidate-text10">Home</span>
        </div>
      </ng-template>
      <ng-template #link4>
        <div class="recruiter-workflow-candidate-fragment11">
          <span class="recruiter-workflow-candidate-text11">Requirments</span>
        </div>
      </ng-template>
      <ng-template #text1>
        <div class="recruiter-workflow-candidate-fragment12">
          <span class="recruiter-workflow-candidate-text12">Profile</span>
        </div>
      </ng-template>
      <ng-template #text2>
        <div class="recruiter-workflow-candidate-fragment13">
          <span class="recruiter-workflow-candidate-text13">Preference</span>
        </div>
      </ng-template>
      <ng-template #text3>
        <div class="recruiter-workflow-candidate-fragment14">
          <span class="recruiter-workflow-candidate-text14">Settings</span>
        </div>
      </ng-template>
      <ng-template #text7>
        <div class="recruiter-workflow-candidate-fragment15">
          <span class="recruiter-workflow-candidate-text15">Dashboard</span>
        </div>
      </ng-template>
      <ng-template #text9>
        <div class="recruiter-workflow-candidate-fragment16">
          <span class="recruiter-workflow-candidate-text16">Notifications</span>
        </div>
      </ng-template>
      <ng-template #text10>
        <div class="recruiter-workflow-candidate-fragment17">
          <span class="recruiter-workflow-candidate-text17">Jobs Posted</span>
        </div>
      </ng-template>
      <ng-template #text11>
        <div class="recruiter-workflow-candidate-fragment18">
          <span class="recruiter-workflow-candidate-text18">Preference</span>
        </div>
      </ng-template>
      <ng-template #text12>
        <div class="recruiter-workflow-candidate-fragment19">
          <span class="recruiter-workflow-candidate-text19">Settings</span>
        </div>
      </ng-template>
      <ng-template #text13>
        <div class="recruiter-workflow-candidate-fragment20">
          <span class="recruiter-workflow-candidate-text20">Logout</span>
        </div>
      </ng-template>
      <ng-template #text14>
        <div class="recruiter-workflow-candidate-fragment21">
          <span class="recruiter-workflow-candidate-text21">2</span>
        </div>
      </ng-template>
      <ng-template #text15>
        <div class="recruiter-workflow-candidate-fragment22">
          <span class="recruiter-workflow-candidate-text22">
            Leslie Alexander
          </span>
        </div>
      </ng-template>
      <ng-template #text16>
        <div class="recruiter-workflow-candidate-fragment23">
          <span class="recruiter-workflow-candidate-text23">Google</span>
        </div>
      </ng-template>
      <ng-template #text31>
        <div class="recruiter-workflow-candidate-fragment24">
          <span class="recruiter-workflow-candidate-text24">Logout</span>
        </div>
      </ng-template>
      <ng-template #text32>
        <div class="recruiter-workflow-candidate-fragment25">
          <span class="recruiter-workflow-candidate-text25">
            <span>Software Development</span>
            <br />
            <span>Mountain View, CA</span>
          </span>
        </div>
      </ng-template>
      <ng-template #text1411>
        <div class="recruiter-workflow-candidate-fragment26">
          <span class="recruiter-workflow-candidate-text29">2</span>
        </div>
      </ng-template>
    </recruiter-workflow-navbar>
    
    <!-- PAGE CONTENT -->
    <div class="recruiter-workflow-candidate-candidates-listing-container">
      <div id="cv-jd-upload-container" class="recruiter-workflow-candidate-cvjd-upload-container">
        <!-- Using Child's Source Logic -->
        <button (click)="showForm('Naukri')" id="add-questions-with-ai-button" type="button" class="recruiter-workflow-candidate-add-questions-with-ai-button1 button">          <span id="add-questions-with-ai-text" class="recruiter-workflow-candidate-add-questions-with-ai-text1">Naukri Input</span>
        </button>
        <button (click)="showForm('External')" id="add-questions-with-ai-button" type="button" class="recruiter-workflow-candidate-add-questions-with-ai-button2 button">          <span id="add-questions-with-ai-text" class="recruiter-workflow-candidate-add-questions-with-ai-text2">External Source</span>
        </button>
      </div>

      <!-- CANDIDATE LIST -->
      <div class="recruiter-workflow-candidate-recruiter-workflow-candidate-lists">
        <ng-container *ngIf="displayCandidates.length > 0; else noCandidates">
          <!-- List Header -->
          <div id="select-filter-sort-download-zip-main-container" class="recruiter-workflow-candidate-select-filter-sort-download-zip-main-container">
            <div class="recruiter-workflow-candidate-container30">
              <div id="select-all-main-container" class="recruiter-workflow-candidate-select-all-main-container1">
                <input 
                  type="checkbox" 
                  id="select-checkbox" 
                  class="recruiter-workflow-candidate-select-checkbox"
                  [checked]="isAllSelected"
                  (change)="toggleSelectAll($event)"
                />
                <span id="select-all-text" class="recruiter-workflow-candidate-select-all-text">Select All</span>
              </div>

              <!-- MERGED FROM PARENT: ADD TO WORKFLOW BUTTON -->
              <div 
                class="recruiter-workflow-candidate-select-all-main-container2" 
                style="cursor: pointer; margin-left: 20px;"
                (click)="openAddToWorkflowModal()"
                title="Add selected to ATS Workflow"
              >
                <svg width="24" height="24" viewBox="0 0 24 24" class="recruiter-workflow-client-icon11">
                  <path d="M14 2H4v20h16V8zm2 14h-3v3h-2v-3H8v-2h3v-3h2v3h3zm-3-7V3.5L18.5 9z" fill="currentColor"></path>
                </svg>
                <div class="recruiter-workflow-client-container16" style="display:flex; align-items:center; gap:4px;">
                  <span style="font-size:16px;">Add</span>
                  <svg width="24" height="24" viewBox="0 0 24 24" class="recruiter-workflow-client-icon13">
                    <path d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" fill="currentColor" fill-rule="evenodd"></path>
                  </svg>
                </div>
              </div>
              <!-- END MERGED BUTTON -->

            </div>
            <div id="filter-sort-download-zip-container" class="recruiter-workflow-candidate-filter-sort-download-zip-container">
              <button (click)="deleteSelected()" id="filtered-button" type="button" class="recruiter-workflow-candidate-filtered-button1 button" [disabled]="isDeleting">
                <span id="start-process-text" class="recruiter-workflow-candidate-start-process-text1">{{ isDeleting ? 'Deleting...' : 'Delete' }}</span>
              </button>
              
              <div id="filtered-container" class="recruiter-workflow-candidate-filtered-container" style="position: relative;">
                <button (click)="toggleFilterPanel()" id="filtered-button" type="button" class="recruiter-workflow-candidate-filtered-button2 button">
                  <span id="start-process-text" class="recruiter-workflow-candidate-start-process-text2">Filtered By</span>
                </button>
                <div *ngIf="isFilterPanelVisible" class="filter-backdrop" (click)="toggleFilterPanel()"></div>
                <div *ngIf="isFilterPanelVisible" class="filter-panel" (click)="$event.stopPropagation()">
                  <button type="button" class="close-panel-button" (click)="toggleFilterPanel()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                  <form [formGroup]="filterForm" class="filter-form-grid">
                    <div class="filter-group">
                      <label for="filter-name">Name</label>
                      <input id="filter-name" type="text" formControlName="name" placeholder="Filter by name..." class="input">
                    </div>
                    <div class="filter-group">
                      <label for="filter-location">Location</label>
                      <input id="filter-location" type="text" formControlName="location" placeholder="Filter by location..." class="input">
                    </div>
                    <div class="filter-group">
                      <label for="filter-skills">Skills (comma-separated)</label>
                      <input id="filter-skills" type="text" formControlName="skills" placeholder="e.g., java, python" class="input">
                    </div>
                    <div class="filter-group">
                      <label for="filter-ctc">Current CTC</label>
                      <select id="filter-ctc" formControlName="current_ctc" class="input">
                        <option value="">All CTCs</option>
                        <option *ngFor="let ctc of ctcChoices" [value]="ctc">{{ ctc }}</option>
                      </select>
                    </div>
                    <div class="filter-group">
                      <label for="filter-email">Email</label>
                      <input id="filter-email" type="text" formControlName="email" placeholder="Filter by email..." class="input">
                    </div>
                  </form>
                  <div class="filter-panel-actions">
                    <button type="button" (click)="clearFilters()" class="button clear-button">Clear</button>
                    <button type="button" (click)="applyFiltersFromPanel()" class="button apply-button">Apply</button>
                  </div>
                </div>
              </div>
              
              <div class="recruiter-workflow-candidate-sort-dropdown list-item">
                <select class="recruiter-workflow-candidate-dropdown-toggle1" (change)="sortCandidates($event)">
                  <option value="none" selected>Sort</option>
                  <option value="a-z">Alphabetical (A-Z)</option>
                  <option value="z-a">Alphabetical (Z-A)</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- List Body -->
          <div class="recruiter-workflow-candidate-container32">
            <div *ngFor="let candidate of displayCandidates" class="recruiter-workflow-candidate-container33">
              <div class="recruiter-workflow-candidate-container34">
                <div class="recruiter-workflow-candidate-container35">
                   <input 
                     type="checkbox" 
                     class="recruiter-workflow-candidate-select-checkbox" 
                     style="align-self: flex-start; margin-top: 8px;"
                     [(ngModel)]="candidate.selected"
                     (ngModelChange)="updateSelectAllState()"
                   />
                  <div class="recruiter-workflow-candidate-container36">
                    <span class="recruiter-workflow-candidate-text55">{{ candidate.first_name }} {{ candidate.last_name }}</span>
                    <div class="recruiter-workflow-candidate-container37">
                      <div class="recruiter-workflow-candidate-container38">
                        <svg width="24" height="24" viewBox="0 0 24 24" class="recruiter-workflow-candidate-icon23">
                          <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" rx="2" ry="2" width="20" height="14"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></g>
                        </svg>
                        <span class="recruiter-workflow-candidate-text56">{{ candidate.total_experience_min }}y - {{ candidate.total_experience_max }}y</span>
                      </div>
                      <div class="recruiter-workflow-candidate-container39">
                        <svg width="24" height="24" viewBox="0 0 24 24" class="recruiter-workflow-candidate-icon27">
                          <path d="M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-2.28A2 2 0 0 0 22 15V9a2 2 0 0 0-1-1.72V5a2 2 0 0 0-2-2zm0 2h14v2h-6a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h6v2H5zm8 4h7v6h-7zm3 1.5a1.5 1.5 0 0 0-1.5 1.5a1.5 1.5 0 0 0 1.5 1.5a1.5 1.5 0 0 0 1.5-1.5a1.5 1.5 0 0 0-1.5-1.5" fill="currentColor"></path>
                        </svg>
                        <span class="recruiter-workflow-candidate-text57">{{ candidate.current_ctc }}</span>
                      </div>
                      <div class="recruiter-workflow-candidate-container40">
                        <svg width="24" height="24" viewBox="0 0 24 24" class="recruiter-workflow-candidate-icon29">
                          <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle r="3" cx="12" cy="10"></circle><path d="M12 2a8 8 0 0 0-8 8c0 1.892.402 3.13 1.5 4.5L12 22l6.5-7.5c1.098-1.37 1.5-2.608 1.5-4.5a8 8 0 0 0-8-8"></path></g>
                        </svg>
                        <span class="recruiter-workflow-candidate-text58">{{ candidate.current_location }}</span>
                      </div>
                    </div>
                    <div class="recruiter-workflow-candidate-container41">
                      <div class="recruiter-workflow-candidate-container42">
                        <span class="recruiter-workflow-candidate-text59">Role</span>
                        <span class="recruiter-workflow-candidate-text60">{{ candidate.work_experience }}</span>
                      </div>
                      <div class="recruiter-workflow-candidate-container44">
                        <span class="recruiter-workflow-candidate-text63">Preferred Location</span>
                        <span class="recruiter-workflow-candidate-text64">{{ candidate.preferred_location }}</span>
                      </div>
                      <div class="recruiter-workflow-candidate-container46">
                        <span class="recruiter-workflow-candidate-text66">Key Skills</span>
                        <span class="recruiter-workflow-candidate-text67">{{ candidate.skills }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="recruiter-workflow-candidate-container50">
                    <div class="recruiter-workflow-candidate-container51">
                      <h1 class="recruiter-workflow-candidate-text72">{{ candidate.source }}</h1>
                    </div>
                    <div class="recruiter-workflow-candidate-container52">
                      <svg 
                        width="24" 
                        height="24" 
                        viewBox="0 0 24 24"
                        (click)="openResume(candidate.resume)"
                        [ngClass]="{
                          'recruiter-workflow-candidate-icon33': candidate.resume, 
                          'icon-disabled': !candidate.resume
                        }"
                        [style.cursor]="candidate.resume ? 'pointer' : 'default'"
                        title="View Resume"
                      >
                        <g fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round">
                          <path d="M4 4v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.342a2 2 0 0 0-.602-1.43l-4.44-4.342A2 2 0 0 0 13.56 2H6a2 2 0 0 0-2 2m5 9h6m-6 4h3" stroke-linecap="round"></path>
                          <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                        </g>
                      </svg>
                    </div>
                    <div class="recruiter-workflow-candidate-container53">
                      <div class="recruiter-workflow-candidate-container54">
                        <span class="recruiter-workflow-candidate-text74">Phone Number :&nbsp;</span>
                        <span class="recruiter-workflow-candidate-text75">{{ candidate.phone_number }}</span>
                      </div>
                      <div class="recruiter-workflow-candidate-container55">
                        <span class="recruiter-workflow-candidate-text76">Email Id :&nbsp;</span>
                        <span class="recruiter-workflow-candidate-text77">{{ candidate.email }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="recruiter-workflow-candidate-container56">
                  <svg (click)="startEdit(candidate)" width="24" height="24" viewBox="0 0 1024 1024" class="recruiter-workflow-candidate-icon39">
                    <path d="M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32m-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 0 0 0-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 0 0 9.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9m67.4-174.4L687.8 215l73.3 73.3l-362.7 362.6l-88.9 15.7z" fill="currentColor"></path>
                  </svg>
                  <svg width="24" height="24" viewBox="0 0 24 24" class="recruiter-workflow-candidate-icon42">
                    <path d="M14 2H4v20h16V8zm2 14h-3v3h-2v-3H8v-2h3v-3h2v3h3zm-3-7V3.5L18.5 9z" fill="currentColor"></path>
                  </svg>
                  <svg (click)="deleteCandidate(candidate.id)" width="20" height="20" viewBox="0 0 20 20" class="recruiter-workflow-candidate-icon44">
                    <path d="M8.5 4h3a1.5 1.5 0 0 0-3 0m-1 0a2.5 2.5 0 0 1 5 0h5a.5.5 0 0 1 0 1h-1.054l-1.194 10.344A3 3 0 0 1 12.272 18H7.728a3 3 0 0 1-2.98-2.656L3.554 5H2.5a.5.5 0 0 1 0-1zM5.741 15.23A2 2 0 0 0 7.728 17h4.544a2 2 0 0 0 1.987-1.77L15.439 5H4.561zM8.5 7.5A.5.5 0 0 1 9 8v6a.5.5 0 0 1-1 0V8a.5.5 0 0 1 .5-.5M12 8a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" fill="currentColor"></path>
                  </svg>
                </div>
              </div>
              <div class="recruiter-workflow-candidate-container57">
                <div class="recruiter-workflow-candidate-container58">
                  <span class="recruiter-workflow-candidate-text78">Recruiter :&nbsp;</span>
                  <span class="recruiter-workflow-candidate-text79">
                    {{ candidate.recruiter_name }}
                  </span>
                </div>
                <div class="recruiter-workflow-candidate-container59">
                  <span class="recruiter-workflow-candidate-text80">Created :&nbsp;</span>
                  <span class="recruiter-workflow-candidate-text81">
                    {{ candidate.created_at | relativeDate }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- Empty State Template -->
        <ng-template #noCandidates>
          <div class="empty-list-container">
            <svg class="empty-list-icon" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="8.5" cy="7" r="4"></circle>
              <line x1="18" y1="8" x2="23" y2="13"></line>
              <line x1="23" y1="8" x2="18" y2="13"></line>
            </svg>
            <h2 class="empty-list-heading">No Candidate Profiles Found</h2>
            <p class="empty-list-subtext">Get started by adding a new candidate profile using the 'Naukri Input' or 'External Source' buttons.</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- WORKFLOW SELECTION MODAL (ADDED FROM PARENT) -->
<div *ngIf="showWorkflowModal" class="workflow-modal-overlay">
  <div class="workflow-modal">
    <div class="workflow-modal-header">
      Add {{ selectedCandidateCount }} Candidate(s) to Workflow
    </div>
    
    <div>
      <div class="workflow-select-label">Select Job Requirement:</div>
      <select class="workflow-job-select" [(ngModel)]="selectedJobId">
        <option [ngValue]="null" disabled>-- Choose a Job --</option>
        <option *ngFor="let job of availableJobs" [ngValue]="job.id">
          {{ job.client_name }} - {{ job.job_description | slice:0:30 }}...
        </option>
      </select>
    </div>

    <div class="workflow-modal-actions">
      <button class="modal-btn btn-cancel" (click)="closeWorkflowModal()">Cancel</button>
      <button class="modal-btn btn-confirm" (click)="confirmAddToWorkflow()" [disabled]="!selectedJobId">
        Add to Workflow
      </button>
    </div>
  </div>
</div>

<!-- ============================================= -->
<!-- === FORM MODAL OVERLAY (KEPT FROM CHILD) === -->
<!-- ============================================= -->
<ng-container *ngIf="formVisible">
  <div class="form-modal-backdrop" (click)="onCancel()"></div>
  
  <div class="form-modal-container" (click)="$event.stopPropagation()">
    <div class="recruiter-workflow-candidate-candidate-input-form">
      <form [formGroup]="candidateForm" (ngSubmit)="onSubmit()">
        
        <!-- Form Header -->
        <div class="recruiter-workflow-candidate-container12">
          <span class="recruiter-workflow-candidate-text30">{{ editingCandidateId ? 'Edit Candidate' : 'Input form' }}</span>
          <div class="recruiter-workflow-candidate-container13">
            <h1 class="source-label" [class.active]="formSource === 'Naukri'">Naukri</h1>
            <h1 class="source-label" [class.active]="formSource === 'External'">External</h1>
          </div>
          <button type="button" class="close-panel-button" (click)="onCancel()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <!-- File Upload Section from OLD version -->
        <div class="recruiter-workflow-candidate-container14">
            <div id="upload-file-container" class="recruiter-workflow-candidate-upload-file-container">
                 <input type="file" #fileInput (change)="onFileSelected($event)" style="display: none;" accept=".pdf,.doc,.docx"/>
                <input type="text" id="upload-file-input" placeholder="Select file" class="recruiter-workflow-candidate-upload-file-input input" readonly [value]="selectedFileName"/>
                <div (click)="fileInput.click()" id="upload-file-button-container" class="recruiter-workflow-candidate-upload-file-button-container">
                    <svg width="48" height="48" viewBox="0 0 48 48" class="recruiter-workflow-candidate-icon10">
                        <path d="M11.678 20.271C7.275 21.318 4 25.277 4 30c0 5.523 4.477 10 10 10c.947 0 1.864-.132 2.733-.378m19.322-19.351c4.403 1.047 7.677 5.006 7.677 9.729c0 5.523-4.477 10-10 10c-.947 0-1.864-.132-2.732-.378M36 20c0-6.627-5.373-12-12-12s-12 5.373-12 12m5.065 7.881L24 20.924L31.132 28M24 38V24.462" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                    <span class="recruiter-workflow-candidate-text33">Upload File</span>
                </div>
            </div>
            <span id="note-for-file" class="recruiter-workflow-candidate-note-for-file">PDF or DOCX only, max 5MB.</span>
        </div>

        <!-- Form Fields Section from OLD version -->
        <div class="recruiter-workflow-candidate-container15">
            <div id="enter-manually-text-container" class="recruiter-workflow-candidate-enter-manually-text-container">
                <span id="enter-manually-text" class="recruiter-workflow-candidate-enter-manually-text">Enter Manually</span>
            </div>
            
            <div class="recruiter-workflow-candidate-job-title-company-name-container1">
                <div class="recruiter-workflow-candidate-job-title-container1">
                    <span class="recruiter-workflow-candidate-job-title-text1">Candidate First Name</span>
                    <input type="text" formControlName="first_name" placeholder="Enter First Name" class="recruiter-workflow-candidate-job-title-input1 input"/>
                </div>
                <div class="recruiter-workflow-candidate-company-name-container1">
                    <span class="recruiter-workflow-candidate-company-name-text1">Candidate Last Name</span>
                    <input type="text" formControlName="last_name" placeholder="Enter Last Name" class="recruiter-workflow-candidate-company-name-input1 input"/>
                </div>
            </div>

            <div class="recruiter-workflow-candidate-job-title-company-name-container2">
                <div class="recruiter-workflow-candidate-job-title-container2">
                    <span class="recruiter-workflow-candidate-job-title-text2">Phone Number</span>
                    <input type="text" formControlName="phone_number" placeholder="Enter 10-digit Phone Number" class="recruiter-workflow-candidate-job-title-input2 input" maxlength="10"/>
                </div>
                <div class="recruiter-workflow-candidate-company-name-container2">
                    <span class="recruiter-workflow-candidate-company-name-text2">Email Id</span>
                    <input type="email" formControlName="email" placeholder="Enter Email" class="recruiter-workflow-candidate-company-name-input2 input"/>
                </div>
            </div>

            <div class="recruiter-workflow-candidate-issued-renewal-date-container1">
                <div class="recruiter-workflow-candidate-issued-date-container1">
                    <span class="recruiter-workflow-candidate-issuing-date-text1">Total Experience (Years)</span>
                    <div class="recruiter-workflow-candidate-select-container1">
                        <input type="number" formControlName="total_experience_min" placeholder="Min Experience" class="recruiter-workflow-candidate-company-name-input3 input"/>
                        <span>To</span>
                        <input type="number" formControlName="total_experience_max" placeholder="Max Experience" class="recruiter-workflow-candidate-company-name-input4 input"/>
                        <span>Years</span>
                    </div>
                </div>
                <div class="recruiter-workflow-candidate-renewal-date-container">
                    <span class="recruiter-workflow-candidate-renewal-date-text">Relevant Experience (Years)</span>
                    <div class="recruiter-workflow-candidate-select-container2">
                        <input type="number" formControlName="relevant_experience_min" placeholder="Min Experience" class="recruiter-workflow-candidate-company-name-input5 input"/>
                        <span>To</span>
                        <input type="number" formControlName="relevant_experience_max" placeholder="Max Experience" class="recruiter-workflow-candidate-company-name-input6 input"/>
                        <span>Years</span>
                    </div>
                </div>
            </div>

            <div class="recruiter-workflow-candidate-issued-renewal-date-container2">
                <div class="recruiter-workflow-candidate-issued-date-container2">
                    <span class="recruiter-workflow-candidate-issuing-date-text2">Expected CTC</span>
                    <div class="recruiter-workflow-candidate-select-container3">
                        <input type="number" formControlName="expected_ctc_min" placeholder="Min Salary" class="recruiter-workflow-candidate-company-name-input7 input"/>
                        <span>To</span>
                        <input type="number" formControlName="expected_ctc_max" placeholder="Max Salary" class="recruiter-workflow-candidate-company-name-input8 input"/>
                        <span>Years</span>
                    </div>
                </div>
                <div class="recruiter-workflow-candidate-certificate-name-container">
                    <span class="recruiter-workflow-candidate-certificate-name-text">Current CTC *</span>
                    <select formControlName="current_ctc" class="input">
                        <option value="" disabled>Select</option>
                        <option *ngFor="let ctc of ctcChoices" [value]="ctc">{{ ctc }}</option>
                    </select>
                </div>
            </div>

            <div class="recruiter-workflow-candidate-job-title-company-name-container3">
                <div class="recruiter-workflow-candidate-job-title-container3">
                    <span class="recruiter-workflow-candidate-job-title-text3">Preferred Location</span>
                    <!-- Pill Container -->
                    <div class="skills-input-container" style="min-width: 100%;">
                        <span *ngFor="let loc of preferredLocationsList; let i = index" class="skill-pill">
                          {{ loc }}
                          <button type="button" class="remove-skill-button" (click)="removeLocation('preferred', i)">&times;</button>
                        </span>
                        
                        <!-- Input with Event Binding -->
                        <input 
                            #prefInput
                            type="text" 
                            class="skills-entry-input" 
                            placeholder="Search City..." 
                            (input)="onPreferredLocationInput($event)"
                            (keydown.enter)="addManualLocation($event, 'preferred')"
                        />
                    </div>
                    
                    <!-- Suggestions Dropdown -->
                    <div class="location-suggestions-dropdown" *ngIf="showPreferredSuggestions && preferredSuggestions.length > 0">
                        <div 
                          class="suggestion-item" 
                          *ngFor="let suggestion of preferredSuggestions"
                          (click)="selectPreferredLocation(suggestion, prefInput)"
                        >
                          {{ suggestion.description }}
                        </div>
                    </div>
                     <!-- Hidden input -->
                    <input type="hidden" formControlName="preferred_location">
                </div>

                <!-- CURRENT LOCATION -->
                <div class="recruiter-workflow-candidate-job-title-container4" style="position: relative;">
                    <span class="recruiter-workflow-candidate-job-title-text4">Current Location</span>
                    
                    <!-- Pill Container -->
                    <div class="skills-input-container" style="min-width: 100%;">
                        <span *ngFor="let loc of currentLocationsList; let i = index" class="skill-pill">
                          {{ loc }}
                          <button type="button" class="remove-skill-button" (click)="removeLocation('current', i)">&times;</button>
                        </span>
                        
                        <!-- Input with Event Binding -->
                        <input 
                            #currInput
                            type="text" 
                            class="skills-entry-input" 
                            placeholder="Search City..." 
                            (input)="onCurrentLocationInput($event)"
                            (keydown.enter)="addManualLocation($event, 'current')"
                        />
                    </div>

                    <!-- Suggestions Dropdown -->
                    <div class="location-suggestions-dropdown" *ngIf="showCurrentSuggestions && currentSuggestions.length > 0">
                        <div 
                          class="suggestion-item" 
                          *ngFor="let suggestion of currentSuggestions"
                          (click)="selectCurrentLocation(suggestion, currInput)"
                        >
                          {{ suggestion.description }}
                        </div>
                    </div>
                    
                    <!-- Hidden input -->
                    <input type="hidden" formControlName="current_location">
                </div>
            </div>
            </div>

            <div class="recruiter-workflow-candidate-container28">
                <div class="recruiter-workflow-candidate-issued-date-container3">
                    <span class="recruiter-workflow-candidate-issuing-date-text3">Notice Period *</span>
                    <select formControlName="notice_period" class="input">
                        <option value="" disabled>Select</option>
                        <option *ngFor="let period of noticePeriodChoices" [value]="period">{{ period }}</option>
                    </select>
                </div>
                <div class="recruiter-workflow-candidate-credentials-container">
                    <span class="recruiter-workflow-candidate-credentials-text">Gender *</span>
                    <select formControlName="gender" class="input">
                        <option value="" disabled>Select Gender</option>
                        <option *ngFor="let gender of genderChoices" [value]="gender">{{ gender }}</option>
                    </select>
                </div>
            </div>

            <div class="recruiter-workflow-candidate-skills-container1">
                <div class="recruiter-workflow-candidate-skill-text-container1">
                    <span class="recruiter-workflow-candidate-skill-text1">Work Experience</span>
                    <span class="recruiter-workflow-candidate-skill-star-text1">*</span>
                </div>
                <input type="text" formControlName="work_experience" placeholder="Enter Work Experience" class="recruiter-workflow-candidate-job-title-input5 input"/>
            </div>

            <div class="recruiter-workflow-candidate-skills-container2">
                <div class="recruiter-workflow-candidate-skill-text-container2">
                    <span class="recruiter-workflow-candidate-skill-text2">Skills</span>
                    <span class="recruiter-workflow-candidate-skill-star-text2">*</span>
                </div>
                <div class="skills-input-container">
                    <span *ngFor="let skill of skills; let i = index" class="skill-pill">
                      {{ skill }}
                      <button type="button" class="remove-skill-button" (click)="removeSkill(i)">&times;</button>
                    </span>
                    <input type="text" class="skills-entry-input" placeholder="Type a skill and press Enter" (keydown.enter)="addSkill($event)">
                </div>
                <input type="hidden" formControlName="skills">
            </div>
        
        
        <!-- Submit/Cancel Buttons -->
        <div class="recruiter-workflow-candidate-submit-cancel-buttons-container">
            <button type="button" (click)="onCancel()" class="recruiter-workflow-candidate-cancel-button button">
              <span class="recruiter-workflow-candidate-cancel-text">Cancel</span>
            </button>
            <button type="submit" class="recruiter-workflow-candidate-submit-button button" [disabled]="isSubmitting">
              <span class="recruiter-workflow-candidate-submit-text">{{ isSubmitting ? 'Submitting...' : (editingCandidateId ? 'Update' : 'Submit') }}</span>
            </button>
        </div>
      </form>
    </div>
  </div>
</ng-container>